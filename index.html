<!DOCTYPE html>
<html>
    <head>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
        <title>Virutz</title>
        <style>
            html{
                margin: 0;
            }
            body {
                overflow: hidden;
                margin: 0;
            }
                        /* width */
            ::-webkit-scrollbar {
                width: 10px;
            }
            
            /* Track */
            ::-webkit-scrollbar-track {
                background: #f1f1f1; 
            }
            
            /* Handle */
            ::-webkit-scrollbar-thumb {
                background: #888; 
            }
            
            /* Handle on hover */
            ::-webkit-scrollbar-thumb:hover {
                background: #555; 
            }
            .alertRed {
                position: absolute;
                top: 20px;
                padding: 10px;
                background-color: #f44336;
                color: white;
                display: none;
                font-family: "Raleway", sans-serif;
            }

            .closeGameOverDiv{
                position: absolute;
                top: 25px;
                right: 25px;
                margin-left: 15px;
                color: white;
                font-weight: bold;
                float: right;
                font-size: 50px;
                line-height: 20px;
                cursor: pointer;
                transition: 0.3s;
            }
              
            .closebtnAlertRed {
                margin-left: 15px;
                color: white;
                font-weight: bold;
                float: right;
                font-size: 22px;
                line-height: 20px;
                cursor: pointer;
                transition: 0.3s;
            }
              
            .closebtnAlertRed:hover {
                color: black;
            }
            #armourSpace{
                height: 100vh;
                font-size: 0;
            }
            .armourSub{
                visibility: hidden;
                aspect-ratio: 1/1;
                height: 16.1%;
                border: 2px solid rgba(0, 0, 0, 0.05);
                border-radius: 10px;
                box-sizing: border-box;
                display: inline-flex;
                text-align: center;
                font-family: "Raleway", sans-serif;
                font-size: 125%;
                margin: 2.5px;
                cursor: pointer;;
                color: rgba(0, 0, 0, 0);
                transition: color .2s, border .2s;
            }

            .armourSub:hover{
                color: rgba(0, 0, 0, 0.2);
                border: 2px solid rgba(0, 0, 0, 0.2);
            }

            .dataPlayer{
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                text-align: center;
                font-size: 24px;
                font-family: "Raleway", sans-serif;
                margin-top: 10px;
                font-weight: 600;
            }

            .habilitiesPlayerDiv{
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                text-align: center;
                bottom: 10px;
            }

            .newHabilityDiv{
                position: relative;
                font-family: "Raleway", sans-serif;
                font-weight: 600;
                font-size: 20px;
                margin-right: 10px;
                cursor: pointer;
                border-radius: 2px;
                background-color: #00bbff;
                color: white;
                padding: 7px;
                border-radius: 10px;
                z-index: 1000;
            }

            .mainMenuOperations{
                position: static;
                width: 100vw;
                height: 100vh;
                display: none;
                justify-content: center;
                align-items: center;
                opacity: 0;
            }

            #divOptions{
                width: 950px;
                height: 300px;
            }

            .divOptionsMainMenu{
                background-color: rgba(0, 0, 0, .2);
                border-radius: 50px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                justify-content: space-evenly;
                z-index: 100;
            }

            .moneyText{
                font-family: "Raleway", sans-serif;
                font-size: 20px;
                display: block;
                width: 100%;
                text-align: center;
                margin-top: 10px;
                color:rgba(0, 0, 0, 0.7);
                font-weight: 700;
            }

            .structureOwned{
                width: 95%;
                vertical-align: middle;
            }

            .smallStructureOwned{
                width: 80%;
                vertical-align: middle;
            }

            .bulletStyle{
                position: absolute;
                border-radius: 100%;
                width: 50px;
                height: 50px;
                background-color: rgba(119, 101, 255, 0.8);
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .bigBulletStyle{
                position: absolute;
                border-radius: 100%;
                background-color: rgba(119, 101, 255, 0.8);
                width: 120px;
                height: 120px;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .iceBulletStyle{
                position: absolute;
                border-radius: 100%;
                background-color: rgba(101, 209, 255, 0.8);
                width: 90px;
                height: 90px;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .bulletMoveL1{
                animation: moveBulletL1 5s linear;
            }
            .bulletMoveL2{
                animation: moveBulletL2 4.588s linear;
            }
            .bulletMoveL3{
                animation: moveBulletL3 4.189s linear;
            }
            .bulletMoveL4{
                animation: moveBulletL4 3.776s linear;
            }
            .bulletMoveL5{
                animation: moveBulletL5 3.391s linear;
            }

            .enemyBasic{
                position: absolute;
                animation: moveEnemy 30s linear;
            }

            .enemySlow{
                position: absolute;
                animation: moveEnemySlow 45s linear;
            }

            .enemySuperSlow{
                position: absolute;
                animation: moveEnemySlow 200s linear;
            }

            .enemySuperFast{
                position: absolute;
                animation: moveEnemy 10s linear;
            }

            .enemy{
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                z-index: 99;
            }

            .gradientLifesSpace{
                width: 100%;
                height: 100%;
                border-radius: inherit;
                background: transparent;
                font-weight: 500;
            }

            #divOptionsUpgrade{
                width: 500px;
                height: 300px;
                flex-direction: column !important;
            }

            .title-text{
                font-family: "Raleway", sans-serif;
                font-size: 35px;
                font-weight: 700;
                text-align: center;
            }

            #buttonUpgrade{
                display: none;
                padding: 15px;
                background-color: rgb(32, 148, 34);
                border-radius: 20px;
                color: white;
                font-family: "Raleway", sans-serif;
                font-size: 30px;
                font-weight: 700;
                cursor: pointer;

            }

            #gameOverDiv{
                width: 100vw;
                height: 100vh;
                display: none;
            }

            #gameOverSubDiv{
                width: 600px;
                height: 200px;
                background-color: rgba(0, 0, 0, .2);
                border-radius: 50px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                display: flex;
                flex-direction: column;
                flex-wrap: wrap;
                align-items: center;
                justify-content: center;
                z-index: 100;
                padding: 30px;
                font-family: "Raleway", sans-serif;
                font-size: 40px;
                font-weight: 700;
            }

            /*.divFreezeAllAnimation{
                position: absolute;
                top: 0;
                left: -1000px;
                height: 100vh;
                width: 1000px;
                animation: freezeAnimationDiv 1s linear;
                background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(0, 166, 255, 0.2), rgba(255, 255, 255, 0));
            }*/

            #mainChrono{
                font-family: "Raleway", sans-serif;
                font-size: 25px;
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                text-align: center;
                font-weight: 600;
                bottom: 10px;
            }

            #divPreStartGame{
                position: absolute;
                width: 100vw;
                height: 100vh;
                z-index: 1001;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: rgba(185, 185, 185, 0.2);
            }

            #divPresentationGame{
                padding: 30px;
                border-radius: 20px;
                background-color: rgb(200, 200, 200);
                min-width: 535px;
            }

            #mainTitleStartGame{
                font-family: "Raleway", sans-serif;
                font-size: 45px;
                font-weight: 700;
                text-align: center;
                margin-bottom: 10px;
                
            }

            #instructionsSetStartGame{
                font-family: "Raleway", sans-serif;
            }

            #instructionsMain{
                font-size: 18px;
                line-height: 170%;
            }

            #buttonPlayStartGame{
                background: rgb(32, 71, 137);
                font-size: 30px;
                color: white;
                transition: background .2s;
                cursor: pointer;
                width: 100px;
                border-radius: 30px;
                padding: 17.5px;
                text-align: center;
                margin: auto;
                margin-top: 20px;
                font-weight: 900;
            }

            #buttonPlayStartGame:hover{
                background: rgb(13, 40, 85);
            }

            #selectDifficultyDiv{
                width: 100%;
                border-radius: 10px;
                display: flex;
                margin-top: 20px;
            }

            .optionDifficulty{
                width: 20%;
                text-align: center;
                padding: 10px;
                box-sizing: border-box;
                font-size: 17px;
                font-weight: 700;
                cursor: pointer;
                display: flex;
                align-content: center;
                justify-content: center;
                flex-wrap: wrap;
                min-width: 100px;
            }

            .difficultySelectedOptn{
                border: 4px solid black;
            }

            #difficultyModeGameOver{
                font-size: 24px;
                font-weight: 600;
                font-style: italic;
            }

            #instructionsHeader{
                font-size: 27.5px;
                font-weight: 700;
            }

            #gamePausedDiv{
                position: absolute;
                display: none;
                width: 100vw;
                height: 100vh;
                background: rgba(0,0,0,.3);
                justify-content: center;
                align-items: center;
                flex-direction: column;
            }

            .basicText{
                font-family: "Raleway", sans-serif;
                font-size: 25px;
                font-weight: 700;
            }

            /*.levelTagUp {
                bottom: 20%;
            }

            .levelTagDown {
                bottom: 17.5%;
            }

            .levelArmourTag{
                position: relative;
                left: 10%;
                transform: translateX(-50%);
                background-color: #8b8b8b00;
                padding: 5px;
                width: 10%;
                line-height: 100%;
                font-size: 15px;
                margin: auto;
                color: rgba(0, 0, 0, 0.5);
                font-family: "Raleway", sans-serif;
                font-weight: 700;
                border-radius: 50%;
            }*/

            .leaderboardUser {
                position: absolute;
                top: 20px;
                right: 20px;
                font-size: 45px;
                color: rgb(135 135 135);
                cursor: pointer;
            }

            #userBestMarksDiv{
                position: relative;
                display: none;
                padding: 50px;
                background-color: rgb(200, 200, 200);
                border-radius: 10px;
            }

            #playByLevelDiv{
                position: relative;
                display: none;
                padding: 50px;
                background-color: rgb(200, 200, 200);
                border-radius: 10px;
            }

            #box-levels{
                max-height: 50vh;
                overflow: auto;
                padding: 25px;
            }

            .titleUserBestMarks{
                text-align: center;
                margin-bottom: 20px;
                font-size: 50px;
                font-family: "Raleway", sans-serif;
                font-weight: 700;
            }

            .difficultylevelBestMarks{
                font-size: 30px;
                font-family: "Raleway", sans-serif;
                font-weight: 500;
                line-height: 175%;
            }

            .newLevelToShowUser {
                padding: 10px;
                font-size: 27.5px;
                font-family: "Raleway", sans-serif;
                font-weight: 600;
                line-height: 175%;
                border-radius: 20px;
                cursor: pointer;
                transition: background .3s;
                margin-bottom: 10px;
            }

            .newLevelToShowUser:hover {
                background: rgb(110, 110, 110, .3);
            }

            .xMark_top_right{
                position: absolute;
                top: 5%;
                right: 5%;
                font-size: 25px;
                cursor: pointer;
            }

            #presentationLevelDiv{
                position: absolute;
                width: 100vw;
                height: 100vh;
                left: -100vw;
                background: transparent;
                animation: presenNewtLevel cubic-bezier(0,1,1,0) 4s;
                display: none;
                align-items: center;
                justify-content: center;
                flex-direction: column;
                font-family: "Raleway", sans-serif;
                font-weight: 700;
            }

            #playByLevelOptionDiv{
                margin-top: 15px;
                margin-bottom: 15px;
                font-size: 20px;
                font-weight: 800;
                cursor: pointer;
                display: flex;
                align-items: center;
            }

            .newInfoDataLevel{
                padding: 0 10px;
                font-family: "Raleway", sans-serif;
                font-size: 20px;
            }

            .buttonOpenLevel{
                background: rgb(32, 71, 137);
                font-size: 20px;
                color: white;
                transition: background .2s;
                cursor: pointer;
                border-radius: 30px;
                padding: 17.5px;
                text-align: center;
                margin: auto;
                margin: 20px 0;
                font-weight: 900;
            }

            .buttonOpenLevel:hover{
                background: rgb(13, 40, 85);
            }

            @keyframes presenNewtLevel {
                0% { left: -100vw }
                100% { left: 100vw }
            }

            @keyframes freezeAnimationDiv {
                100% { left: 3000px; }
            }

            @keyframes moveBulletL1 {
                100% { left: 2000px; }
            }
            @keyframes moveBulletL2 {
                100% { left: 2000px; }
            }
            @keyframes moveBulletL3 {
                100% { left: 2000px; }
            }
            @keyframes moveBulletL4 {
                100% { left: 2000px; }
            }
            @keyframes moveBulletL5 {
                100% { left: 2000px; }
            }

            @keyframes moveEnemy {
                100% { left: -60px; }
            }

            @keyframes moveEnemySlow {
                100% { left: -200px; }
            }

            @media screen and (max-height: 850px) {
                #instructionsMain{
                    font-size: 16px;
                }
            }

            @media screen and (max-height: 730px) {
                #instructionsMain{
                    font-size: 15px;
                }

                #mainTitleStartGame{
                    font-size: 40px;
                }

                #instructionsHeader{
                    font-size: 22.5px;
                }

                .optionDifficulty{
                    font-size: 15px;
                }
            }

        </style>
    </head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RFZM98L10H"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-RFZM98L10H');
    </script>
    <body>
        <div id="presentationLevelDiv">
            <span id="levelNum" style="font-size: 50px;"></span>
            <span style="font-size: 35px;">Resist <span id="levelTimeGoal"></span> seconds</span>
        </div>
        <div id="gamePausedDiv"><i class="fa-solid fa-pause" style="font-size: 80px;"></i><br><span class="basicText">Click anywhere to resume the game</span></div>
        <div id="divPreStartGame">
            <i id="leaderBoardUserBestMarksIcon" class="fa-solid fa-ranking-star leaderboardUser" onclick="showBestMarksUser()"></i>

            <div id="userBestMarksDiv">
                <i id="xMark_userBestMarks" class="fa-solid fa-circle-xmark xMark_top_right" onclick="closeBestMarkUserMenu()"></i>
                <div class="titleUserBestMarks">Best Marks</div>
                <div class="difficultylevelBestMarks"><span style="font-weight: 700; font-style: italic;">Elementary: </span><span id="bestMarkElementary"></span></div>
                <div class="difficultylevelBestMarks"><span style="font-weight: 700; font-style: italic;">Easy: </span><span id="bestMarkEasy"></span></div>
                <div class="difficultylevelBestMarks"><span style="font-weight: 700; font-style: italic;">Normal: </span><span id="bestMarkNormal"></span></div>
                <div class="difficultylevelBestMarks"><span style="font-weight: 700; font-style: italic;">Hard: </span><span id="bestMarkHard"></span></div>
                <div class="difficultylevelBestMarks"><span style="font-weight: 700; font-style: italic;">Impossible: </span><span id="bestMarkImpossible"></span></div>
            </div>

            <div id="playByLevelDiv">
                <i id="xMark_playByLevel" class="fa-solid fa-circle-xmark xMark_top_right" onclick="closeLevelsUserMenu()"></i>
                <div class="titleUserBestMarks">Levels</div>
                <div id="box-levels">
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                </div>
            </div>

            <div id="divPresentationGame">
                <div id="mainTitleStartGame"><i class="fa-solid fa-virus"></i> Virutz <i class="fa-solid fa-virus"></i></i></div>
                <div id="instructionsSetStartGame">
                    <span id="instructionsHeader">How to Play <i id="arrowDownInstructions" style="cursor: pointer; font-size: 20px;" class="fa-solid fa-chevron-down" onclick="toggleInstructions()"></i></span>
                    <div id="instructionsMain" style="display: none">
                        <strong>Objective:</strong> eliminate viruses and resist as long as possible.<br>
                        To do this, you can buy six types of structures:<br>
                        BASIC TANK ( <i class="fa-solid fa-heart"></i> 4/<i class="fa-solid fa-sack-dollar"></i> 200 ): <i>Shoots bullets one at a time.</i><br>
                        ICE TANK ( <i class="fa-solid fa-heart"></i> 3/<i class="fa-solid fa-sack-dollar"></i> 400 ): <i>Slows down viruses and harms them.</i><br>
                        GUNNER TANK ( <i class="fa-solid fa-heart"></i> 5/<i class="fa-solid fa-sack-dollar"></i> 500 ): <i>Fires large bullets that split.</i><br>
                        MULTI TANK ( <i class="fa-solid fa-heart"></i> 7/<i class="fa-solid fa-sack-dollar"></i> 1000 ): <i>Shoots bullets three at a time.</i><br>
                        GOLDMINE( <i class="fa-solid fa-heart"></i> 3/<i class="fa-solid fa-sack-dollar"></i> 400 ): <i>Gives you 25$ every 2 seconds.</i><br>
                        WALL( <i class="fa-solid fa-heart"></i> 16/<i class="fa-solid fa-sack-dollar"></i> 300 ): <i>Prevent viruses from passing.</i><br>
                        <br style="margin-top: 2em; display: inline-block; content: '';">Remember, you earn an extra $25 every 2 seconds and can<br>
                        upgrade structures by right-clicking, with a maximum level of 7.<br>Also remember you can pause the game by leaving this window.<br>
                    </div>
                    <div id="playByLevelOptionDiv" onclick="displayLevels()">Play by Level</div>
                    <div id="selectDifficultyDiv">
                        <div id="elementaryDifficultyDiv" class="optionDifficulty" style="background-color:rgb(0 191 198); border-top-left-radius: 10px; border-bottom-left-radius: 10px;">Elementary</div>
                        <div id="easyDifficultyDiv" class="optionDifficulty" style="background-color:rgb(122, 191, 47)">Easy</div>
                        <div id="normalDifficultyDiv" class="optionDifficulty difficultySelectedOptn" style="background-color:rgb(236, 200, 55)">Normal</div>
                        <div id="hardDifficultyDiv" class="optionDifficulty" style="background-color:rgb(246, 127, 127)">Hard</div>
                        <div id="impossibleDifficultyDiv" class="optionDifficulty" style="background-color:rgb(170, 0, 0); color: white; border-top-right-radius: 10px; border-bottom-right-radius: 10px;">Impossible</div>
                    </div>
                    <div id="buttonPlayStartGame" onclick="startGame()">PLAY</div>
                </div>
            </div>
        </div>
        <div id="selectBulid" class="mainMenuOperations">
            <div id="divOptions" class="divOptionsMainMenu">
                <i id="xmark_close_buy" class="fa-solid fa-xmark fa-2x" style="position:absolute; top: 20px; right: 20px;color:rgb(132, 132, 132); cursor: pointer;"></i>
            
                <!--TO BUY-->
                <div id="alertNotEnoughMoney" class="alertRed">
                    <span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span> 
                    Not Enough Money!
                </div>
                <div class="optnToBuyMiniDiv"><img id="buyBasicTank" style="width: 150px; cursor: pointer" src="https://preview.redd.it/vq62mhb27q521.png?width=281&format=png&auto=webp&s=9aaf5903544521d61590959a4aa89109c13431f3"><span class="moneyText">200$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyIceTank" style="width: 115px; cursor: pointer;" src="https://preview.redd.it/tjaa7j118q521.png?width=293&format=png&auto=webp&s=ad9dcc5b342d5b8f10f169d677a54c91f29424cc"><span class="moneyText">400$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyGunnerTank" style="width: 150px; cursor: pointer;" src="https://mblogthumb-phinf.pstatic.net/20160917_195/wmsla2009_14741207470512rgqB_PNG/annilator.png?type=w800"><span class="moneyText">500$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyMultiTank" style="width: 150px; cursor: pointer" src="https://preview.redd.it/kjgx439g5q521.png?width=293&format=png&auto=webp&s=88ef558ce60a98fe9cc0eff9f92017dd9ec6b7cf" ><span class="moneyText">1000$</span></div>
                <!--<div class="optnToBuyMiniDiv"><img id="buyMinnerTank" style="width: 110px; cursor: pointer" src="https://static.wikia.nocookie.net/scenexeio/images/9/9e/Shrapnel-Base.png/revision/latest?cb=20220204105239" ><span class="moneyText">1500$</span></div>-->
                <div class="optnToBuyMiniDiv"><img id="buyGoldmine" style="width: 100px; cursor: pointer" src="docs/assets/goldmine.png"><span class="moneyText">400$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyWall" style="width: 100px; cursor: pointer" src="docs/assets/wall.png"><span class="moneyText">300$</span></div>

            </div>
        </div>
        <div id="selectUpgrade" class="mainMenuOperations">
            <div id="divOptionsUpgrade" class="divOptionsMainMenu">
                <i id="xmark_close_buy_upgrade" class="fa-solid fa-xmark fa-2x" style="position:absolute; top: 20px; right: 20px;color:rgb(132, 132, 132); cursor: pointer;"></i>
            
                <!--TO UPGRADE-->
                <div id="alertNotEnoughMoneyUpgrade" class="alertRed">
                    <span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span> 
                    Not Enough Money!
                </div>
                
                <div class="title-text">LEVEL <span id="currentLevelArmour"></span></div>
                <div id="buttonUpgrade">UPGRADE <span id="price_to_upgrade"></span></div>

            </div>
        </div>
        <div class="dataPlayer"><i class="fa-solid fa-sack-dollar" style="color: rgb(205, 205, 0)"></i><span id="moneyCounter" style="color: rgb(205, 205, 0); margin-left: 5px;"></span><i class="fa-solid fa-heart" style="margin-left: 20px;color: red"></i><span id="lifesCounter" style="color:red; margin-left: 5px;"></span></div>
        <div id="mainChrono">0.0</div>
        <div id="gameOverDiv">
            <div id="gameOverSubDiv">
                <span class="closeGameOverDiv" onclick="this.parentElement.parentElement.style.display='none';">&times;</span> 
                <span id="gameOverOrNewRecordSpan">Game Over!</span><span id="timeResistedGameOver" style="margin-top: 25px; margin-bottom: 25px;"></span><span id="difficultyModeGameOver"></span>
            </div>
        </div>
        <div id="armourSpace">
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
        </div>
        <script src="https://kit.fontawesome.com/8378f11a1e.js" crossorigin="anonymous"></script>
        <script>

            // TIMER
            var Timer = function(callback, delay) {
                var timerId, start, remaining = delay;
            
                this.pause = function() {
                    window.clearTimeout(timerId);
                    timerId = null;
                    remaining -= Date.now() - start;
                };
            
                this.resume = function() {
                    if (timerId) {
                        return;
                    }
                    start = Date.now();
                    timerId = window.setTimeout(callback, remaining);
                };
            
                this.resume();
            };

            // KEYFRAMES

            var moveEnemyKeyFrames = [
                { left: "-60px" }
            ];

            var moveEnemySlowKeyFrames = [
                { left: "-200px" }
            ];

            // SRC's
            const BASICTANK_SRC = "https://preview.redd.it/vq62mhb27q521.png?width=281&format=png&auto=webp&s=9aaf5903544521d61590959a4aa89109c13431f3";
            const MULTITANK_SRC = "https://preview.redd.it/kjgx439g5q521.png?width=293&format=png&auto=webp&s=88ef558ce60a98fe9cc0eff9f92017dd9ec6b7cf";
            const GOLDMINE_SRC = "docs/assets/goldmine.png";
            const WALL_SRC = "docs/assets/wall.png";
            const GUNNERTANK_SRC = "https://mblogthumb-phinf.pstatic.net/20160917_195/wmsla2009_14741207470512rgqB_PNG/annilator.png?type=w800";
            const ICETANK_SRC = "https://preview.redd.it/tjaa7j118q521.png?width=293&format=png&auto=webp&s=ad9dcc5b342d5b8f10f169d677a54c91f29424cc";
            
            var instructionsMain = document.getElementById("instructionsMain");
            var arrowDownInstructions = document.getElementById("arrowDownInstructions");

            function toggleInstructions(){
                if (instructionsMain.style.display == "block") {
                    instructionsMain.style.display = "none";
                    arrowDownInstructions.classList.remove("fa-chevron-up");
                    arrowDownInstructions.classList.add("fa-chevron-down");
                }
                else {
                    instructionsMain.style.display = "block";
                    arrowDownInstructions.classList.remove("fa-chevron-down");
                    arrowDownInstructions.classList.add("fa-chevron-up");
                }
            }

            var selectToBuild = document.getElementById("selectBulid");
            var selectUpgrade = document.getElementById("selectUpgrade");
            var xmark_close_buy = document.getElementById("xmark_close_buy");
            var xmark_close_buy_upgrade = document.getElementById("xmark_close_buy_upgrade")

            // LIFES
            const LIFES_BASIC_TANK = 4;
            const LIFES_MULTI_TANK = 7;
            const LIFES_GOLDMINE = 3;
            const LIFES_WALL = 16;
            const LIFES_GUNNER_TANK = 5;
            const LIFES_ICE_TANK = 3;

            // DIFFICULTY SELCTORS
            var elementaryDiff = document.getElementById("elementaryDifficultyDiv");
            var easyDiff = document.getElementById("easyDifficultyDiv");
            var normalDiff = document.getElementById("normalDifficultyDiv");
            var hardDiff = document.getElementById("hardDifficultyDiv");
            var impossibleDiff = document.getElementById("impossibleDifficultyDiv");

            var difficultySpawn;

            var eqDiffIni = {
                "Elementary": 9000,
                "Easy": 7000,
                "Normal": 5500,
                "Hard": 3750,
                "Impossible": 2000
            }

            var eqDiffChange = {
                "Elementary": 0.98,
                "Easy": 0.965,
                "Normal": 0.95,
                "Hard": 0.93,
                "Impossible": 0.91
            }

            var currentSelectedDifficulty = normalDiff;
            var currentDiffString = "Normal";

            elementaryDiff.addEventListener("click", function(){
                currentSelectedDifficulty.classList.remove("difficultySelectedOptn");
                elementaryDiff.classList.add("difficultySelectedOptn");
                currentSelectedDifficulty = elementaryDiff;
                currentDiffString = "Elementary";
            });

            easyDiff.addEventListener("click", function(){
                currentSelectedDifficulty.classList.remove("difficultySelectedOptn");
                easyDiff.classList.add("difficultySelectedOptn");
                currentSelectedDifficulty = easyDiff;
                currentDiffString = "Easy";
            });

            normalDiff.addEventListener("click", function(){
                currentSelectedDifficulty.classList.remove("difficultySelectedOptn");
                normalDiff.classList.add("difficultySelectedOptn");
                currentSelectedDifficulty = normalDiff;
                currentDiffString = "Normal";
            });

            hardDiff.addEventListener("click", function(){
                currentSelectedDifficulty.classList.remove("difficultySelectedOptn");
                hardDiff.classList.add("difficultySelectedOptn");
                currentSelectedDifficulty = hardDiff;
                currentDiffString = "Hard";
            });

            impossibleDiff.addEventListener("click", function(){
                currentSelectedDifficulty.classList.remove("difficultySelectedOptn");
                impossibleDiff.classList.add("difficultySelectedOptn");
                currentSelectedDifficulty = impossibleDiff;
                currentDiffString = "Impossible";
            });

            // LEVELS EVENT LISTENERS
            
            /*
            var newLevelOptions = {
                indexLevel
                nameLevel
                artisticName
                goalTime
                virusTimeline
                iniDiffSpawn
                changeDiffSpawn
                money
                moneyIntervalEarned
            }

            var spawnTypeLvl = {
                typeBasic: bool
                typeDouble: bool
                typeCovid: bool
                typeDiseaseB: bool
                typeDiseaseH: bool
                typeSkull: bool
                typeBoss: bool
            }

            var params = {
                skullSize: list
                bossSize: int
                timeAnimation: int
            }


            var options = {
                uniqueType: bool
                typeUnique: string
                params: type
                diffSpawn: int (miliseconds)
                fixedSP: bool
                setDiffSpawnGlobal: bool
                spawn: spawnTypeLvl
            }
            */

            var undefinedParams = {
                skullSize: undefined,
                bossSize: undefined,
                timeAnimation: undefined
            }

            var undefinedSpawnType = {
                typeBasic: undefined,
                typeDouble: undefined,
                typeCovid: undefined,
                typeDiseaseB: undefined,
                typeDiseaseH: undefined,
                typeSkull: undefined,
                typeBoss: undefined
            }



            var optionsL1 = {
                id: 1,
                indexLevel: 1,
                nameLevel: "Level 1",
                artisticName: "Virus Playground",
                goalTime: 400000,
                iniDiffSpawn: 5000,
                changeDiffSpawn: .96,
                money: 1500,
                moneyIntervalEarned: 25,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "basic",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    35:{
                        uniqueType: true,
                        typeUnique: "double",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    70:{
                        uniqueType: true,
                        typeUnique: "diseaseB",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    }
                }
            }

            var optionsL2 = {
                id: 2,
                indexLevel: 2,
                nameLevel: "Level 2",
                artisticName: "Fast & Furious",
                goalTime: 600000,
                iniDiffSpawn: 4000,
                changeDiffSpawn: 0.97,
                money: 1000,
                moneyIntervalEarned: 50,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "basic",
                        params: {
                            skullSize: undefined,
                            bossSize: undefined,
                            timeAnimation: 14
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    50:{
                        uniqueType: true,
                        typeUnique: "basic",
                        params: {
                            skullSize: undefined,
                            bossSize: undefined,
                            timeAnimation: 9
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                }
            }
            
            var optionsL3 = {
                id: 3,
                indexLevel: 3,
                nameLevel: "Level 3",
                artisticName: "Covid Planet",
                goalTime: 750000,
                iniDiffSpawn: 7000,
                changeDiffSpawn: 0.95,
                money: 2000,
                moneyIntervalEarned: 50,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "covid",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                }
            }

            var optionsL4 = {
                id: 4,
                indexLevel: 4,
                nameLevel: "Level 4",
                artisticName: "Hard Life",
                goalTime: 1000000,
                iniDiffSpawn: 8000,
                changeDiffSpawn: 0.97,
                money: 800,
                moneyIntervalEarned: 10,
                virusTimeline: {
                    0: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: false,
                            typeDiseaseB: false,
                            typeDiseaseH: false,
                            typeSkull: false,
                            typeBoss: false
                        }
                    },
                    15: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: false,
                            typeDiseaseH: false,
                            typeSkull: false,
                            typeBoss: false
                        }
                    },
                    30: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: false,
                            typeSkull: false,
                            typeBoss: false
                        }
                    },
                    50: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: false,
                            typeSkull: true,
                            typeBoss: false
                        }
                    },
                    75: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: true,
                            typeSkull: true,
                            typeBoss: true
                        }
                    }
                }
            }

            var optionsL5 = {
                id: 5,
                indexLevel: 5,
                nameLevel: "Level 5",
                artisticName: "Epidemic",
                goalTime: 200000,
                iniDiffSpawn: 2250,
                changeDiffSpawn: 0.9,
                money: 4000,
                moneyIntervalEarned: 25,
                virusTimeline: {
                    0: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: false,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: true,
                            typeSkull: true,
                            typeBoss: true
                        }
                    },
                }
            }

            var optionsL6 = {
                id: 6,
                indexLevel: 6,
                nameLevel: "Level 6",
                artisticName: "Beat The Boss",
                goalTime: 500000,
                iniDiffSpawn: 5000,
                changeDiffSpawn: 0.97,
                money: 1500,
                moneyIntervalEarned: 25,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "none",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    10: {
                        uniqueType: true,
                        typeUnique: "boss",
                        params: {
                            skullSize: undefined,
                            bossSize: 3000,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 4000,
                        fixedSP: true,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    11:{
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: true,
                            typeSkull: true,
                            typeBoss: false
                        }
                    }
                }
            }

            var optionsL7 = {
                id: 7,
                indexLevel: 7,
                nameLevel: "Level 7",
                artisticName: "Out Of Control",
                goalTime: 400000,
                iniDiffSpawn: 4000,
                changeDiffSpawn: 0.95,
                money: 1000,
                moneyIntervalEarned: 100,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "diseaseB",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    50: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: false,
                            typeDouble: false,
                            typeCovid: false,
                            typeDiseaseB: true,
                            typeDiseaseH: true,
                            typeSkull: false,
                            typeBoss: false
                        }
                    }
                }
            }

            var optionsL8 = {
                id: 8,
                indexLevel: 8,
                nameLevel: "Level 8",
                artisticName: "On and On",
                goalTime: 600000,
                iniDiffSpawn: 7500,
                changeDiffSpawn: 0.93, 
                money: 2500,
                moneyIntervalEarned: 100,
                virusTimeline: {
                    0: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: true,
                            typeSkull: true,
                            typeBoss: true
                        }
                    },
                }
            }

            var optionsL9 = {
                id: 9,
                indexLevel: 9,
                nameLevel: "Level 9",
                artisticName: "Bad Guys",
                goalTime: 700000,
                iniDiffSpawn: 9000, // No relevant because of fixed
                changeDiffSpawn: 0.985, // No relevant because of fixed
                money: 3000,
                moneyIntervalEarned: 75,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "boss",
                        params: {
                            skullSize: undefined,
                            bossSize: 600,
                            timeAnimation: 100,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                }
            }

            var optionsL10 = {
                id: 10,
                indexLevel: 10,
                nameLevel: "Level 10",
                artisticName: "Skull Cave",
                goalTime: 800000,
                iniDiffSpawn: 5000,
                changeDiffSpawn: 0.95,
                money: 1500,
                moneyIntervalEarned: 25,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [1, 2],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    20: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [1, 2, 3],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    40: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [1, 2, 3, 4],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    60: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [1, 2, 3, 4, 5],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                }
            }




            var levelsOptionsMain = [null, optionsL1, optionsL2, optionsL3, optionsL4, optionsL5, optionsL6, optionsL7, optionsL8, optionsL9, optionsL10];

            document.querySelectorAll(".newLevelToShowUser").forEach(function(e, i){
                e.nextElementSibling.style.display = "none";

                e.nextElementSibling.querySelector(":nth-child(1)").innerHTML = "<strong>Goal time: </strong>"+levelsOptionsMain[i+1].goalTime/1000+" seconds";
                e.nextElementSibling.querySelector(":nth-child(2)").innerHTML = "<strong>Money: </strong>"+levelsOptionsMain[i+1].money+"$";
                e.nextElementSibling.querySelector(":nth-child(3)").innerHTML = "<strong>Basic Income: </strong>"+levelsOptionsMain[i+1].moneyIntervalEarned+"$";


                e.addEventListener("click", function(){
                    if (e.nextElementSibling.style.display == "none") {
                        e.nextElementSibling.style.display = "block";
                    }
                    else {
                        e.nextElementSibling.style.display = "none";
                    }
                })
                console.log(e.nextElementSibling.querySelector(":nth-child(4)"));
                e.nextElementSibling.querySelector(":nth-child(4)").addEventListener("click", function(){
                    newLevel(levelsOptionsMain[i+1]);
                })
                e.textContent = levelsOptionsMain[i+1].nameLevel+": "+levelsOptionsMain[i+1].artisticName;

                if (localStorage.getItem("level"+levelsOptionsMain[i+1].id+"_completed") == "true") {
                    e.style.backgroundColor = "rgba(0, 255, 31, 0.25)";
                }
            })
            

            // BEST MARKS USER

            var userBestMarksDiv = document.getElementById("userBestMarksDiv");
            var divPresentationGame = document.getElementById("divPresentationGame");
            var iconShowBestMarks = document.getElementById("leaderBoardUserBestMarksIcon");

            var BMElementary = document.getElementById("bestMarkElementary");
            var BMEasy = document.getElementById("bestMarkEasy");
            var BMNormal = document.getElementById("bestMarkNormal");
            var BMHard = document.getElementById("bestMarkHard");
            var BMImpossible = document.getElementById("bestMarkImpossible");

            function showBestMarksUser() {
                userBestMarksDiv.style.display = "block";
                divPresentationGame.style.display = "none";
                iconShowBestMarks.style.display = "none";

                if (localStorage.getItem("bestMarkElementary") != null) {
                    BMElementary.textContent = localStorage.getItem("bestMarkElementary")+" seconds";
                }
                else {
                    BMElementary.textContent = "(Not played yet)";
                }

                if (localStorage.getItem("bestMarkEasy") != null) {
                    BMEasy.textContent = localStorage.getItem("bestMarkEasy")+" seconds";
                }
                else {
                    BMEasy.textContent = "(Not played yet)";
                }

                if (localStorage.getItem("bestMarkNormal") != null) {
                    BMNormal.textContent = localStorage.getItem("bestMarkNormal")+" seconds";
                }
                else {
                    BMNormal.textContent = "(Not played yet)";
                }

                if (localStorage.getItem("bestMarkHard") != null) {
                    BMHard.textContent = localStorage.getItem("bestMarkHard")+" seconds";
                }
                else {
                    BMHard.textContent = "(Not played yet)";
                }

                if (localStorage.getItem("bestMarkImpossible") != null) {
                    BMImpossible.textContent = localStorage.getItem("bestMarkImpossible")+" seconds";
                }
                else {
                    BMImpossible.textContent = "(Not played yet)";
                }
            }

            function closeBestMarkUserMenu() {
                userBestMarksDiv.style.display = "none";
                divPresentationGame.style.display = "block";
                iconShowBestMarks.style.display = "block";
            }

            // LEVELS DISPLAY

            var playByLevelDiv = document.getElementById("playByLevelDiv");

            function displayLevels(){
                playByLevelDiv.style.display = "block";
                divPresentationGame.style.display = "none";
                iconShowBestMarks.style.display = "none";
            }

            function closeLevelsUserMenu() {
                playByLevelDiv.style.display = "none";
                divPresentationGame.style.display = "block";
                iconShowBestMarks.style.display = "block";
            }

            // TO BUY SELECTIONS
            var basicTank = document.getElementById("buyBasicTank");
            var multiTank = document.getElementById("buyMultiTank");
            var goldmine = document.getElementById("buyGoldmine");
            var wall = document.getElementById("buyWall");
            var gunnerTank = document.getElementById("buyGunnerTank");
            var iceTank = document.getElementById("buyIceTank");

            var spacesToBuy = new Array(30).fill(0);
            var spacesIntervals = new Array(30);
            var lifeSpaces = new Array(30).fill(NaN);
            var levelsSpaces = new Array(30).fill(0);

            var numBuilt = {
                1: 0,
                2: 0,
                3: 0,
                4: 0,
                5: 0,
                6: 0
            }

            var limitToBulid = {
                1: 18,
                2: 12,
                3: 10,
                4: 12,
                5: 12,
                6: 12
            }

            var realtionLifes = {
                0: NaN,
                1: LIFES_BASIC_TANK,
                2: LIFES_MULTI_TANK,
                3: LIFES_GOLDMINE,
                4: LIFES_WALL,
                5: LIFES_GUNNER_TANK,
                6: LIFES_ICE_TANK
            }

            // UPGRADE PRICES
            var upgradeBasicTank = {
                0: 200,
                1: 350,
                2: 500,
                3: 750,
                4: 900,
                5: 1100,
                6: 1500
            }

            var upgradeMultiTank = {
                0: 1000,
                1: 750,
                2: 1000,
                3: 1300,
                4: 1700,
                5: 2500,
                6: 3500
            }

            var upgradeGoldmine = {
                0: 400,
                1: 600,
                2: 900,
                3: 1200,
                4: 1500,
                5: 1800,
                6: 2500
            }

            var upgradeWall = {
                0: 300,
                1: 200,
                2: 300,
                3: 500,
                4: 800,
                5: 1200,
                6: 2000
            }

            var upgradeGunnerTank = {
                0: 500,
                1: 500,
                2: 800,
                3: 1200,
                4: 1450,
                5: 1800,
                6: 2500
            }

            var upgradeIceTank = {
                0: 400,
                1: 500,
                2: 750,
                3: 1050,
                4: 1350,
                5: 1750,
                6: 2300
            }

            var realtionUpgrade = {
                1: upgradeBasicTank,
                2: upgradeMultiTank,
                3: upgradeGoldmine,
                4: upgradeWall,
                5: upgradeGunnerTank,
                6: upgradeIceTank
            }

            var timeUpgradeBasicTank = {
                0: 2000,
                1: 1650,
                2: 1300,
                3: 1000,
                4: 700,
                5: 500,
                6: 350
            }

            var timeUpgradeMultiTank = {
                0: 3500,
                1: 2900,
                2: 2300,
                3: 1700,
                4: 1300,
                5: 850,
                6: 600
            }

            var timeUpgradeGoldmine = {
                0: 2000,
                1: 1700,
                2: 1400,
                3: 1100,
                4: 800,
                5: 500,
                6: 300
            }

            var lifeUpgradeWall = {
                0: 15,
                1: 20,
                2: 25,
                3: 30,
                4: 35,
                5: 50,
                6: 65
            }

            var timeUpgradeGunnerTank = {
                0: 4000,
                1: 3100,
                2: 2300,
                3: 1600,
                4: 1100,
                5: 700,
                6: 500
            }

            var timeUpgradeIceTank = {
                0: 2500,
                1: 2000,
                2: 1650,
                3: 1200,
                4: 900,
                5: 700,
                6: 500
            }

            var relationUpgradeSkills = {
                1: timeUpgradeBasicTank,
                2: timeUpgradeMultiTank,
                3: timeUpgradeGoldmine,
                4: lifeUpgradeWall,
                5: timeUpgradeGunnerTank,
                6: timeUpgradeIceTank
            }

            var priceToUpgradeSpan = document.getElementById("price_to_upgrade");

            // OTHER
            var currentMoney = 1000;
            var currentLifes = 5;

            var moneyCounterDOC = document.getElementById("moneyCounter");
            var lifesCounterDOC = document.getElementById("lifesCounter");

            moneyCounterDOC.textContent = currentMoney;
            lifesCounterDOC.textContent = currentLifes;

            var alertNoMoney = document.getElementById("alertNotEnoughMoney");
            var alertNoMoneyUpgrade = document.getElementById("alertNotEnoughMoneyUpgrade");

            var armourSpaceDiv = document.getElementById("armourSpace");

            var upgradeMainButton = document.getElementById("buttonUpgrade");

            var selectedSpace;
            var selectedIndex;

            function setUpUserView(){
                document.querySelectorAll(".armourSub").forEach(function(e){
                    e.style.lineHeight = window.getComputedStyle(e).getPropertyValue('height');
                    e.style.visibility = "visible";
                })
                armourSpaceDiv.style.width = parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[0]).getPropertyValue('width'))*5+41+"px";
            }

            window.addEventListener("resize", setUpUserView);

            setUpUserView();

            function getRandomInt(max) {
                return Math.floor(Math.random() * max);
            }

            function clearBackground() {
                document.querySelectorAll(".armourSub").forEach(function(ele){
                    ele.style.backgroundColor = "#ffffff";
                })
            }

            var timeResisted = document.getElementById("timeResistedGameOver");
            var gameOverDiv = document.getElementById("gameOverDiv");
            var diffGameOver = document.getElementById("difficultyModeGameOver");

            var endGameVar = false;

            var gameOverOrNewRecord = document.getElementById("gameOverOrNewRecordSpan");

            function endGame(){
                if (!endGameVar) {
                    endGameVar = true;
                    closeBuyMenu();
                    closeUpgradeMenu();
                    lifesCounterDOC.textContent = 0;
                    clearInterval(mainMoneyInterval);
                    clearInterval(chronoInterval);

                    for (var i = 0; i < 30; ++i) {
                        clearInterval(spacesIntervals[i]);
                    }

                    document.querySelectorAll(".enemy").forEach(function(ele){
                        ele.remove();
                    })

                    if (playingAtLevel) {
                        if (timerLevel != undefined) {
                            timerLevel.pause();
                        }
                        
                        for (var i = 0; i < timeOutsStagesLevel.length; ++i) {
                            timeOutsStagesLevel[i].pause();
                        }

                        clearInterval(intervalSpawning_level);
                        clearInterval(intervalDifficulty_level);

                        let newCurrentDate = new Date().getTime();
                        let timeResistedByUser = Math.round((newCurrentDate-d)/1000, 2);
                        gameOverDiv.style.display = "contents";
                        timeResisted.textContent = "You resisted "+timeResistedByUser+" seconds";
                        diffGameOver.textContent = "In "+currentLVLName;
                        gameOverOrNewRecord.textContent = "Game Over!";
                    }
                    else {
                        clearInterval(intervalDifficulty);
                        clearInterval(controlBossSpawnInterval);
                        clearInterval(intervalVirus);

                        for (var i = 0; i < listTimeOutsSpawnBoss.length; i++) {
                            clearTimeout(listTimeOutsSpawnBoss[i]);
                        }

                        let newCurrentDate = new Date().getTime();
                        let timeResistedByUser = Math.round((newCurrentDate-d)/1000, 2);
                        gameOverDiv.style.display = "contents";
                        timeResisted.textContent = "You resisted "+timeResistedByUser+" seconds";
                        diffGameOver.textContent = "In "+currentDiffString+" difficulty";
                        gameOverOrNewRecord.textContent = "Game Over!";

                        let currentBestMark = localStorage.getItem("bestMark"+currentDiffString);
                        if (currentBestMark == null) {
                            gameOverOrNewRecord.textContent = "New Record!";
                            localStorage.setItem("bestMark"+currentDiffString, timeResistedByUser);
                        }
                        else {
                            if (timeResistedByUser > currentBestMark) {
                                gameOverOrNewRecord.textContent = "New Record!";
                                localStorage.setItem("bestMark"+currentDiffString, timeResistedByUser);
                            }
                        }
                    }
                }
            }

            function closeBuyMenu(){
                selectToBuild.style.display = "none";
                alertNoMoney.style.display = "none";
                clearBackground();
            }

            function closeUpgradeMenu(){
                upgradeMainButton.style.display = "none"
                selectUpgrade.style.display = "none";
                alertNoMoneyUpgrade.style.display = "none";
                clearBackground();
            }

            xmark_close_buy.addEventListener("click", closeBuyMenu)

            xmark_close_buy_upgrade.addEventListener("click", closeUpgradeMenu)

            var currentLevelArmour = document.getElementById("currentLevelArmour");

            function upgradeMenu(space, i) {
                closeBuyMenu();
                if (selectedIndex != i) {
                    alertNoMoneyUpgrade.style.display = "none";
                }
             
                selectUpgrade.style.display = "contents";

                selectedSpace = space.currentTarget;
                selectedIndex = i;

                currentLevelArmour.textContent = levelsSpaces[i]+" ("+(relationUpgradeSkills[spacesToBuy[i]][levelsSpaces[i]-1])/1000+"s)";

                priceToUpgradeSpan = document.getElementById("price_to_upgrade");

                upgradeMainButton = document.getElementById("buttonUpgrade");

                if (levelsSpaces[i] < 7) {
                    upgradeMainButton.style.display = "block";
                }
                else {
                    upgradeMainButton.style.display = "none";
                }

                var priceUpgrade = realtionUpgrade[spacesToBuy[i]][levelsSpaces[i]];

                priceToUpgradeSpan.textContent = priceUpgrade+"$ ("+(relationUpgradeSkills[spacesToBuy[i]][levelsSpaces[i]])/1000+"s)";

                upgradeMainButtonClone = upgradeMainButton.cloneNode(true);
            
                upgradeMainButton.parentNode.replaceChild(upgradeMainButtonClone, upgradeMainButton);

                upgradeMainButtonClone.addEventListener("click", function(){
                    upgradeLevel(priceUpgrade, space, i, spacesToBuy[i]);
                    upgradeMenu(space, i);
                });
            }

            function upgradeLevel(price, ele, index, type){
                if (currentMoney >= price) {
                    currentMoney -= price;
                    moneyCounterDOC.textContent = currentMoney;

                    clearInterval(spacesIntervals[index]);

                    if (type == 1) {
                        createIntervalBasicTank(index, relationUpgradeSkills[spacesToBuy[index]][levelsSpaces[index]]);
                    }
                    else if (type == 2) {
                        createIntervalMultiTank(index, relationUpgradeSkills[spacesToBuy[index]][levelsSpaces[index]]);
                    }
                    else if (type == 3) {
                        createIntervalGoldmine(index, relationUpgradeSkills[spacesToBuy[index]][levelsSpaces[index]]);
                    }
                    else if (type == 5) {
                        createIntervalGunnerTank(index, relationUpgradeSkills[spacesToBuy[index]][levelsSpaces[index]]);
                    }
                    else if (type == 6) {
                        createIntervalIceTank(index, relationUpgradeSkills[spacesToBuy[index]][levelsSpaces[index]]);
                    }

                    levelsSpaces[index]++;

                    /*if (type != 4) {
                        document.getElementsByClassName("armourSub")[index].firstChild.children[1].textContent = levelsSpaces[index];
                    }*/

                }
                else {
                    alertNoMoneyUpgrade.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                    alertNoMoneyUpgrade.style.display = "block";
                }
            }

            basicTank.addEventListener("click", createNewBasicTank);
            multiTank.addEventListener("click", createNewMultiTank);
            goldmine.addEventListener("click", createNewGoldmine);
            wall.addEventListener("click", createNewWall);
            gunnerTank.addEventListener("click", createNewGunnerTank);
            iceTank.addEventListener("click", createNewIceTank);
            //minnerTank.addEventListener("click", createNewMinnerTank);

            function bulidSpace(space, i) {
                alertNoMoney.style.display = "none";
                closeUpgradeMenu();
                selectToBuild.style.display = "contents";

                selectedSpace = space.currentTarget;
                selectedIndex = i;
                selectedSpace.style.background = "#DBDBDB";
            }

            function colision(eleA, eleB) {
                var rectA = eleA.getBoundingClientRect();
                var rectB = eleB.getBoundingClientRect();
        
                return (
                  rectA.left < rectB.right &&
                  rectA.right > rectB.left &&
                  rectA.top < rectB.bottom &&
                  rectA.bottom > rectB.top
                );
            }

            /*function freezeAll(time) {
                var freezeDivAnimation = document.createElement("div");
                freezeDivAnimation.classList.add("divFreezeAllAnimation");
                document.body.appendChild(freezeDivAnimation);

                freezeDivAnimation.addEventListener("animationend", function(e){
                    e.currentTarget.remove();
                })
                setTimeout(function(){
                    document.querySelectorAll(".enemy").forEach(function(ele){
                        ele.style.animationPlayState = "paused";
                    })
                }, 350)

                setTimeout(function(){
                    document.querySelectorAll(".enemy").forEach(function(ele){
                        ele.style.animationPlayState = "running";
                    })
                }, time+350)
            }*/

            var listSpacesQuery = document.querySelectorAll(".armourSub");

            function createIntervalBasicTank(index, timing){
                spacesIntervals[index] = setInterval(function(){
                    newBullet = document.createElement("div");
                    newBullet.classList.add("bulletType");
                    newBullet.classList.add("bulletStyle");
                    newBullet.style.left = listSpacesQuery[index].getBoundingClientRect().left+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))+"px";
                    newBullet.style.top = listSpacesQuery[index].getBoundingClientRect().top+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))/2+"px";
                    
                    if (index%5 == 0) {
                        newBullet.classList.add("bulletMoveL1");
                    }
                    else if (index%5 == 1) {
                        newBullet.classList.add("bulletMoveL2");
                    }
                    else if (index%5 == 2) {
                        newBullet.classList.add("bulletMoveL3");
                    }
                    else if (index%5 == 3) {
                        newBullet.classList.add("bulletMoveL4");
                    }
                    else if (index%5 == 4) {
                        newBullet.classList.add("bulletMoveL5");
                    }

                    /*if (index<5) {
                        newBullet.style.top = 60+"px";
                    }
                    else if (index<10) {
                        newBullet.style.top = 210+"px";
                    }
                    else if (index<15) {
                        newBullet.style.top = 360+"px";
                    }
                    else if (index<20) {
                        newBullet.style.top = 510+"px";
                    }
                    else if (index<25) {
                        newBullet.style.top = 660+"px";
                    }
                    else if (index<30) {
                        newBullet.style.top = 810+"px";
                    }*/

                    document.body.appendChild(newBullet);

                    newBullet.addEventListener('animationend', function(e){
                        e.currentTarget.remove();
                    });

                    //observer.observe(newBullet);
                }, timing)
            }

            function createIntervalMultiTank(index, timing){
                spacesIntervals[index] = setInterval(function(){
                    for (var i = -50; i < 100; i+=50){
                        newBullet = document.createElement("div");
                        newBullet.classList.add("bulletType");
                        newBullet.classList.add("bulletStyle");
                        newBullet.style.left = listSpacesQuery[index].getBoundingClientRect().left+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))+"px";
                        newBullet.style.top = listSpacesQuery[index].getBoundingClientRect().top+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))/2+i+"px";

                        if (index%5 == 0) {
                            newBullet.classList.add("bulletMoveL1");
                        }
                        else if (index%5 == 1) {
                            newBullet.classList.add("bulletMoveL2");
                        }
                        else if (index%5 == 2) {
                            newBullet.classList.add("bulletMoveL3");
                        }
                        else if (index%5 == 3) {
                            newBullet.classList.add("bulletMoveL4");
                        }
                        else if (index%5 == 4) {
                            newBullet.classList.add("bulletMoveL5");
                        }
    
                        document.body.appendChild(newBullet);
    
                        newBullet.addEventListener('animationend', function(e){
                            e.currentTarget.remove();
                        });
                    }

                    //observer.observe(newBullet);
                }, timing)
            }

            function createIntervalGunnerTank(index, timing){
                spacesIntervals[index] = setInterval(function(){
                    newBullet = document.createElement("div");
                    newBullet.classList.add("bulletType");
                    newBullet.classList.add("bigBulletStyle");
                    newBullet.style.left = listSpacesQuery[index].getBoundingClientRect().left+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))+"px";
                    newBullet.style.top = listSpacesQuery[index].getBoundingClientRect().top+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))/2+"px";

                    
                    if (index%5 == 0) {
                        newBullet.classList.add("bulletMoveL1");
                    }
                    else if (index%5 == 1) {
                        newBullet.classList.add("bulletMoveL2");
                    }
                    else if (index%5 == 2) {
                        newBullet.classList.add("bulletMoveL3");
                    }
                    else if (index%5 == 3) {
                        newBullet.classList.add("bulletMoveL4");
                    }
                    else if (index%5 == 4) {
                        newBullet.classList.add("bulletMoveL5");
                    }

                    document.body.appendChild(newBullet);

                    newBullet.addEventListener('animationend', function(e){
                        e.currentTarget.remove();
                    });

                    //observer.observe(newBullet);
                }, timing)
            }

            function createIntervalIceTank(index, timing){
                spacesIntervals[index] = setInterval(function(){
                    newBullet = document.createElement("div");
                    newBullet.classList.add("bulletType");
                    newBullet.classList.add("iceBulletStyle");
                    newBullet.style.left = listSpacesQuery[index].getBoundingClientRect().left+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))+"px";
                    newBullet.style.top = listSpacesQuery[index].getBoundingClientRect().top+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))/2+"px";

                    
                    if (index%5 == 0) {
                        newBullet.classList.add("bulletMoveL1");
                    }
                    else if (index%5 == 1) {
                        newBullet.classList.add("bulletMoveL2");
                    }
                    else if (index%5 == 2) {
                        newBullet.classList.add("bulletMoveL3");
                    }
                    else if (index%5 == 3) {
                        newBullet.classList.add("bulletMoveL4");
                    }
                    else if (index%5 == 4) {
                        newBullet.classList.add("bulletMoveL5");
                    }

                    document.body.appendChild(newBullet);

                    newBullet.addEventListener('animationend', function(e){
                        e.currentTarget.remove();
                    });

                    //observer.observe(newBullet);
                }, timing)
            }

            function createIntervalGoldmine(index, timing){
                spacesIntervals[index] = setInterval(function() {
                    currentMoney += 25;
                    moneyCounterDOC.textContent = currentMoney;
                }, timing)
            }

            function createIntervalBullet(_selectedIndex, type) {
                var newBullet = document.createElement("div");
                clearInterval(spacesIntervals[_selectedIndex]);
                if (type == 1) {
                    createIntervalBasicTank(_selectedIndex, relationUpgradeSkills[type][0]);
                }
                else if(type == 2){
                    createIntervalMultiTank(_selectedIndex, relationUpgradeSkills[type][0]);
                    
                }
                else if (type == 5){
                    createIntervalGunnerTank(_selectedIndex, relationUpgradeSkills[type][0]);
                }
                else if (type == 6){
                    createIntervalIceTank(_selectedIndex, relationUpgradeSkills[type][0]);
                }
            }

            const indexSlow = 2;

            var absoluteD = new Date().getTime();

            function animar() {
                document.querySelectorAll(".enemy").forEach(function(virus){
                    document.querySelectorAll(".bulletType").forEach(function(bullet){
                        if (colision(virus, bullet)) {
                            if (bullet.classList.contains("iceBulletStyle") && virus.dataset.slowed == "false"){
                                virus.style.color = "#72E5FF";

                                virus.getAnimations()[0].pause();

                                if (virus.classList.contains("enemyBasic")){
                                    let timeRemaining = (1-virus.getAnimations()[0].effect.getComputedTiming().progress)*parseInt(window.getComputedStyle(virus).animationDuration)*1000;
                                    virus.animate(moveEnemyKeyFrames, {
                                        duration: timeRemaining*indexSlow,
                                    })
                                }
                                else if (virus.classList.contains("enemySlow")){
                                    let timeRemaining = (1-virus.getAnimations()[0].effect.getComputedTiming().progress)*parseInt(window.getComputedStyle(virus).animationDuration)*1000;
                                    virus.animate(moveEnemySlowKeyFrames, {
                                        duration: timeRemaining*indexSlow,
                                    })
                                }
                                else if (virus.classList.contains("enemySuperSlow")){
                                    let timeRemaining = (1-virus.getAnimations()[0].effect.getComputedTiming().progress)*parseInt(window.getComputedStyle(virus).animationDuration)*1000;
                                    virus.animate(moveEnemySlowKeyFrames, {
                                        duration: timeRemaining*(indexSlow-0.5),
                                    })
                                }
                                else if (virus.classList.contains("enemySuperFast")){
                                    let timeRemaining = (1-virus.getAnimations()[0].effect.getComputedTiming().progress)*parseInt(window.getComputedStyle(virus).animationDuration)*1000;
                                    virus.animate(moveEnemyKeyFrames, {
                                        duration: timeRemaining*indexSlow,
                                    });
                                }
                                else if (virus.classList.contains("fa-skull")){
                                    let rectSkull = virus.getBoundingClientRect();
                                    virus.animate(moveEnemySlowKeyFrames, {
                                        duration: (rectSkull.left+(rectSkull.width/2)+200)/((window.innerWidth+200)/45000)*indexSlow
                                    })
                                }
                                virus.dataset.slowed = "true";
                            }
                            if (virus.classList.contains("fa-viruses")) {
                                if (virus.dataset.lifes == 1) {
                                    virus.classList.add("fa-virus");
                                    virus.classList.remove("fa-viruses");
                                    virus.dataset.lifes = 5;
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                                virus.style.color = "#FF7272";
                                setTimeout(function(){
                                    if (virus.dataset.slowed == "true"){
                                        virus.style.color = "#72E5FF";
                                    }
                                    else {
                                        virus.style.color = "black";
                                    }
                                }, 75);
                            }
                            else if (virus.classList.contains("fa-virus") && !virus.classList.contains("enemySuperSlow")){
                                if (virus.dataset.lifes == 1) {
                                    virus.remove();
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                                virus.style.color = "#FF7272";
                                setTimeout(function(){
                                    if (virus.dataset.slowed == "true"){
                                        virus.style.color = "#72E5FF";
                                    }
                                    else {
                                        virus.style.color = "black";
                                    }
                                }, 75);
                            }
                            else if (virus.classList.contains("enemySuperSlow")) {
                                if (virus.dataset.lifes == 1) {
                                    if (parseInt(virus.style.fontSize) > 30) {
                                        virus.style.fontSize = parseInt(virus.style.fontSize)-5+"px";
                                        virus.dataset.lifes = 3;
                                    }
                                    else {
                                        virus.remove();
                                    }
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                            }
                            else if (virus.classList.contains("enemySuperFast")) {
                                if (virus.dataset.lifes == 1) {
                                    virus.remove();
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                                virus.style.color = "#FF7272";
                                setTimeout(function(){
                                    if (virus.dataset.slowed == "true"){
                                        virus.style.color = "#72E5FF";
                                    }
                                    else {
                                        virus.style.color = "black";
                                    }
                                }, 75);
                            }
                            else if (virus.classList.contains("fa-skull")){
                                if (virus.dataset.lifes == 1){
                                    if (virus.dataset.size == 1){
                                        let animationsVirus = virus.getAnimations();
                                        animationsVirus.forEach(function(animation) {
                                            animation.cancel();
                                        });
                                        virus.remove();
                                    }
                                    else {
                                        divideSkull(virus, virus.dataset.size);
                                    }
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                                virus.style.color = "#FF7272";
                                setTimeout(function(){
                                    if (virus.dataset.slowed == "true"){
                                        virus.style.color = "#72E5FF";
                                    }
                                    else {
                                        virus.style.color = "black";
                                    }
                                }, 75);
                            }
                            else{
                                if (virus.dataset.lifes == 1) {
                                    if (parseInt(virus.style.fontSize) > 40) {
                                        virus.style.fontSize = parseInt(virus.style.fontSize)-40+"px";
                                        virus.dataset.lifes = 5;
                                    }
                                    else{
                                        virus.remove();
                                    }
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                                virus.style.color = "#FF7272";
                                setTimeout(function(){
                                    if (virus.dataset.slowed == "true"){
                                        virus.style.color = "#72E5FF";
                                    }
                                    else {
                                        virus.style.color = "black";
                                    }
                                }, 75);
                            }
                            if (bullet.classList.contains("bigBulletStyle")) {
                                if (bullet.getBoundingClientRect().width > 60) {
                                    bullet.style.width = bullet.getBoundingClientRect().width-60+"px";
                                    bullet.style.height = bullet.getBoundingClientRect().height-60+"px";
                                }
                                else {
                                    bullet.remove();
                                }
                            }
                            else {
                                bullet.remove();
                            }
                        }
                    })
                    if (colision(virus, armourSpaceDiv)) {
                        document.querySelectorAll(".armourSub").forEach(function(space, i){
                            if (colision(virus, space) &&  spacesToBuy[i] != 0){
                                if (virus.classList.contains("fa-viruses")){
                                    lifeSpaces[i] -= 2;
                                    virus.remove();
                                }
                                else if(virus.classList.contains("fa-virus") && !virus.classList.contains("enemySuperSlow")){
                                    lifeSpaces[i] -= 1;
                                    virus.remove();
                                }
                                else if(virus.classList.contains("enemySuperFast")){
                                    lifeSpaces[i] -= 3;
                                    virus.remove();
                                }
                                else if(virus.classList.contains("enemySuperSlow")){
                                    if (parseInt(virus.style.fontSize) > lifeSpaces[i]*5) {
                                        virus.style.fontSize = parseInt(virus.style.fontSize) - lifeSpaces[i]*5 + "px";
                                    }
                                    else {
                                        virus.remove();
                                    }
                                    lifeSpaces[i] -= parseInt(virus.style.fontSize)/5;
                                }
                                else if (virus.classList.contains("fa-skull")){
                                    if (parseInt(virus.dataset.lifes) > lifeSpaces[i]) {
                                        virus.dataset.lifes -= lifeSpaces[i];
                                        lifeSpaces[i] = 0;
                                    }
                                    else {
                                        lifeSpaces[i] -= virus.dataset.lifes;
                                        if (virus.dataset.size > 1) {
                                            divideSkull(virus, virus.dataset.size);
                                        }
                                        else {
                                            let animationsVirus = virus.getAnimations();
                                            animationsVirus.forEach(function(animation) {
                                                animation.cancel();
                                            });
                                            virus.remove();
                                        }
                                    }
                                }
                                else {
                                    var lifesVirus = parseInt(virus.style.fontSize)/40;
                                    if (virus.dataset.lifes > lifeSpaces[i]) {
                                        virus.dataset.lifes -= lifeSpaces[i];
                                        lifeSpaces[i] = 0;
                                    }
                                    else {
                                        lifeSpaces[i] -= virus.dataset.lifes;
                                        if (parseInt(virus.style.fontSize) > 40) {
                                            virus.style.fontSize = parseInt(virus.style.fontSize)-40+"px";
                                            virus.dataset.lifes = 5;
                                        }
                                        else {
                                            virus.remove();
                                        }
                                    }
                                    lifeSpaces[i] -= lifesVirus;
                                }

                                var pc_CurrentLife = (lifeSpaces[i]/realtionLifes[spacesToBuy[i]])*100;

                                if (pc_CurrentLife <= 0) {
                                    numBuilt[spacesToBuy[i]]--;
                                    spacesToBuy[i] = 0;
                                    clearInterval(spacesIntervals[i]);
                                    lifeSpaces[i] = NaN;
                                    space.firstChild.firstChild.remove();
                                    space.firstChild.style.background = "transparent";
                                    space.firstChild.textContent = "Buy Space";
                                }
                                else {
                                    var actualGradient = window.getComputedStyle(space.firstChild).backgroundImage;

                                    var newGradient = actualGradient.replace(/rgba\(111, 111, 111, 0.1\) \d+(\.\d+)?%?, rgba\(0, 0, 0, 0\) \d+(\.\d+)?%?/,`rgba(111, 111, 111, 0.1) ${pc_CurrentLife}%, rgba(0, 0, 0, 0) ${pc_CurrentLife}%`);

                                    space.firstChild.style.backgroundImage = newGradient;
                                }
                            }
                        })
                    }
                })
                // Llamar a la prxima animacin
                requestAnimationFrame(animar);
            }

            animar();

            function createNewBasicTank(){
                if (spacesToBuy[selectedIndex] != 1) {
                    if (currentMoney >= 200) {
                        if (numBuilt[1] < limitToBulid[1]) {
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.5;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[1]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", BASICTANK_SRC);
                            newEle.classList.add("structureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_BASIC_TANK;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 200;
                            moneyCounterDOC.textContent = currentMoney;
        
                            spacesToBuy[selectedIndex] = 1;
    
                            createIntervalBullet(selectedIndex, 1);

                            // SHOW LEVEL
                            /*let newLevelTag = document.createElement("div");
                            newLevelTag.classList.add("levelArmourTag");
                            newLevelTag.classList.add("levelTagUp");
                            newLevelTag.textContent = 1;
                            selectedSpace.firstChild.appendChild(newLevelTag);*/

                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You have already built the maximum number of this type of structure!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            function createNewMultiTank(){
                if (spacesToBuy[selectedIndex] != 2){
                    if (currentMoney >= 1000) {
                        if (numBuilt[2] < limitToBulid[2]) {
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.5;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[2]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", MULTITANK_SRC);
                            newEle.classList.add("structureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_MULTI_TANK;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 1000;
                            moneyCounterDOC.textContent = currentMoney;
    
                            spacesToBuy[selectedIndex] = 2;
    
                            createIntervalBullet(selectedIndex, 2);

                            // SHOW LEVEL
                            /*let newLevelTag = document.createElement("div");
                            newLevelTag.classList.add("levelArmourTag");
                            newLevelTag.classList.add("levelTagUp");
                            newLevelTag.textContent = 1;
                            selectedSpace.firstChild.appendChild(newLevelTag);*/
                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You have already built the maximum number of this type of structure!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            function createNewGunnerTank(){
                if (spacesToBuy[selectedIndex] != 5){
                    if (currentMoney >= 500) {
                        if (numBuilt[5] < limitToBulid[5]) {
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.5;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[5]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", GUNNERTANK_SRC);
                            newEle.classList.add("structureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_GUNNER_TANK;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 500;
                            moneyCounterDOC.textContent = currentMoney;
    
                            spacesToBuy[selectedIndex] = 5;
    
                            createIntervalBullet(selectedIndex, 5);
                            
                            // SHOW LEVEL
                            /*let newLevelTag = document.createElement("div");
                            newLevelTag.classList.add("levelArmourTag");
                            newLevelTag.classList.add("levelTagUp");
                            newLevelTag.textContent = 1;
                            selectedSpace.firstChild.appendChild(newLevelTag);*/
                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You have already built the maximum number of this type of structure!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            function createNewIceTank(){
                if (spacesToBuy[selectedIndex] != 6){
                    if (currentMoney >= 400) {
                        if (numBuilt[6] < limitToBulid[6]) {
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.5;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[6]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", ICETANK_SRC);
                            newEle.classList.add("structureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_ICE_TANK;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 400;
                            moneyCounterDOC.textContent = currentMoney;
    
                            spacesToBuy[selectedIndex] = 6;
    
                            createIntervalBullet(selectedIndex, 6);
                            
                            // SHOW LEVEL
                            /*let newLevelTag = document.createElement("div");
                            newLevelTag.classList.add("levelArmourTag");
                            newLevelTag.classList.add("levelTagDown");
                            newLevelTag.textContent = 1;
                            selectedSpace.firstChild.appendChild(newLevelTag);*/
                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You have already built the maximum number of this type of structure!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            function createNewGoldmine(){
                if (spacesToBuy[selectedIndex] != 3){
                    if (currentMoney >= 400) {
                        if (numBuilt[3] < limitToBulid[3]){
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.5;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[3]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", GOLDMINE_SRC);
                            newEle.classList.add("structureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_GOLDMINE;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 400;
                            moneyCounterDOC.textContent = currentMoney;
        
                            spacesToBuy[selectedIndex] = 3;
    
                            clearInterval(spacesIntervals[selectedIndex]);
    
                            createIntervalGoldmine(selectedIndex, relationUpgradeSkills[3][0]);
                            
                            // SHOW LEVEL
                            /*let newLevelTag = document.createElement("div");
                            newLevelTag.classList.add("levelArmourTag");
                            newLevelTag.classList.add("levelTagDown");
                            newLevelTag.textContent = 1;
                            selectedSpace.firstChild.appendChild(newLevelTag);*/
                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You have already built the maximum number of this type of structure!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            function createNewWall(){
                if (spacesToBuy[selectedIndex] != 4){
                    if (currentMoney >= 300) {
                        if (numBuilt[4] < limitToBulid[4]) {
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.5;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[4]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", WALL_SRC);
                            newEle.classList.add("smallStructureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_WALL;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 300;
                            moneyCounterDOC.textContent = currentMoney;
        
                            spacesToBuy[selectedIndex] = 4;
    
                            clearInterval(spacesIntervals[selectedIndex]);
                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You have already built the maximum number of this type of structure!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            var listTimeOutsSpawnBoss = [];

            var controlBossSpawnInterval;
            var bossSpawnCount = 1;
            var lastControlBossSpawn = new Date().getTime();
            function controlBossSpawning(){
                controlBossSpawnInterval = setInterval(function(){
                    var actualTimeBoss = new Date().getTime();
                    if (actualTimeBoss - d >= 400000) {
                        if (actualTimeBoss - lastControlBossSpawn > 200000) {
                            lastControlBossSpawn = actualTimeBoss;
                            for(var i = 10000; i <= bossSpawnCount*10000; i+=10000) {
                                let newTimeOut = new Timer(function() {
                                    spawnVirusBoss(1200);
                                    listTimeOutsSpawnBoss.shift();
                                }, 10000+i);
                                listTimeOutsSpawnBoss.push(newTimeOut);
                            }
                            bossSpawnCount++;

                        }
                    }
                }, 1000);
            }

            function divideSkull(oldSkull, size){
                let rectOldSkull = oldSkull.getBoundingClientRect();

                let posLeftOldSkull = rectOldSkull.left;
                let posTopOldSkull = rectOldSkull.top;

                let widthOldSkull = rectOldSkull.width;
                let heightOldSkull = rectOldSkull.height;

                let posLeftNewSkull = posLeftOldSkull+(widthOldSkull/2);
                let posTopNewSkull1 = posTopOldSkull+(heightOldSkull/4);
                let posTopNewSkull2 = posTopOldSkull+(heightOldSkull*(3/4));

                let timeNewAnimation = (rectOldSkull.left+(rectOldSkull.width/2)+200)/((window.innerWidth+200)/45000);

                let animationsVirus = oldSkull.getAnimations();
                animationsVirus.forEach(function(animation) {
                    animation.cancel();
                }); 

                oldSkull.remove();

                spawnSkull(size-1, posLeftNewSkull, posTopNewSkull1, timeNewAnimation);
                spawnSkull(size-1, posLeftNewSkull, posTopNewSkull2, timeNewAnimation);
                //getRandomInt(window.innerHeight-3*(Math.pow(2, size-1)*40))+1.5*Math.pow(2, size-1)*40
            }

            function spawnSkull(size, posLeft=window.innerWidth+Math.pow(2, size-1)*40/2, posTop=getRandomInt(window.innerHeight-(Math.pow(2, size-1)*40))+0.5*Math.pow(2, size-1)*40, timeAnimation=45000){
                var newSkull = document.createElement("div");
                newSkull.classList.add("enemy");
                newSkull.classList.add("fa-solid");
                newSkull.classList.add("fa-skull");

                let animation = newSkull.animate(moveEnemySlowKeyFrames, {
                    duration: timeAnimation,
                })

                newSkull.style.position = "absolute";
                let sizeSkull = Math.pow(2, size-1)*40;
                newSkull.style.fontSize = sizeSkull+"px";
                newSkull.style.left = posLeft+"px"
                newSkull.style.top = posTop+"px";

                newSkull.dataset.size = size;
                newSkull.dataset.lifes = size;
                newSkull.dataset.slowed = "false";

                document.body.appendChild(newSkull);

                animation.finished.then(function(e) {
                    e.effect.target.remove();
                    endGame();
                });
            }

            function spawnDisease(horde=false, pos=getRandomInt(window.innerHeight-5)+5) {
                if (horde) {
                    for (var i = window.innerHeight/20; i < window.innerHeight; i+=window.innerHeight/10) {
                        spawnDisease(false, i);
                    }
                }
                else {
                    var newVirus = document.createElement("div");
                    newVirus.classList.add("fa-solid");
                    newVirus.classList.add("fa-disease");
                    newVirus.classList.add("enemySuperFast");
                    newVirus.classList.add("fa-4x");
                    newVirus.dataset.lifes = 7;
                    newVirus.dataset.slowed = "false";
                    newVirus.classList.add("enemy");
                    newVirus.style.top = pos + "px";
                    newVirus.style.left = window.innerWidth+40+"px";
                    document.body.appendChild(newVirus);

                    newVirus.addEventListener("animationend", function(evt){
                        currentLifes -= 1;
                        lifesCounterDOC.textContent = currentLifes;
                        if (currentLifes <= 0) {
                            endGame();
                        }
                        evt.currentTarget.remove();
                    });
                }

            }

            var lastBossSpawned = d;

            function spawnVirusBasic(posTop=getRandomInt(window.innerHeight-5)+5, posLeft = window.innerWidth+40, duration=null){
                var newVirus = document.createElement("div");
                newVirus.classList.add("fa-solid");
                newVirus.dataset.lifes = 5;
                newVirus.dataset.slowed = "false";
                newVirus.classList.add("fa-virus");
                newVirus.classList.add("fa-4x");
                newVirus.classList.add("enemyBasic");
                newVirus.style.left = posLeft+"px";

                if(duration != null) {
                    newVirus.style.animationDuration = duration+"s";
                }

                newVirus.classList.add("enemy");
                newVirus.style.top = posTop + "px";

                newVirus.addEventListener("animationend", function(evt){
                    currentLifes -= 1;
                    lifesCounterDOC.textContent = currentLifes;
                    if (currentLifes <= 0) {
                        endGame();
                    }
                    evt.currentTarget.remove();
                });

                document.body.appendChild(newVirus);
            }

            function spawnVirusDouble(posTop=getRandomInt(window.innerHeight-5)+5, posLeft=window.innerWidth+40, duration=null){
                var newVirus = document.createElement("div");
                newVirus.classList.add("fa-solid");
                newVirus.dataset.lifes = 5;
                newVirus.dataset.slowed = "false";

                newVirus.classList.add("fa-viruses");
                newVirus.classList.add("fa-4x");
                newVirus.classList.add("enemyBasic");
                newVirus.style.left = posLeft+"px";
                if(duration != null) {
                    newVirus.style.animationDuration = duration+"s";
                }

                newVirus.classList.add("enemy");
                newVirus.style.top = posTop+"px";

                newVirus.addEventListener("animationend", function(evt){
                    currentLifes -= 2;
                    lifesCounterDOC.textContent = currentLifes;
                    if (currentLifes <= 0) {
                        endGame();
                    }
                    evt.currentTarget.remove();
                });
                document.body.appendChild(newVirus);
            }

            function spawnVirusCovid(posTop=getRandomInt(window.innerHeight-5)+5, posLeft=window.innerWidth+100, duration=null){
                var newVirus = document.createElement("div");
                newVirus.classList.add("fa-solid");
                newVirus.dataset.lifes = 5;
                newVirus.dataset.slowed = "false";

                newVirus.classList.add("fa-virus-covid");
                newVirus.classList.add("enemySlow");
                newVirus.style.fontSize = 200+"px";
                newVirus.style.left = posLeft+"px";

                newVirus.classList.add("enemy");
                newVirus.style.top = posTop+"px";

                if(duration != null) {
                    newVirus.style.animationDuration = duration+"s";
                }

                newVirus.addEventListener("animationend", function(evt){
                    currentLifes -= (parseInt(evt.currentTarget.style.fontSize)/40);
                    lifesCounterDOC.textContent = currentLifes;
                    if (currentLifes <= 0) {
                        endGame();
                    }
                    evt.currentTarget.remove();
                });
                document.body.appendChild(newVirus);
            }


            var pcSpawnVirusType = {
                "boss": 0.2,
                "diseaseH": 0.8,
                "skull": 4,
                "covid": 5,
                "diseaseB": 10,
                "double": 20,
                "basic": 60,
            }

            var psSpawnSkullSize = {
                1: 35,
                2: 30,
                3: 20,
                4: 10,
                5: 5
            }

            function spawnVirusByPc(basic, double, diseaseB, covid, skull, diseaseH, boss, skullSize = undefined, bossSize = undefined, timeAnimation = undefined){
                let totalSumPc = 0;
                let listVirusToTake = [];

                if (basic) {
                    totalSumPc += pcSpawnVirusType["basic"];
                    listVirusToTake.push("basic");
                }
                if (double) {
                    totalSumPc += pcSpawnVirusType["double"];
                    listVirusToTake.push("double");
                }
                if (diseaseB) {
                    totalSumPc += pcSpawnVirusType["diseaseB"];
                    listVirusToTake.push("diseaseB");
                }
                if (covid) {
                    totalSumPc += pcSpawnVirusType["covid"];
                    listVirusToTake.push("covid");
                }
                if (skull) {
                    totalSumPc += pcSpawnVirusType["skull"];
                    listVirusToTake.push("skull");
                }
                if (diseaseH) {
                    totalSumPc += pcSpawnVirusType["diseaseH"];
                    listVirusToTake.push("diseaseH");
                }
                if (boss) {
                    totalSumPc += pcSpawnVirusType["boss"];
                    listVirusToTake.push("boss");
                }

                let NumSpawnNewVirus = Math.random()*totalSumPc;
                let virusSP = false;
                let _index = 0;

                while (!virusSP) {
                    if (NumSpawnNewVirus < pcSpawnVirusType[listVirusToTake[_index]]) {
                        spawnCustomVirus(listVirusToTake[_index], skullSize, bossSize, timeAnimation);
                        virusSP = true;
                    }
                    else {
                        NumSpawnNewVirus -= pcSpawnVirusType[listVirusToTake[_index]];
                        _index++;
                    }
                }

            }


            function spawnVirus(basic, double, diseaseB, covid, skull, diseaseH, boss) {
                if ((Math.random() < pcSpawnVirusType["boss"]/100) && boss) {
                    let currentTimeCheckBoss = new Date().getTime();
                    if (currentTimeCheckBoss - lastBossSpawned > 120000) {
                        spawnVirusBoss(1200);
                        lastBossSpawned = new Date().getTime();
                    }
                }
                
                if ((Math.random() < pcSpawnVirusType["diseaseH"]/100) && diseaseH) {
                    spawnDisease(true);
                }
                else if ((Math.random() < pcSpawnVirusType["skull"]/100) && skull) {
                    if (Math.random()*100 < psSpawnSkullSize[5]) {
                        spawnSkull(5);
                    }
                    else if(Math.random()*100 < psSpawnSkullSize[4]) {
                        spawnSkull(4);
                    }
                    else if(Math.random()*100 < psSpawnSkullSize[3]) {
                        spawnSkull(3);
                    }
                    else if(Math.random()*100 < psSpawnSkullSize[2]){
                        spawnSkull(2);
                    }
                    else {
                        spawnSkull(1);
                    }
                }
                else if ((Math.random() < pcSpawnVirusType["covid"]/100) && covid) {
                    spawnVirusCovid();
                }
                else if ((Math.random() < pcSpawnVirusType["diseaseB"]/100) && diseaseB) {
                    spawnDisease(false);
                }
                else if ((Math.random() < pcSpawnVirusType["double"]/100) && double){
                    spawnVirusDouble();
                }
                else if (basic){
                    spawnVirusBasic();
                }
                else {
                    console.log("No virus spawned");
                }
            }

            function spawnVirusTime(){
                console.log("SpawnVirusTime");
                let currentTime = new Date().getTime();
                if (currentTime - d < 60000) {
                    spawnVirus(true, false, false, false, false, false, false);
                }
                else if (currentTime - d < 120000) {
                    spawnVirus(true, true, false, false, false, false, false);
                }
                else if (currentTime - d < 180000){
                    spawnVirus(true, true, true, false, false, false, false);
                }
                else if (currentTime - d < 240000){
                    spawnVirus(true, true, true, true, false, false, false);
                }
                else if (currentTime - d < 300000){
                    spawnVirus(true, true, true, true, true, false, false);
                }
                else if (currentTime - d < 360000){
                    spawnVirus(true, true, true, true, true, true, false);
                }
                else {
                    spawnVirus(true, true, true, true, true, true, true);
                }
            }

            var intervalVirus;
            function createIntervalSpawnVirus(difficultySpawn){
                intervalVirus = setInterval(function(){
                    spawnVirusTime();
                }, difficultySpawn);
            }


            function spawnVirusBoss(size, animationTime = null){
                var newVirus = document.createElement("div");
                newVirus.classList.add("fa-solid");
                newVirus.classList.add("fa-virus");
                newVirus.classList.add("enemy");
                newVirus.classList.add("enemySuperSlow");
                newVirus.dataset.lifes = 3;
                newVirus.dataset.slowed = "false";

                newVirus.style.fontSize = size+"px";
                newVirus.style.color = "#FF9F9F";

                if (animationTime != null) {
                    newVirus.style.animationDuration = animationTime+"s";
                }

                newVirus.style.top = getRandomInt(window.innerHeight-size)+0.5*size+"px";
                newVirus.style.left =  window.innerWidth+(size/2)+"px";

                newVirus.addEventListener("animationend", function(evt){
                    currentLifes -= parseInt(evt.currentTarget.style.fontSize)/10;
                    lifesCounterDOC.textContent = currentLifes;
                    if (currentLifes <= 0) {
                        endGame();
                    }
                    evt.currentTarget.remove();
                });

                document.body.appendChild(newVirus);
            }
            
            var intervalDifficulty;
            function createDifficultyInterval(diffChange){
                intervalDifficulty = setInterval(function(){
                    if (!gameStatePaused) {
                        clearInterval(intervalVirus);
                        difficultySpawn*=diffChange;
                        createIntervalSpawnVirus(difficultySpawn);
                    }
                }, 10000)
            }

            document.querySelectorAll(".armourSub").forEach(function(ele, i){
                ele.addEventListener("click", function(e){
                    clearBackground();
                    e.currentTarget.style.backgroundColor = "#e0e0e0";
                    bulidSpace(e, i);
                })
                ele.addEventListener("contextmenu", function(e){
                    if (levelsSpaces[i] != 0 && spacesToBuy[i] != 4) {
                        event.preventDefault();

                        upgradeMenu(e, i);
                    }

                })
            })


            var mainMoneyInterval;
            function createMainMoneyInterval(amount){
                mainMoneyInterval = setInterval(function(){
                    currentMoney += amount;
                    moneyCounterDOC.textContent = currentMoney;
                }, 2000);
            }

            var chrono = document.getElementById("mainChrono");
            var chronoInterval;

            var d;

            function startChrono(){
                chronoInterval = setInterval(function(){
                    let currentTime = new Date().getTime();
                    chrono.textContent = (parseFloat(currentTime-d)/1000 + 0.1).toFixed(1).toString();
                }, 100);
            }

            var gameStatePaused = false;

            var timePaused;

            var pausedMainIconDiv = document.getElementById("gamePausedDiv");

            function pauseGame(){
                if (!gameStatePaused && !endGameVar) {

                    pausedMainIconDiv.style.display = "flex";
                    timePaused = new Date().getTime();
                    closeBuyMenu();
                    closeUpgradeMenu();
                    gameStatePaused = true;
                    clearInterval(mainMoneyInterval);
                    clearInterval(chronoInterval);

                    for (var i = 0; i < 30; ++i) {
                        clearInterval(spacesIntervals[i]);
                        clearInterval(spacesIntervals[i]);
                    }

                    for (var i = 0; i < listTimeOutsSpawnBoss.length; i++) {
                        clearTimeout(listTimeOutsSpawnBoss[i]);
                    }

                    if (playingAtLevel) {
                        if (timerLevel != undefined) {
                            timerLevel.pause();
                        }

                        for (var i = 0; i < timeOutsStagesLevel.length; ++i) {
                            timeOutsStagesLevel[i].pause();
                        }

                        clearInterval(intervalSpawning_level);
                        clearInterval(intervalDifficulty_level);
                    }
                    else {
                        clearInterval(intervalVirus);
                        clearInterval(controlBossSpawnInterval);
                    }

                    document.querySelectorAll(".enemy").forEach(function(ele){
                        let animationsVirus = ele.getAnimations();
                        if (animationsVirus.length == 1) {
                            animationsVirus[0].pause();
                        }
                        else {
                            animationsVirus[0].pause();
                            animationsVirus[1].pause();
                        }
                    });

                    document.querySelectorAll(".bulletType").forEach(function(ele){
                        ele.getAnimations()[0].pause();
                    });
                }
            }   

            function reanudeGame(){
                window.removeEventListener("click", reanudeGame);
                window.removeEventListener("contextmenu", reanudeGame);
                if (gameStatePaused && !endGameVar) {

                    for (var i = 0; i < listTimeOutsSpawnBoss.length; i++) {
                        listTimeOutsSpawnBoss[i].resume();
                    }

                    pausedMainIconDiv.style.display = "none";
                    gameStatePaused = false;

                    let currentTimeReanuded = new Date().getTime();

                    d += (currentTimeReanuded-timePaused);

                    createMainMoneyInterval(mainMoneyIntervalToEarn);

                    startChrono();

                    // level

                    if (playingAtLevel) {
                        setSpawningFunction(currentOptionsLevel);

                        controlDifficultyLevel(diffChangeLevel);

                        if (timerLevel != undefined) {
                            timerLevel.resume();
                        }
    
                        timeOutsStagesLevel.forEach(function(e){
                            e.resume();
                        })
                    }
                    else {
                        controlBossSpawning();
                        createIntervalSpawnVirus(difficultySpawn);
                    }


                    document.querySelectorAll(".bulletType").forEach(function(ele){
                        ele.getAnimations()[0].play();
                    });

                    document.querySelectorAll(".enemy").forEach(function(ele){
                        let animationsVirus = ele.getAnimations();
                        if (animationsVirus.length == 1) {
                            animationsVirus[0].play();
                        }
                        else {
                            animationsVirus[1].play();
                        }
                    });

                    for (var i = 0; i < 30; ++i) {
                        if (spacesToBuy[i] == 1) {
                            createIntervalBasicTank(i, timeUpgradeBasicTank[levelsSpaces[i]-1]);
                        }
                        else if (spacesToBuy[i] == 2) {
                            createIntervalMultiTank(i, timeUpgradeMultiTank[levelsSpaces[i]-1]);
                        }
                        else if (spacesToBuy[i] == 3) {
                            createIntervalGoldmine(i, timeUpgradeGoldmine[levelsSpaces[i]-1]);
                        }
                        else if (spacesToBuy[i] == 5) {
                            createIntervalGunnerTank(i, timeUpgradeGunnerTank[levelsSpaces[i]-1]);
                        }
                        else if (spacesToBuy[i] == 6) {
                            createIntervalIceTank(i, timeUpgradeIceTank[levelsSpaces[i]-1]);
                        }
                    }
                }

            }

            
            var stratGameMainDiv = document.getElementById("divPreStartGame");

            var mainMoneyIntervalToEarn = 25;

            // RUN THE GAME

            function startGame(){

                d = new Date().getTime();

                stratGameMainDiv.style.display = "none";

                difficultySpawn = eqDiffIni[currentDiffString];

                createIntervalSpawnVirus(difficultySpawn);

                createDifficultyInterval(eqDiffChange[currentDiffString]);

                createMainMoneyInterval(mainMoneyIntervalToEarn);

                controlBossSpawning();

                startChrono();

                // Pause the game if user left window
                document.addEventListener("visibilitychange", (event) => {
                    if (document.visibilityState != "visible") {
                        pauseGame();
                    } 
                    window.addEventListener("click", reanudeGame);
                    window.addEventListener("contextmenu", reanudeGame);
                });
            }

            // GAME LEVELS

            var playingAtLevel;

            function presentLevel(nameLevel, artisticName, goalTime) {
                let presentationDiv = document.getElementById("presentationLevelDiv");

                let levelName = document.getElementById("levelNum");

                let timeGoalDiv = document.getElementById("levelTimeGoal");

                levelName.textContent = nameLevel+": "+artisticName;

                timeGoalDiv.textContent = goalTime/1000;

                presentationDiv.style.display = "flex";

                presentationDiv.addEventListener("animationend", function(e){
                    e.currentTarget.style.display = "none";
                })

            }

            function levelCompleted(levelName, id){
                if (!endGameVar) {
                    endGameVar = true;
                    closeBuyMenu();
                    closeUpgradeMenu();
                    clearInterval(intervalVirus);
                    clearInterval(mainMoneyInterval);
                    clearInterval(controlBossSpawnInterval);
                    clearInterval(chronoInterval);
                    clearInterval(intervalDifficulty_level);
                    clearInterval(intervalSpawning_level);

                    for (var i = 0; i < listTimeOutsSpawnBoss.length; i++) {
                        clearTimeout(listTimeOutsSpawnBoss[i]);
                    }

                    for (var i = 0; i < 30; ++i) {
                        clearInterval(spacesIntervals[i]);
                    }
                    document.querySelectorAll(".enemy").forEach(function(ele){
                        ele.remove();
                    })
                    gameOverDiv.style.display = "contents";
                    diffGameOver.style.display = "none";
                    gameOverOrNewRecord.textContent = levelName+" Completed!";
                    timeResisted.style.display = "none";

                    if (localStorage.getItem("level"+id+"_completed") == undefined) {
                        localStorage.setItem("level"+id+"_completed", true);
                    }

                }
            }

            function spawnCustomVirus(type, skullSize=undefined, bossSize=undefined, timeAnimation=undefined) {
                if (type == "basic"){
                    spawnVirusBasic(undefined, undefined, timeAnimation);
                }
                else if (type == "double"){
                    spawnVirusDouble(undefined, undefined, timeAnimation);
                }
                else if (type == "covid"){
                    spawnVirusCovid(undefined, undefined, timeAnimation);
                }
                else if (type == "diseaseB"){
                    spawnDisease(false);
                }
                else if (type == "diseaseH"){
                    spawnDisease(true);
                }
                else if (type == "skull"){
                    if (skullSize != undefined) {

                        let totalPCSkull = 0;

                        for (var i = 0; i < skullSize.length; i++) {
                            totalPCSkull+=psSpawnSkullSize[skullSize[i]];
                        }

                        let NumSpawnNewSkull = Math.random()*totalPCSkull;
                        let skullSP = false;
                        let _index = 0;

                        while (!skullSP) {
                            if (NumSpawnNewSkull < psSpawnSkullSize[skullSize[_index]]) {
                                spawnSkull(skullSize[_index], undefined, undefined, timeAnimation);
                                skullSP = true;
                            }
                            else {
                                NumSpawnNewSkull -= psSpawnSkullSize[skullSize[_index]];
                                _index++;
                            }
                        }


                    }
                    else {
                        if (Math.random()*100 < psSpawnSkullSize[5]) {
                            spawnSkull(5, undefined, undefined, timeAnimation);
                        }
                        else if(Math.random()*100 < psSpawnSkullSize[4]) {
                            spawnSkull(4, undefined, undefined, timeAnimation);
                        }
                        else if(Math.random()*100 < psSpawnSkullSize[3]) {
                            spawnSkull(3, undefined, undefined, timeAnimation);
                        }
                        else if(Math.random()*100 < psSpawnSkullSize[2]){
                            spawnSkull(2, undefined, undefined, timeAnimation);
                        }
                        else{
                            spawnSkull(1, undefined, undefined, timeAnimation);
                        }
                    }
                }
                else if (type == "boss"){
                    if (bossSize != undefined) {
                        spawnVirusBoss(bossSize, timeAnimation);
                    }
                    else {
                        spawnVirusBoss(1200, timeAnimation);
                    }
                }
            }

            /*
            var newLevelOptions = {
                indexLevel
                nameLevel
                goalTime
                virusTimeline
                iniDiffSpawn
                changeDiffSpawn
                money
                moneyIntervalEarned
            }

            var spawnTypeLvl = {
                typeBasic: bool
                typeDouble: bool
                typeCovid: bool
                typeDiseaseB: bool
                typeDiseaseH: bool
                typeSkull: bool
                typeBoss: bool
            }

            var params = {
                skullSize: list
                bossSize: int
                timeAnimation: int
            }


            var options = {
                uniqueType: bool
                typeUnique: string
                params: type
                diffSpawn: int (miliseconds)
                spawn: spawnTypeLvl
            }
            */

            var intervalSpawning_level;
            var intervalDifficulty_level
            var diffChangeLevel;

            function controlDifficultyLevel(diffChange){
                intervalDifficulty_level = setInterval(function(){
                    if (!gameStatePaused) {
                        clearInterval(intervalSpawning_level);
                        difficultySpawn*=diffChange;
                        setSpawningFunction(currentOptionsLevel);
                    }
                }, 10000)
            }

            function setSpawningFunction(options){
                let diffSpawning;
                if (options.diffSpawn == 0 || options.fixedSP == false){
                    diffSpawning = difficultySpawn;
                }
                else {
                    diffSpawning = options.diffSpawn;
                }
                console.log("Time",diffSpawning);
                intervalSpawning_level = setInterval(function(){
                    if (options.uniqueType){
                        spawnCustomVirus(options.typeUnique, options.params.skullSize, options.params.bossSize, options.params.timeAnimation);
                    }
                    else {
                        spawnVirusByPc(options.spawn.typeBasic, options.spawn.typeDouble, options.spawn.typeDiseaseB, options.spawn.typeCovid, options.spawn.typeSkull, options.spawn.typeDiseaseH, options.spawn.typeBoss, options.params.skullSize, options.params.bossSize, options.params.timeAnimation);
                    }
                }, diffSpawning)

            }

            var timerLevel;
            var timeOutsStagesLevel = [];
            var currentOptionsLevel;

            /*

            var newLevelOptions = {
                indexLevel
                nameLevel
                goalTime
                virusTimeline
                iniDiffSpawn
                changeDiffSpawn
                money
                moneyIntervalEarned
            }

            */

            var currentLVLName;

            function newLevel(newLevelOptions) {

                stratGameMainDiv.style.display = "none";

                playingAtLevel = true;

                presentLevel(newLevelOptions.nameLevel, newLevelOptions.artisticName, newLevelOptions.goalTime);

                currentLVLName = newLevelOptions.nameLevel;

                if (newLevelOptions.money != null) {
                    currentMoney = newLevelOptions.money;
                    moneyCounterDOC.textContent = currentMoney;
                }

                mainMoneyIntervalToEarn = newLevelOptions.moneyIntervalEarned;

                setTimeout(function(){
                    // Pause the game if user left window
                    document.addEventListener("visibilitychange", (event) => {
                        if (document.visibilityState != "visible") {
                            pauseGame();
                        } 
                        window.addEventListener("click", reanudeGame);
                        window.addEventListener("contextmenu", reanudeGame);
                    });

                    // TO DO

                    timerLevel = new Timer(function() {
                        if (!endGameVar) {
                            levelCompleted(newLevelOptions.nameLevel, newLevelOptions.id); // HERE LEVEL COMPLETED FUNCTION
                        }
                    }, newLevelOptions.goalTime);

                    console.log(newLevelOptions);

                    startChrono();
                    d = new Date().getTime();

                    controlDifficultyLevel(newLevelOptions.changeDiffSpawn);

                    diffChangeLevel = newLevelOptions.changeDiffSpawn;

                    difficultySpawn = newLevelOptions.iniDiffSpawn;

                    createMainMoneyInterval(mainMoneyIntervalToEarn);

                    // LEVEL STAGES AND FUNCTION SPAWNING
                    
                    Object.keys(newLevelOptions.virusTimeline).forEach(function(key){
                        if (key == 0) {
                            if (newLevelOptions.virusTimeline[key].setDiffSpawnGlobal) {
                                difficultySpawn = newLevelOptions.virusTimeline[key].diffSpawn;
                            }
                            setSpawningFunction(newLevelOptions.virusTimeline[key]);
                            currentOptionsLevel = newLevelOptions.virusTimeline[key];
                        }
                        else {
                            let levelSingleTimeout = new Timer(function(){
                                if (newLevelOptions.virusTimeline[key].setDiffSpawnGlobal) {
                                    difficultySpawn = newLevelOptions.virusTimeline[key].diffSpawn;
                                }
                                currentOptionsLevel = newLevelOptions.virusTimeline[key];
                                clearInterval(intervalSpawning_level);
                                setSpawningFunction(newLevelOptions.virusTimeline[key]);
                            }, (key/100)*newLevelOptions.goalTime);
                            console.log((key/100)*newLevelOptions.goalTime);
                            timeOutsStagesLevel.push(levelSingleTimeout);
                        }
                    })


                }, 4000)
            }


        </script>
    </body>
    <!--Copyright Alex Mangues Rubia 2024-->
</html>
