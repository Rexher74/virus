<!DOCTYPE html>
<html>
    <head>
        <!--Copyright Alex Mangues Rubia 2024-->
        <!--Font Awesome by Dave Gandy - http://fontawesome.io-->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
        <title>Virutz</title>
        <style>
            html{
                margin: 0;
            }
            body {
                overflow: hidden;
                margin: 0;

            }
                        /* width */
            ::-webkit-scrollbar {
                width: 10px;
            }
            
            /* Track */
            ::-webkit-scrollbar-track {
                background: #f1f1f1; 
            }
            
            /* Handle */
            ::-webkit-scrollbar-thumb {
                background: #888; 
            }
            
            /* Handle on hover */
            ::-webkit-scrollbar-thumb:hover {
                background: #555; 
            }
            .alertRed {
                position: absolute;
                top: 20px;
                padding: 8px;
                background-color: #f44336;
                border-radius: 10px;
                color: white;
                display: none;
                font-family: "Raleway", sans-serif;
            }

            .closeGameOverDiv{
                position: absolute;
                top: 25px;
                right: 25px;
                margin-left: 15px;
                color: white;
                font-weight: bold;
                float: right;
                font-size: 50px;
                line-height: 20px;
                cursor: pointer;
                transition: 0.3s;
            }
              
            .closebtnAlertRed {
                margin-left: 15px;
                color: white;
                font-weight: bold;
                float: right;
                font-size: 22px;
                line-height: 20px;
                cursor: pointer;
                transition: 0.3s;
            }
              
            .closebtnAlertRed:hover {
                color: black;
            }

            #armourSpace{
                height: 87.5vh;
                font-size: 0;
            }
            .armourSub{
                visibility: hidden;
                aspect-ratio: 1/1;
                height: 16.1%;
                border: 3px solid rgba(0, 0, 0, 0.05);
                border-radius: 10px;
                box-sizing: border-box;
                display: inline-flex;
                text-align: center;
                font-family: "Raleway", sans-serif;
                font-size: 125%;
                margin: 0.3%;
                cursor: pointer;;
                color: rgba(0, 0, 0, 0);
                transition: color .2s, border .2s;
            }

            .armourSub:hover{
                color: rgba(0, 0, 0, 0.2);
                border: 3px solid rgba(0, 0, 0, 0.2);
            }

            .dataPlayer{
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                text-align: center;
                font-size: 24px;
                font-family: "Raleway", sans-serif;
                margin-top: 10px;
                font-weight: 600;
                z-index: 100000;
            }

            .habilitiesPlayerDiv{
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                text-align: center;
                bottom: 10px;
            }

            .newHabilityDiv{
                position: relative;
                font-family: "Raleway", sans-serif;
                font-weight: 600;
                font-size: 20px;
                margin-right: 10px;
                cursor: pointer;
                border-radius: 2px;
                background-color: #00bbff;
                color: white;
                padding: 7px;
                border-radius: 10px;
                z-index: 1000;
            }

            .mainMenuOperations{
                position: static;
                width: 100vw;
                height: 100vh;
                display: none;
                justify-content: center;
                align-items: center;
                opacity: 0;
            }

            #divOptions{
                width: 950px;
                height: 300px;
            }

            .divOptionsMainMenu{
                background-color: rgba(0, 0, 0, .2);
                border-radius: 50px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                display: flex;
                flex-wrap: wrap;
                align-items: center;
                justify-content: space-evenly;
                z-index: 100;
            }

            .moneyText{
                font-family: "Raleway", sans-serif;
                font-size: 90%;
                display: block;
                width: 100%;
                text-align: center;
                color:rgba(0, 0, 0, 0.7);
                font-weight: 700;
                margin-top: 10%;
            }

            .structureOwned{
                width: 95%;
                vertical-align: middle;
            }

            .smallStructureOwned{
                width: 80%;
                vertical-align: middle;
            }

            .bulletStyle{
                position: absolute;
                border-radius: 100%;
                width: 5vh;
                height: 5vh;
                background-color: rgba(119, 101, 255, 0.8);
                transform: translate(-50%, -50%);
            }

            .bulletStyleMax{
                position: absolute;
                border-radius: 100%;
                width: 7.5vh;
                height: 7.5vh;
                background-color: rgba(119, 101, 255, 0.8);
                transform: translate(-50%, -50%);
            }

            .bulletStyleMaxSmall{
                position: absolute;
                border-radius: 100%;
                width: 3.55vh;
                height: 3.55vh;
                background-color: rgba(119, 101, 255, 0.8);
                transform: translate(-50%, -50%);
            }

            .bigBulletStyle{
                position: absolute;
                border-radius: 100%;
                background-color: rgba(119, 101, 255, 0.8);
                width: 13vh;
                height: 13vh;
                transform: translate(-50%, -50%);
            }

            .iceBulletStyle{
                position: absolute;
                border-radius: 100%;
                background-color: rgba(101, 209, 255, 0.8);
                width: 9.5vh;
                height: 9.5vh;
                transform: translate(-50%, -50%);
            }

            .bulletMoveL1{
                animation: moveBullet 4s linear;
            }
            .bulletMoveL2{
                animation: moveBullet 3.7s linear;
            }
            .bulletMoveL3{
                animation: moveBullet 3.4s linear;
            }
            .bulletMoveL4{
                animation: moveBullet 3.1s linear;
            }
            .bulletMoveL5{
                animation: moveBullet 2.8s linear;
            }
            .moveBulletSpull{
                animation: moveBulletSpullAnimation  4.3s linear;
            }

            .enemyBasic{
                position: absolute;
                animation: moveEnemy 55s linear;
            }

            .enemySlow{
                position: absolute;
                animation: moveEnemySlow 65s linear;
            }

            .enemySuperSlow{
                position: absolute;
                animation: moveEnemySlow 240s linear;
            }

            .enemySuperFast{
                position: absolute;
                animation: moveEnemy 17s linear;
            }

            .enemy{
                z-index: 99;
                pointer-events: none;
                transform: translate(-50%, -50%);
            }
            

            .gradientLifesSpace{
                width: 100%;
                height: 100%;
                border-radius: inherit;
                background: transparent;
                font-weight: 500;
            }

            #divOptionsUpgrade{
                width: 500px;
                height: 300px;
                flex-direction: column !important;
            }

            .title-text{
                font-family: "Raleway", sans-serif;
                font-size: 35px;
                font-weight: 700;
                text-align: center;
            }

            #buttonUpgrade{
                display: none;
                padding: 15px;
                background-color: rgb(32, 148, 34);
                border-radius: 20px;
                color: white;
                font-family: "Raleway", sans-serif;
                font-size: 30px;
                font-weight: 700;
                cursor: pointer;
                transition: background .2s, padding .2s;
            }

            #buttonUpgrade:hover{
                background-color: rgb(18, 94, 19);
                padding: 18.5px;
            }

            #gameOverDiv{
                width: 100vw;
                height: 100vh;
                display: none;
            }

            #gameOverSubDiv{
                width: 600px;
                height: 200px;
                background-color: rgba(0, 0, 0, .2);
                border-radius: 50px;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                display: flex;
                flex-direction: column;
                flex-wrap: wrap;
                align-items: center;
                justify-content: center;
                z-index: 100;
                padding: 30px;
                font-family: "Raleway", sans-serif;
                font-size: 40px;
                font-weight: 700;
            }

            .divFreezeAllAnimation{
                position: absolute;
                top: 0;
                left: -100vw;
                height: 100vh;
                width: 100vw;
                animation: freezeAnimationDiv 0.5s linear;
                background: linear-gradient(to right, rgba(255, 255, 255, 0), rgba(0, 166, 255, 0.3), rgba(255, 255, 255, 0));
            }

            #mainChronoDiv{
                font-family: "Raleway", sans-serif;
                font-size: 25px;
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                text-align: center;
                font-weight: 800;
                bottom: 1.5vh;
                z-index: 10000;
            }

            #mainAlertNoBuyDiv{
                font-family: "Raleway", sans-serif;
                font-size: 25px;
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                text-align: center;
                font-weight: 800;
                bottom: 10vh;
                z-index: 10000;
            }

            #divPreStartGame{
                position: absolute;
                width: 100vw;
                height: 100vh;
                z-index: 1001;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: rgba(185, 185, 185, 0.2);
            }

            #divPresentationGame{
                padding: 30px;
                border-radius: 20px;
                background-color: rgb(200, 200, 200);
                min-width: 35vw;
            }

            #mainTitleStartGame{
                font-family: "Raleway", sans-serif;
                font-size: 45px;
                font-weight: 700;
                text-align: center;
                margin-bottom: 10px;     
            }

            #instructionsSetStartGame{
                font-family: "Raleway", sans-serif;
            }

            #instructionsMain{
                font-size: 18px;
                line-height: 170%;
                max-height: 25vh;
                overflow-y: auto;
                padding-right: 10px;
            }

            #buttonPlayStartGame{
                background: rgb(32, 71, 137);
                font-size: 30px;
                color: white;
                transition: background .2s;
                cursor: pointer;
                width: 100px;
                border-radius: 30px;
                padding: 17.5px;
                text-align: center;
                margin: auto;
                margin-top: 20px;
                font-weight: 900;
            }

            #buttonPlayStartGame:hover{
                background: rgb(13, 40, 85);
            }

            #selectDifficultyDiv{
                width: 100%;
                border-radius: 10px;
                display: flex;
                margin-top: 20px;
            }

            .optionDifficulty{
                width: 20%;
                text-align: center;
                padding: 12.5px;
                box-sizing: border-box;
                font-size: 17px;
                font-weight: 600;
                cursor: pointer;
                display: flex;
                align-content: center;
                justify-content: center;
                flex-wrap: wrap;
                min-width: 100px;
                transition: font-weight .3s;
            }

            .difficultySelectedOptn{
                border: 4px solid black;
                font-weight: 900;
            }

            #difficultyModeGameOver{
                font-size: 24px;
                font-weight: 600;
                font-style: italic;
            }

            #instructionsHeader{
                font-size: 27.5px;
                font-weight: 700;
            }

            #gamePausedDiv{
                position: absolute;
                display: none;
                width: 100vw;
                height: 100vh;
                background: rgba(0,0,0,.3);
                justify-content: center;
                align-items: center;
                flex-direction: column;
            }

            .basicText{
                font-family: "Raleway", sans-serif;
                font-size: 25px;
                font-weight: 700;
            }

            /*.levelTagUp {
                bottom: 20%;
            }

            .levelTagDown {
                bottom: 17.5%;
            }

            .levelArmourTag{
                position: relative;
                left: 10%;
                transform: translateX(-50%);
                background-color: #8b8b8b00;
                padding: 5px;
                width: 10%;
                line-height: 100%;
                font-size: 15px;
                margin: auto;
                color: rgba(0, 0, 0, 0.5);
                font-family: "Raleway", sans-serif;
                font-weight: 700;
                border-radius: 50%;
            }*/

            .leaderboardUser {
                position: absolute;
                top: 20px;
                right: 20px;
                font-size: 45px;
                color: rgb(135 135 135);
                cursor: pointer;
            }

            #userBestMarksDiv{
                position: relative;
                display: none;
                padding: 50px;
                background-color: rgb(200, 200, 200);
                border-radius: 10px;
            }

            #playByLevelDiv{
                position: relative;
                display: none;
                padding: 50px;
                background-color: rgb(200, 200, 200);
                border-radius: 10px;
            }

            #box-levels{
                max-height: 45vh;
                overflow: auto;
                padding: 25px;
            }

            .titleUserBestMarks{
                text-align: center;
                margin-bottom: 20px;
                font-size: 50px;
                font-family: "Raleway", sans-serif;
                font-weight: 700;
            }

            .difficultylevelBestMarks{
                font-size: 30px;
                font-family: "Raleway", sans-serif;
                font-weight: 500;
                line-height: 175%;
            }

            .newLevelToShowUser {
                padding: 10px;
                font-size: 27.5px;
                font-family: "Raleway", sans-serif;
                font-weight: 600;
                line-height: 175%;
                border-radius: 20px;
                cursor: pointer;
                transition: background .3s, padding .3s;
                margin-bottom: 10px;
            }

            .newLevelToShowUser:hover {
                background: rgb(110, 110, 110, .3);
                padding: 17px;
            }

            .xMark_top_right{
                position: absolute;
                top: 5%;
                right: 5%;
                font-size: 25px;
                cursor: pointer;
            }

            #presentationLevelDiv{
                position: absolute;
                width: 100vw;
                height: 100vh;
                left: -100vw;
                background: transparent;
                animation: presenNewtLevel cubic-bezier(0,1,1,0) 4s;
                display: none;
                align-items: center;
                justify-content: center;
                flex-direction: column;
                font-family: "Raleway", sans-serif;
                font-weight: 700;
            }

            #playByLevelOptionDiv{
                margin-top: 15px;
                margin-bottom: 15px;
                font-size: 20px;
                font-weight: 800;
                cursor: pointer;
                display: flex;
                align-items: center;
                padding: 10px;
                background: #798b9f;
                border-radius: 10px;
                width: fit-content;
                transition: background .3s, border-radius .3s;
            }

            #playByLevelOptionDiv:hover{
                background: #566471;
                border-radius: 20px;
            }

            .newInfoDataLevel{
                padding: 0 10px;
                font-family: "Raleway", sans-serif;
                font-size: 20px;
            }

            .buttonOpenLevel{
                background: rgb(32, 71, 137);
                font-size: 20px;
                color: white;
                transition: background .2s, font-size .3s;
                cursor: pointer;
                border-radius: 30px;
                padding: 17.5px;
                text-align: center;
                margin: auto;
                margin: 20px 0;
                font-weight: 900;
            }

            .buttonOpenLevel:hover{
                background: rgb(13, 40, 85);
                font-size: 24px;
            }

            #sellButtonUpgrade{
                position: absolute;
                top: 7.5%;
                left: 5.5%;
                width: fit-content;
                padding: 10px;
                background: #e44e43;
                font-family: "Raleway", sans-serif;
                font-size: 20px;
                border-radius: 10px;
                font-weight: 700;
                cursor: pointer;
                transition: background .2s, padding .2s;
            }

            #sellButtonUpgrade:hover{
                background: #9c261d;
                padding: 13.5px;
            }

            .imgBuyInSpace{
                transition: transform .3s;
                height: 67.5%;
            }

            .imgBuyInSpace:hover{
                transform: scale(1.1);
                cursor: dragged;
            }

            .bulletType {
                pointer-events: none;
            }

            #notSmatphoneYet{
                top: 0;
                left: 0;
                position: absolute;
                width: 100vw;
                height: 100vh;
                justify-content: center;
                flex-direction: column;
                font-family: "Raleway", sans-serif;
                font-size: 24px;
                padding: 10%;
                box-sizing: border-box;
                z-index: 10000;
                background-color: #d2fdff;
                font-weight: 500;
                line-height: 150%;
                display: none;
            }

            #menuOperationsUser{
                width: 100vw;
                height: 12.5vh;
                background-image: url("https://static.vecteezy.com/system/resources/thumbnails/006/550/927/small/realistic-texture-pattern-of-dark-wood-background-vector.jpg");
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 0.5%;
                box-sizing: border-box;
                position: relative;
                z-index: 1000;
            }

            #purchaseStructureMO{
                max-width: 45vw;
                width: 60%;
                height: 100%;
                overflow-x: auto;
                overflow-y: none;
                display: flex;
                align-items: center;
                overflow-y: hidden;
            }

            .optnToBuyMiniDiv{
                height: inherit;
                box-sizing: border-box;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                margin: 0 5px;
            }

            .dragged-img:hover{
                cursor: move;
            }

            .draggable {
                width: 100px;
                height: 50px;
                background-color: #3498db;
                color: #fff;
                text-align: center;
                line-height: 50px;
                position: absolute;
                cursor: grab;
            }
            
            .dragging {
                z-index: 1000;
                cursor: grabbing;
            }

            #menuSpellsUser{
                height: 100%;
                overflow-x: auto;
                overflow-y: hidden;
                display: flex;
                align-items: center;
                margin-right: 15px;
            }

            .elixirText{
                font-family: "Raleway", sans-serif;
                font-size: 90%;
                display: block;
                width: 100%;
                text-align: center;
                font-weight: 800;
                margin-top: 10%;
                color: rgb(85, 14, 123);
            }

            #alertNotEnoughMoney{
                font-size: 16px;
                transform: translate(-50%, -50%);
                width: 180px;
            }

            .snowFlakeAnimation{
                position: absolute;
                font-size: 15vh;
                left: -15vh;
                color:#3498db;
                animation: snowFlakeMove 1s linear;
                z-index: 1000;
            }

            .mainFireSpell{
                position: absolute;
                font-size: 10vh;
                background-color: rgb(255, 127, 127);
                border-radius: 50%;
                padding: 15px;
                transform: translate(-50%, -50%);
                box-sizing: border-box;
                opacity: 0;
                animation: fadeIn .3s linear forwards;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }
                to {
                    opacity: 1;
                }
            }

            @keyframes snowFlakeMove {
                100% { transform: translateX(calc(100vw + 15vh)); }
            }

            @keyframes presenNewtLevel {
                100% { transform: translateX(200vw) }
            }

            @keyframes freezeAnimationDiv {
                100% { transform: translateX(200vw); }
            }

            @keyframes moveBullet {
                100% { left: 106.5vw; }
            }

            @keyframes moveBulletSpullAnimation {
                100% { left: 104vw; }
            }

            @keyframes moveEnemy {
                100% { left: -6vw }
            }

            @keyframes moveEnemySlow {
                100% { left: -12.5vw }
            }

            @media screen and (max-height: 850px) {
                #instructionsMain{
                    font-size: 16px;
                }
            }

            @media screen and (max-height: 730px) {
                #instructionsMain{
                    font-size: 15px;
                }

                #mainTitleStartGame{
                    font-size: 40px;
                }

                #instructionsHeader{
                    font-size: 22.5px;
                }

                .optionDifficulty{
                    font-size: 15px;
                }
                .imgBuyInSpace{
                    height: 62.5%;
                }
                .moneyText{
                    font-size: 75%;
                }
            }

        </style>
    </head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RFZM98L10H"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'G-RFZM98L10H');
    </script>
    <body>
        <div id="presentationLevelDiv">
            <span id="levelNum" style="font-size: 50px;"></span>
            <span id="resist-time-present-level" style="font-size: 35px;">Resist <span id="levelTimeGoal"></span> seconds</span>
        </div>
        <div id="gamePausedDiv"><i class="fa-solid fa-pause" style="font-size: 80px;"></i><br><span class="basicText">Click anywhere to resume the game</span></div>
        <div id="divPreStartGame">
            <i id="leaderBoardUserBestMarksIcon" class="fa-solid fa-ranking-star leaderboardUser" onclick="showBestMarksUser()"></i>

            <div id="userBestMarksDiv">
                <i id="xMark_userBestMarks" class="fa-solid fa-circle-xmark xMark_top_right" onclick="closeBestMarkUserMenu()"></i>
                <div class="titleUserBestMarks">Best Marks</div>
                <div class="difficultylevelBestMarks"><span style="font-weight: 700; font-style: italic;">Elementary: </span><span id="bestMarkElementary"></span></div>
                <div class="difficultylevelBestMarks"><span style="font-weight: 700; font-style: italic;">Easy: </span><span id="bestMarkEasy"></span></div>
                <div class="difficultylevelBestMarks"><span style="font-weight: 700; font-style: italic;">Normal: </span><span id="bestMarkNormal"></span></div>
                <div class="difficultylevelBestMarks"><span style="font-weight: 700; font-style: italic;">Hard: </span><span id="bestMarkHard"></span></div>
                <div class="difficultylevelBestMarks"><span style="font-weight: 700; font-style: italic;">Impossible: </span><span id="bestMarkImpossible"></span></div>
            </div>

            <div id="playByLevelDiv">
                <i id="xMark_playByLevel" class="fa-solid fa-circle-xmark xMark_top_right" onclick="closeLevelsUserMenu()"></i>
                <div class="titleUserBestMarks">Choose Level</div>
                <div id="box-levels">
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                    <div class="newLevelToShowUser"></div>
                    <div class="newInfoDataLevel">
                        <div></div>
                        <div></div>
                        <div></div>
                        <div class="buttonOpenLevel">Play</div>
                    </div>
                </div>
            </div>

            <div id="divPresentationGame">
                <div id="mainTitleStartGame"><i class="fa-solid fa-virus"></i> Virutz <i class="fa-solid fa-virus"></i></i></div>
                <div id="instructionsSetStartGame">
                    <span id="instructionsHeader">How to Play <i id="arrowDownInstructions" style="cursor: pointer; font-size: 20px;" class="fa-solid fa-chevron-down" onclick="toggleInstructions()"></i></span>
                    <div id="instructionsMain" style="display: none">
                        <strong>Objective:</strong> eliminate viruses and resist as long as possible.<br>
                        To do this, you can buy six types of structures:<br>
                        BASIC TANK ( <i class="fa-solid fa-heart"></i> 2/<i class="fa-solid fa-sack-dollar"></i> 200 ): <i>Shoots bullets one at a time.</i><br>
                        ICE TANK ( <i class="fa-solid fa-heart"></i> 1/<i class="fa-solid fa-sack-dollar"></i> 400 ): <i>Slows down viruses and harms them.</i><br>
                        GUNNER TANK ( <i class="fa-solid fa-heart"></i> 3/<i class="fa-solid fa-sack-dollar"></i> 500 ): <i>Fires large bullets that split.</i><br>
                        MULTI TANK ( <i class="fa-solid fa-heart"></i> 4/<i class="fa-solid fa-sack-dollar"></i> 1000 ): <i>Shoots bullets three at a time.</i><br>
                        ELIXIR MINE( <i class="fa-solid fa-heart"></i> 1/<i class="fa-solid fa-sack-dollar"></i> 400 ): <i>Gives you 10 elixir every 6 seconds.</i><br>
                        GOLDMINE( <i class="fa-solid fa-heart"></i> 2/<i class="fa-solid fa-sack-dollar"></i> 400 ): <i>Gives you 25$ every 2 seconds.</i><br>
                        WALL( <i class="fa-solid fa-heart"></i> 6/<i class="fa-solid fa-sack-dollar"></i> 300 ): <i>Prevent viruses from passing.</i><br>

                        <br style="margin-top: 2em; display: inline-block; content: '';">You can also use spells to defeat viruses, there are 4 types:<br>
                        FIRE BOMB( 500 <i class="fa-solid fa-droplet"></i> ): <i>Spawns fire on the floor.</i><br>
                        WINTER STORM ( 800 <i class="fa-solid fa-droplet"></i> ): <i>Slows all enemies.</i><br>
                        FREEZING ICE ( 400 <i class="fa-solid fa-droplet"></i> ): <i>Freezes enemies for 10 seconds.</i><br>
                        EXTRA BULLET ( 175 <i class="fa-solid fa-droplet"></i> ): <i>Throws packs of bullet.</i><br>

                        <br style="margin-top: 2em; display: inline-block; content: '';">There are also several type of viruses, each one with their own<br>
                        lives, damage, and speed. Play games to discover them!<br>

                        <br style="margin-top: 2em; display: inline-block; content: '';">Remember, you earn an extra $25 every 2 seconds and can<br>
                        upgrade structures by right-clicking, with a maximum level of 7.<br>Also remember you can pause the game by leaving this window.<br>
                    </div>
                    <div id="playByLevelOptionDiv" onclick="displayLevels()">Play by Level</div>
                    <div id="selectDifficultyDiv">
                        <div id="elementaryDifficultyDiv" class="optionDifficulty" style="background-color:rgb(0 191 198); border-top-left-radius: 10px; border-bottom-left-radius: 10px;">Elementary</div>
                        <div id="easyDifficultyDiv" class="optionDifficulty" style="background-color:rgb(122, 191, 47)">Easy</div>
                        <div id="normalDifficultyDiv" class="optionDifficulty difficultySelectedOptn" style="background-color:rgb(236, 200, 55)">Normal</div>
                        <div id="hardDifficultyDiv" class="optionDifficulty" style="background-color:rgb(246, 127, 127)">Hard</div>
                        <div id="impossibleDifficultyDiv" class="optionDifficulty" style="background-color:rgb(170, 0, 0); color: white; border-top-right-radius: 10px; border-bottom-right-radius: 10px;">Impossible</div>
                    </div>
                    <div id="buttonPlayStartGame" onclick="startGame()">PLAY</div>
                </div>
            </div>
        </div>
        <!--<div id="selectBulid" class="mainMenuOperations">
            <div id="divOptions" class="divOptionsMainMenu">
                <i id="xmark_close_buy" class="fa-solid fa-xmark fa-2x" style="position:absolute; top: 20px; right: 20px;color:rgb(132, 132, 132); cursor: pointer;"></i>
            
                TO BUY
                <div id="alertNotEnoughMoney" class="alertRed">
                    <span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span> 
                    Not Enough Money!
                </div>
                <div class="optnToBuyMiniDiv"><img id="buyBasicTank" class="imgBuyInSpace" style="width: 150px; cursor: pointer" src="https://preview.redd.it/vq62mhb27q521.png?width=281&format=png&auto=webp&s=9aaf5903544521d61590959a4aa89109c13431f3"><span class="moneyText">200$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyIceTank"  class="imgBuyInSpace" style="width: 115px; cursor: pointer;" src="https://preview.redd.it/tjaa7j118q521.png?width=293&format=png&auto=webp&s=ad9dcc5b342d5b8f10f169d677a54c91f29424cc"><span class="moneyText">400$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyGunnerTank" class="imgBuyInSpace" style="width: 150px; cursor: pointer;" src="https://mblogthumb-phinf.pstatic.net/20160917_195/wmsla2009_14741207470512rgqB_PNG/annilator.png?type=w800"><span class="moneyText">500$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyMultiTank" class="imgBuyInSpace" style="width: 150px; cursor: pointer" src="https://preview.redd.it/kjgx439g5q521.png?width=293&format=png&auto=webp&s=88ef558ce60a98fe9cc0eff9f92017dd9ec6b7cf" ><span class="moneyText">1000$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyGoldmine" class="imgBuyInSpace" style="width: 100px; cursor: pointer" src="https://cdn-icons-png.freepik.com/512/9110/9110092.png"><span class="moneyText">400$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyWall" class="imgBuyInSpace" style="width: 100px; cursor: pointer" src="https://cdn-icons-png.flaticon.com/512/8568/8568552.png"><span class="moneyText">300$</span></div>

            </div>
        </div>-->
        <div id="selectUpgrade" class="mainMenuOperations">
            <div id="divOptionsUpgrade" class="divOptionsMainMenu">
                <i id="xmark_close_buy_upgrade" class="fa-solid fa-xmark fa-2x" style="position:absolute; top: 20px; right: 20px;color:rgb(132, 132, 132); cursor: pointer;"></i>
            
                <!--TO UPGRADE-->
                <div id="alertNotEnoughMoneyUpgrade" class="alertRed">
                    <span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span> 
                    Not Enough Money!
                </div>
                
                <div class="title-text">LEVEL <span id="currentLevelArmour"></span></div>
                <div id="buttonUpgrade">UPGRADE <span id="price_to_upgrade"></span></div><span id="sellButtonUpgrade" onclick="sellSpaceUser()" title="You will be refund a 40% of what you spent in building and upgrading this structure" >Sell</span>

            </div>
        </div>
        <div class="dataPlayer"><i class="fa-solid fa-sack-dollar" style="color: rgb(205, 205, 0)"></i><span id="moneyCounter" style="color: rgb(205, 205, 0); margin-left: 5px;"></span><i class="fa-solid fa-droplet" style="color:rgb(190, 69, 255); margin-left: 20px;"></i><span id="elixirCounter" style="color:rgb(190, 69, 255); margin-left: 5px;"></span><i class="fa-solid fa-heart" style="margin-left: 20px;color: red"></i><span id="lifesCounter" style="color:red; margin-left: 5px;"></span></div>
        <div id="mainChronoDiv"><span id="mainChrono">0.0</span><span id="levelGoalTimeToAchieve"></span></div>
        <div id="mainAlertNoBuyDiv">
            <div id="alertNotEnoughMoney" class="alertRed">
                <span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span> 
                Not Enough Money!
            </div>
        </div>
        <div id="gameOverDiv">
            <div id="gameOverSubDiv">
                <span class="closeGameOverDiv" onclick="this.parentElement.parentElement.style.display='none';">&times;</span> 
                <span id="gameOverOrNewRecordSpan">Game Over!</span><span id="timeResistedGameOver" style="margin-top: 25px; margin-bottom: 25px;"></span><span id="difficultyModeGameOver"></span>
            </div>
        </div>
        <div id="armourSpace">
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
            <div class="armourSub"><div class="gradientLifesSpace">Buy Space</div></div>
        </div>
        <div id="menuOperationsUser">
            <div id="purchaseStructureMO">
                <div class="optnToBuyMiniDiv"><img id="buyBasicTank" draggable="true" class="imgBuyInSpace" style="cursor: pointer" src="https://preview.redd.it/vq62mhb27q521.png?width=281&format=png&auto=webp&s=9aaf5903544521d61590959a4aa89109c13431f3"><span class="moneyText">200$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyIceTank" draggable="true" class="imgBuyInSpace" style="cursor: pointer;" src="https://preview.redd.it/tjaa7j118q521.png?width=293&format=png&auto=webp&s=ad9dcc5b342d5b8f10f169d677a54c91f29424cc"><span class="moneyText">400$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyGunnerTank" class="imgBuyInSpace" style="cursor: pointer;" src="https://mblogthumb-phinf.pstatic.net/20160917_195/wmsla2009_14741207470512rgqB_PNG/annilator.png?type=w800"><span class="moneyText">500$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyMultiTank" class="imgBuyInSpace" style="cursor: pointer" src="https://preview.redd.it/kjgx439g5q521.png?width=293&format=png&auto=webp&s=88ef558ce60a98fe9cc0eff9f92017dd9ec6b7cf" ><span class="moneyText">1000$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyElixirmine" class="imgBuyInSpace" style="cursor: pointer" src="https://cdn-icons-png.freepik.com/512/8046/8046073.png"><span class="moneyText">600$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyGoldmine" class="imgBuyInSpace" style="cursor: pointer" src="https://cdn-icons-png.freepik.com/512/9110/9110092.png"><span class="moneyText">400$</span></div>
                <div class="optnToBuyMiniDiv"><img id="buyWall" class="imgBuyInSpace" style="cursor: pointer" src="https://cdn-icons-png.flaticon.com/512/8568/8568552.png"><span class="moneyText">300$</span></div>
            </div>
            <div id="menuSpellsUser">
                <div class="optnToBuyMiniDiv"><img id="buyFireSpell" draggable="true" class="imgBuyInSpace" style="cursor: pointer" src="https://cdn-icons-png.flaticon.com/512/8722/8722283.png"><span class="elixirText">500 <i class="fa-solid fa-droplet" style="color: rgb(190, 69, 255)"></i></span></div>
                <div class="optnToBuyMiniDiv"><img id="buySlowSpell" draggable="true" class="imgBuyInSpace" style="cursor: pointer;" src="https://cdn1.iconfinder.com/data/icons/winter-123/512/blizzard-snow-weather-wind-cold-512.png"><span class="elixirText">800 <i class="fa-solid fa-droplet" style="color: rgb(190, 69, 255)"></i></span></div>
                <div class="optnToBuyMiniDiv"><img id="buyIceSpell" class="imgBuyInSpace" style="cursor: pointer;" src="https://static-00.iconduck.com/assets.00/ice-icon-1929x2048-4ikhj9nt.png"><span class="elixirText">400 <i class="fa-solid fa-droplet" style="color: rgb(190, 69, 255)"></i></span></div>
                <div class="optnToBuyMiniDiv"><img id="buyBulletSpell" class="imgBuyInSpace" style="cursor: pointer;" src="https://cdn-icons-png.flaticon.com/512/3549/3549003.png"><span class="elixirText">175 <i class="fa-solid fa-droplet" style="color: rgb(190, 69, 255)"></i></span></div>
            </div>
        </div>
        <div id="notSmatphoneYet">
            <div style="font-size: 35px; margin: 10px auto;">Warning!</div>
            <div>This website has not yet been adapted for smartphones and small devices, but we are working on it :).</div>
            <div>So you may not be able to play as well as you should.</div>
            <div>If you want to enjoy fully this game, please connect to this website from a computer or any large screen device</div>
            <div>To close this alert, just click anywhere</div>
        </div>
        <script src="https://kit.fontawesome.com/8378f11a1e.js" crossorigin="anonymous"></script>
        <script>

            // TIMER
            var Timer = function(callback, delay) {
                var timerId, start, remaining = delay;
            
                this.pause = function() {
                    window.clearTimeout(timerId);
                    timerId = null;
                    remaining -= Date.now() - start;
                };
            
                this.resume = function() {
                    if (timerId) {
                        return;
                    }
                    start = Date.now();
                    timerId = window.setTimeout(callback, remaining);
                };
            
                this.resume();
            };


            // SRC's
            const BASICTANK_SRC = "https://preview.redd.it/vq62mhb27q521.png?width=281&format=png&auto=webp&s=9aaf5903544521d61590959a4aa89109c13431f3";
            const MULTITANK_SRC = "https://preview.redd.it/kjgx439g5q521.png?width=293&format=png&auto=webp&s=88ef558ce60a98fe9cc0eff9f92017dd9ec6b7cf";
            const GOLDMINE_SRC = "https://cdn-icons-png.freepik.com/512/9110/9110092.png";
            const WALL_SRC = "https://cdn-icons-png.flaticon.com/512/8568/8568552.png";
            const GUNNERTANK_SRC = "https://mblogthumb-phinf.pstatic.net/20160917_195/wmsla2009_14741207470512rgqB_PNG/annilator.png?type=w800";
            const ICETANK_SRC = "https://preview.redd.it/tjaa7j118q521.png?width=293&format=png&auto=webp&s=ad9dcc5b342d5b8f10f169d677a54c91f29424cc";
            const ELIXIRMINE_SRC = "https://cdn-icons-png.freepik.com/512/8046/8046073.png";
            
            var instructionsMain = document.getElementById("instructionsMain");
            var arrowDownInstructions = document.getElementById("arrowDownInstructions");

            function toggleInstructions(){
                if (instructionsMain.style.display == "block") {
                    instructionsMain.style.display = "none";
                    arrowDownInstructions.classList.remove("fa-chevron-up");
                    arrowDownInstructions.classList.add("fa-chevron-down");
                }
                else {
                    instructionsMain.style.display = "block";
                    arrowDownInstructions.classList.remove("fa-chevron-down");
                    arrowDownInstructions.classList.add("fa-chevron-up");
                }
            }

            var selectUpgrade = document.getElementById("selectUpgrade");
            var xmark_close_buy_upgrade = document.getElementById("xmark_close_buy_upgrade")

            // LIFES
            const LIFES_BASIC_TANK = 2;
            const LIFES_MULTI_TANK = 4;
            const LIFES_GOLDMINE = 2;
            const LIFES_WALL = 6;
            const LIFES_GUNNER_TANK = 3;
            const LIFES_ICE_TANK = 1;
            const LIFES_ELIXIRMINE  = 1;

            // DIFFICULTY SELCTORS
            var elementaryDiff = document.getElementById("elementaryDifficultyDiv");
            var easyDiff = document.getElementById("easyDifficultyDiv");
            var normalDiff = document.getElementById("normalDifficultyDiv");
            var hardDiff = document.getElementById("hardDifficultyDiv");
            var impossibleDiff = document.getElementById("impossibleDifficultyDiv");

            var difficultySpawn;

            var eqDiffIni = {
                "Elementary": 9000,
                "Easy": 6500,
                "Normal": 4500,
                "Hard": 3750,
                "Impossible": 2650
            }

            var divideIndexDiffDict = {
                "Elementary": 400,
                "Easy": 300,
                "Normal": 200,
                "Hard": 150,
                "Impossible": 80
            }

            var eqAsymptoteDiff = {
                "Elementary": 1.2,
                "Easy": 0.9,
                "Normal": 0.6,
                "Hard": 0.4,
                "Impossible": 0.2
            }

            var currentSelectedDifficulty = normalDiff;
            var currentDiffString = "Normal";

            elementaryDiff.addEventListener("click", function(){
                currentSelectedDifficulty.classList.remove("difficultySelectedOptn");
                elementaryDiff.classList.add("difficultySelectedOptn");
                currentSelectedDifficulty = elementaryDiff;
                currentDiffString = "Elementary";
            });

            easyDiff.addEventListener("click", function(){
                currentSelectedDifficulty.classList.remove("difficultySelectedOptn");
                easyDiff.classList.add("difficultySelectedOptn");
                currentSelectedDifficulty = easyDiff;
                currentDiffString = "Easy";
            });

            normalDiff.addEventListener("click", function(){
                currentSelectedDifficulty.classList.remove("difficultySelectedOptn");
                normalDiff.classList.add("difficultySelectedOptn");
                currentSelectedDifficulty = normalDiff;
                currentDiffString = "Normal";
            });

            hardDiff.addEventListener("click", function(){
                currentSelectedDifficulty.classList.remove("difficultySelectedOptn");
                hardDiff.classList.add("difficultySelectedOptn");
                currentSelectedDifficulty = hardDiff;
                currentDiffString = "Hard";
            });

            impossibleDiff.addEventListener("click", function(){
                currentSelectedDifficulty.classList.remove("difficultySelectedOptn");
                impossibleDiff.classList.add("difficultySelectedOptn");
                currentSelectedDifficulty = impossibleDiff;
                currentDiffString = "Impossible";
            });

            // LEVELS EVENT LISTENERS
            
            /*
            var newLevelOptions = {
                indexLevel
                nameLevel
                artisticName
                goalTime
                virusTimeline
                iniDiffSpawn
                changeDiffSpawn
                money
                moneyIntervalEarned
                asymptLevel (min spawning value)
            }

            var spawnTypeLvl = {
                typeBasic: bool
                typeDouble: bool
                typeCovid: bool
                typeDiseaseB: bool
                typeDiseaseH: bool
                typeSkull: bool
                typeBoss: bool
            }

            var params = {
                skullSize: list
                bossSize: int
                timeAnimation: int
            }


            var options = {
                uniqueType: bool
                typeUnique: string
                params: type
                diffSpawn: int (miliseconds)
                fixedSP: bool
                setDiffSpawnGlobal: bool
                spawn: spawnTypeLvl
            }
            */

            var undefinedParams = {
                skullSize: undefined,
                bossSize: undefined,
                timeAnimation: undefined
            }

            var undefinedSpawnType = {
                typeBasic: undefined,
                typeDouble: undefined,
                typeCovid: undefined,
                typeDiseaseB: undefined,
                typeDiseaseH: undefined,
                typeSkull: undefined,
                typeBoss: undefined
            }



            var optionsL1 = {
                id: 1,
                indexLevel: 1,
                nameLevel: "Level 1",
                artisticName: "Virus Playground",
                goalTime: 400000,
                iniDiffSpawn: 7000,
                changeDiffSpawn: 200,
                money: 1500,
                moneyIntervalEarned: 25,
                asymptLevel: 1,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "basic",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    35:{
                        uniqueType: true,
                        typeUnique: "double",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    70:{
                        uniqueType: true,
                        typeUnique: "diseaseB",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    }
                }
            }

            var optionsL2 = {
                id: 2,
                indexLevel: 2,
                nameLevel: "Level 2",
                artisticName: "Out Of Control",
                goalTime: 600000,
                iniDiffSpawn: 5000,
                changeDiffSpawn: 180,
                money: 1000,
                moneyIntervalEarned: 50,
                asymptLevel: 1,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "basic",
                        params: {
                            skullSize: undefined,
                            bossSize: undefined,
                            timeAnimation: 14
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    50:{
                        uniqueType: true,
                        typeUnique: "basic",
                        params: {
                            skullSize: undefined,
                            bossSize: undefined,
                            timeAnimation: 9
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                }
            }
            
            var optionsL3 = {
                id: 3,
                indexLevel: 3,
                nameLevel: "Level 3",
                artisticName: "Covid Planet",
                goalTime: 750000,
                iniDiffSpawn: 8500,
                changeDiffSpawn: 140,
                money: 2500,
                moneyIntervalEarned: 50,
                asymptLevel: 0.35,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "covid",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                }
            }

            var optionsL4 = {
                id: 4,
                indexLevel: 4,
                nameLevel: "Level 4",
                artisticName: "Dying Slowly",
                goalTime: 1000000,
                iniDiffSpawn: 8000,
                changeDiffSpawn: 200,
                money: 800,
                moneyIntervalEarned: 10,
                asymptLevel: 0.7,
                virusTimeline: {
                    0: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: false,
                            typeDiseaseB: false,
                            typeDiseaseH: false,
                            typeSkull: false,
                            typeBoss: false
                        }
                    },
                    15: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: false,
                            typeDiseaseH: false,
                            typeSkull: false,
                            typeBoss: false
                        }
                    },
                    30: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: false,
                            typeSkull: false,
                            typeBoss: false
                        }
                    },
                    50: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: false,
                            typeSkull: true,
                            typeBoss: false
                        }
                    },
                    75: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: true,
                            typeSkull: true,
                            typeBoss: true
                        }
                    }
                }
            }

            var optionsL5 = {
                id: 5,
                indexLevel: 5,
                nameLevel: "Level 5",
                artisticName: "Epidemic",
                goalTime: 250000,
                iniDiffSpawn: 3000,
                changeDiffSpawn: 60,
                money: 3500,
                moneyIntervalEarned: 25,
                asymptLevel: 0.2,
                virusTimeline: {
                    0: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: false,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: true,
                            typeSkull: true,
                            typeBoss: true
                        }
                    },
                }
            }

            var optionsL6 = {
                id: 6,
                indexLevel: 6,
                nameLevel: "Level 6",
                artisticName: "Beat The Boss",
                goalTime: 500000,
                iniDiffSpawn: 5000,
                changeDiffSpawn: 150,
                money: 1500,
                moneyIntervalEarned: 25,
                asymptLevel: 0.65,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "none",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    10: {
                        uniqueType: true,
                        typeUnique: "boss",
                        params: {
                            skullSize: undefined,
                            bossSize: 2500,
                            timeAnimation: 300,
                        },
                        diffSpawn: 4000,
                        fixedSP: true,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    11:{
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: true,
                            typeSkull: true,
                            typeBoss: false
                        }
                    }
                }
            }

            var optionsL7 = {
                id: 7,
                indexLevel: 7,
                nameLevel: "Level 7",
                artisticName: "Fast & Furious",
                goalTime: 450000,
                iniDiffSpawn: 5000,
                changeDiffSpawn: 90,
                money: 1500,
                moneyIntervalEarned: 100,
                asymptLevel: 0.4,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "diseaseB",
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    50: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: false,
                            typeDouble: false,
                            typeCovid: false,
                            typeDiseaseB: true,
                            typeDiseaseH: true,
                            typeSkull: false,
                            typeBoss: false
                        }
                    },
                    80: {
                        uniqueType: true,
                        typeUnique: "diseaseH",
                        params: undefinedParams,
                        diffSpawn: 2250,
                        fixedSP: false,
                        setDiffSpawnGlobal: true,
                        spawn: undefinedSpawnType
                    }
                }
            }

            var optionsL8 = {
                id: 8,
                indexLevel: 8,
                nameLevel: "Level 8",
                artisticName: "On and On",
                goalTime: 650000,
                iniDiffSpawn: 9000,
                changeDiffSpawn: 70, 
                money: 2500,
                moneyIntervalEarned: 100,
                asymptLevel: 0.3,
                virusTimeline: {
                    0: {
                        uniqueType: false,
                        typeUnique: undefined,
                        params: undefinedParams,
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: {
                            typeBasic: true,
                            typeDouble: true,
                            typeCovid: true,
                            typeDiseaseB: true,
                            typeDiseaseH: true,
                            typeSkull: true,
                            typeBoss: true
                        }
                    },
                }
            }

            var optionsL9 = {
                id: 9,
                indexLevel: 9,
                nameLevel: "Level 9",
                artisticName: "Bad Guys",
                goalTime: 550000,
                iniDiffSpawn: 9000,
                changeDiffSpawn: 800,
                money: 5000,
                moneyIntervalEarned: 125,
                asymptLevel: 1,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "boss",
                        params: {
                            skullSize: undefined,
                            bossSize: 500,
                            timeAnimation: 150,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                }
            }

            var optionsL10 = {
                id: 10,
                indexLevel: 10,
                nameLevel: "Level 10",
                artisticName: "Skull Cave",
                goalTime: 600000,
                iniDiffSpawn: 7000,
                changeDiffSpawn: 100,
                money: 1500,
                moneyIntervalEarned: 50,
                asymptLevel: 0.4,
                virusTimeline: {
                    0: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [1, 2],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    10: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [1, 2, 3],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    20: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [2, 3],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    30: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [2, 3, 4],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    40: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [3, 4],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    60: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [3, 4, 5],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    70: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [4, 5],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                    80: {
                        uniqueType: true,
                        typeUnique: "skull",
                        params: {
                            skullSize: [5],
                            bossSize: undefined,
                            timeAnimation: undefined,
                        },
                        diffSpawn: 0,
                        fixedSP: false,
                        setDiffSpawnGlobal: false,
                        spawn: undefinedSpawnType
                    },
                }
            }




            var levelsOptionsMain = [null, optionsL1, optionsL2, optionsL3, optionsL4, optionsL5, optionsL6, optionsL7, optionsL8, optionsL9, optionsL10];

            document.querySelectorAll(".newLevelToShowUser").forEach(function(e, i){
                e.nextElementSibling.style.display = "none";

                e.nextElementSibling.querySelector(":nth-child(1)").innerHTML = "<strong>Goal time: </strong>"+levelsOptionsMain[i+1].goalTime/1000+" seconds";
                e.nextElementSibling.querySelector(":nth-child(2)").innerHTML = "<strong>Money: </strong>"+levelsOptionsMain[i+1].money+"$";
                e.nextElementSibling.querySelector(":nth-child(3)").innerHTML = "<strong>Basic Income: </strong>"+levelsOptionsMain[i+1].moneyIntervalEarned+"$";


                e.addEventListener("click", function(){
                    if (e.nextElementSibling.style.display == "none") {
                        e.nextElementSibling.style.display = "block";
                    }
                    else {
                        e.nextElementSibling.style.display = "none";
                    }
                })
                e.nextElementSibling.querySelector(":nth-child(4)").addEventListener("click", function(){
                    newLevel(levelsOptionsMain[i+1]);
                })
                e.textContent = levelsOptionsMain[i+1].nameLevel+": "+levelsOptionsMain[i+1].artisticName;

                if (localStorage.getItem("level"+levelsOptionsMain[i+1].id+"_completed") == "true") {
                    e.style.backgroundColor = "rgba(0, 255, 31, 0.25)";
                }
            })
            

            // BEST MARKS USER

            var userBestMarksDiv = document.getElementById("userBestMarksDiv");
            var divPresentationGame = document.getElementById("divPresentationGame");
            var iconShowBestMarks = document.getElementById("leaderBoardUserBestMarksIcon");

            var BMElementary = document.getElementById("bestMarkElementary");
            var BMEasy = document.getElementById("bestMarkEasy");
            var BMNormal = document.getElementById("bestMarkNormal");
            var BMHard = document.getElementById("bestMarkHard");
            var BMImpossible = document.getElementById("bestMarkImpossible");

            function showBestMarksUser() {
                userBestMarksDiv.style.display = "block";
                divPresentationGame.style.display = "none";
                iconShowBestMarks.style.display = "none";

                if (localStorage.getItem("bestMarkElementary") != null) {
                    BMElementary.textContent = localStorage.getItem("bestMarkElementary")+" seconds";
                }
                else {
                    BMElementary.textContent = "(Not played yet)";
                }

                if (localStorage.getItem("bestMarkEasy") != null) {
                    BMEasy.textContent = localStorage.getItem("bestMarkEasy")+" seconds";
                }
                else {
                    BMEasy.textContent = "(Not played yet)";
                }

                if (localStorage.getItem("bestMarkNormal") != null) {
                    BMNormal.textContent = localStorage.getItem("bestMarkNormal")+" seconds";
                }
                else {
                    BMNormal.textContent = "(Not played yet)";
                }

                if (localStorage.getItem("bestMarkHard") != null) {
                    BMHard.textContent = localStorage.getItem("bestMarkHard")+" seconds";
                }
                else {
                    BMHard.textContent = "(Not played yet)";
                }

                if (localStorage.getItem("bestMarkImpossible") != null) {
                    BMImpossible.textContent = localStorage.getItem("bestMarkImpossible")+" seconds";
                }
                else {
                    BMImpossible.textContent = "(Not played yet)";
                }
            }

            function closeBestMarkUserMenu() {
                userBestMarksDiv.style.display = "none";
                divPresentationGame.style.display = "block";
                iconShowBestMarks.style.display = "block";
            }

            // LEVELS DISPLAY

            var playByLevelDiv = document.getElementById("playByLevelDiv");

            function displayLevels(){
                playByLevelDiv.style.display = "block";
                divPresentationGame.style.display = "none";
                iconShowBestMarks.style.display = "none";
            }

            function closeLevelsUserMenu() {
                playByLevelDiv.style.display = "none";
                divPresentationGame.style.display = "block";
                iconShowBestMarks.style.display = "block";
            }

            // SPELLS
            var fireSpell = document.getElementById("buyFireSpell");
            var slowSpell = document.getElementById("buySlowSpell");
            var iceSpell = document.getElementById("buyIceSpell");
            var bulletSpell = document.getElementById("buyBulletSpell");

            function createBulletSpell(){
                let gameZoneHeight = armourSpaceDiv.getBoundingClientRect().height;
                for (var i = 0; i < 5; ++i) {
                    setTimeout(function(){
                        for (var i = 0; i < gameZoneHeight; i+=gameZoneHeight/25) {
                            let newBullet = document.createElement("div");
                            newBullet.classList.add("bulletType");
                            newBullet.classList.add("bulletStyleMaxSmall");
                            newBullet.style.left = -0.4+"vh";
                            newBullet.style.top = i+"px";
                            newBullet.classList.add("moveBulletSpull");
        
                            document.body.appendChild(newBullet);
        
                            newBullet.addEventListener('animationend', function(e){
                                e.currentTarget.remove();
                            });
                        }
                    }, i*1500);
                }
            }

            bulletSpell.addEventListener("click", function(){
                if (currentElixir >= 175) {
                    currentElixir -= 175;
                    elixirCounterDOC.textContent = currentElixir;
                    createBulletSpell();
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Elixir!`
                    alertNoMoney.style.display = "block";
                }
            })

            var allFrozen = false;
            var timeOutFreezeSpull;
            var timeOutUnFreezeSpull;
            function freezeAll(time) {
                clearInterval(timeOutFreezeSpull);
                clearInterval(timeOutUnFreezeSpull);
                allFrozen = false;
                timeOutFreezeSpull = setTimeout(function(){
                    if (!allFrozen) {
                        allFrozen = true;
                        document.querySelectorAll(".enemy").forEach(function(ele){
                            ele.dataset.frozen = "true";
                            let animationsVirus = ele.getAnimations();
                            if (animationsVirus.length == 1) {
                                animationsVirus[0].pause();
                            }
                            else {
                                animationsVirus[0].pause();
                                animationsVirus[1].pause();
                            }
                        })
                    }
                }, 300)

                timeOutUnFreezeSpull = setTimeout(function(){
                    if (allFrozen) {
                        document.querySelectorAll(".enemy").forEach(function(ele){
                            if (ele.dataset.frozen == "true") {
                                ele.dataset.frozen = "false";
                                let animationsVirus = ele.getAnimations();
                                if (animationsVirus.length == 1) {
                                    animationsVirus[0].play();
                                }
                                else {
                                    animationsVirus[1].play();
                                }
                            }
                        })
                        allFrozen = false;
                    }
                }, time+300)
            }

            iceSpell.addEventListener("click", function(){
                if (currentElixir >= 400) {
                    currentElixir -= 400;
                    elixirCounterDOC.textContent = currentElixir;
                    showSnowFlakeAnimation();
                    freezeAll(10000);
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Elixir!`
                    alertNoMoney.style.display = "block";
                }
            })

            function slowAll(){
                var freezeDivAnimation = document.createElement("div");
                freezeDivAnimation.classList.add("divFreezeAllAnimation");
                document.body.appendChild(freezeDivAnimation);

                freezeDivAnimation.addEventListener("animationend", function(e){
                    e.currentTarget.remove();
                })
                document.querySelectorAll(".enemy").forEach(function(virus){
                    if (virus.dataset.slowed == "false"){
                        virus.style.color = "#72E5FF";

                        virus.getAnimations()[0].pause();

                        if (virus.classList.contains("enemySuperSlow")){
                            let timeRemaining = (1-virus.getAnimations()[0].effect.getComputedTiming().progress)*parseInt(window.getComputedStyle(virus).animationDuration)*1000;
                            virus.style.animation = `${window.getComputedStyle(virus).animationName} ${window.getComputedStyle(virus).animationDuration} linear paused, moveEnemySlow ${timeRemaining*indexSlow/1000}s linear`
                        }
                        else if (virus.classList.contains("fa-skull")){
                            virus.getAnimations()[0].pause();

                            let windowWidth = window.innerWidth;
                            let posLeft = virus.getBoundingClientRect().left;

                            let remainingWayAnimation = 1-((windowWidth-posLeft)/(1.125*windowWidth));

                            let timeAnimation = remainingWayAnimation * virus.getAnimations()[0].effect.getComputedTiming().duration;

                            virus.animate([
                                { left: "-10vw" }
                            ], {
                                duration: timeAnimation*indexSlow,
                            }).finished.then(function(e) {
                                e.effect.target.remove();
                                endGame();
                            });
                        }
                        else {
                            let timeRemaining = (1-virus.getAnimations()[0].effect.getComputedTiming().progress)*parseInt(window.getComputedStyle(virus).animationDuration)*1000;
                            virus.style.animation = `${window.getComputedStyle(virus).animationName} ${window.getComputedStyle(virus).animationDuration} linear paused, moveEnemy ${timeRemaining*indexSlow/1000}s linear`
                            console.log(timeRemaining);
                            console.log(`${window.getComputedStyle(virus).animationName} ${window.getComputedStyle(virus).animationDuration} linear paused, moveEnemy ${timeRemaining*indexSlow/1000}s linear`)
                            console.log(virus.getAnimations())
                        }

                        virus.dataset.slowed = "true";

                        if (allFrozen) {
                            virus.getAnimations()[1].pause();
                        }
                    }
                })
            }

            function showSnowFlakeAnimation(){
                let gameZoneHeight = armourSpaceDiv.getBoundingClientRect().height;
                for (var i = 0; i < 5; ++i) {
                    setTimeout(function(){
                        let newSnowFlake = document.createElement("div");
                        newSnowFlake.style.left = +"px";
                        newSnowFlake.style.top = getRandomInt(gameZoneHeight-window.innerHeight*0.15)+"px";
                        newSnowFlake.classList.add("snowFlakeAnimation", "fa-solid", "fa-snowflake");
                        newSnowFlake.addEventListener("animationend", function(e){
                            e.currentTarget.remove();
                        })
                        document.body.appendChild(newSnowFlake);
                    }, i*100)
                }
            }

            slowSpell.addEventListener("click", function(){
                if (currentElixir >= 800) {
                    currentElixir -= 800;
                    elixirCounterDOC.textContent = currentElixir;
                    setTimeout(slowAll, 600);
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Elixir!`
                    alertNoMoney.style.display = "block";
                }
            })

            function generateFireSpell(){
                let armourSpaceRect = armourSpaceDiv.getBoundingClientRect();
                let gameZoneHeight = armourSpaceRect.height;
                let gameZoneWidth = armourSpaceRect.width;
                for (var i = 0; i < 10; ++i) {
                    let newFireBomb = document.createElement("div");
                    newFireBomb.style.left = (window.innerWidth - gameZoneWidth)*0.1+gameZoneWidth+getRandomInt(0.8*(window.innerWidth - gameZoneWidth))+"px";
                    newFireBomb.style.top = gameZoneHeight*0.1+getRandomInt(0.8*(gameZoneHeight))+"px";
                    newFireBomb.classList.add("mainFireSpell","fa-solid", "fa-fire", "bulletType");
                    newFireBomb.dataset.lifes = 30;
                    document.body.appendChild(newFireBomb);
                }
            }

            fireSpell.addEventListener("click", function(){
                if (currentElixir >= 500) {
                    currentElixir -= 500;
                    elixirCounterDOC.textContent = currentElixir;
                    generateFireSpell();
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Elixir!`
                    alertNoMoney.style.display = "block";
                }
            })


            // TO BUY SELECTIONS
            var basicTank = document.getElementById("buyBasicTank");
            var multiTank = document.getElementById("buyMultiTank");
            var goldmine = document.getElementById("buyGoldmine");
            var wall = document.getElementById("buyWall");
            var gunnerTank = document.getElementById("buyGunnerTank");
            var iceTank = document.getElementById("buyIceTank");
            var elixirmine = document.getElementById("buyElixirmine");

            var spacesToBuy = new Array(30).fill(0);
            var spacesIntervals = new Array(30);
            var lifeSpaces = new Array(30).fill(NaN);
            var levelsSpaces = new Array(30).fill(0);

            var numBuilt = {
                1: 0,
                2: 0,
                3: 0,
                4: 0,
                5: 0,
                6: 0,
                7: 0
            }

            var limitToBulid = {
                1: 18,
                2: 12,
                3: 10,
                4: 12,
                5: 12,
                6: 12,
                7: 4
            }

            var realtionLifes = {
                0: NaN,
                1: LIFES_BASIC_TANK,
                2: LIFES_MULTI_TANK,
                3: LIFES_GOLDMINE,
                4: LIFES_WALL,
                5: LIFES_GUNNER_TANK,
                6: LIFES_ICE_TANK,
                7: LIFES_ELIXIRMINE
            }

            // UPGRADE PRICES
            var upgradeBasicTank = {
                0: 200,
                1: 400,
                2: 500,
                3: 1000,
                4: 1250,
                5: 1800, 
                6: 200 // ELIXIR (2300$)
            }

            var upgradeMultiTank = {
                0: 1000,
                1: 500,
                2: 750,
                3: 1250,
                4: 1600,
                5: 2700,
                6: 1000 // ELIXIR (4250$)
            }

            var upgradeGoldmine = {
                0: 600,
                1: 600,
                2: 850,
                3: 1350,
                4: 1900,
                5: 2900,
                6: 1000 // ELIXIR (4200$)
            }

            var upgradeWall = {
                0: 300,
                1: 200,
                2: 300,
                3: 500,
                4: 800,
                5: 1200,
                6: NaN // ELIXIR (Not used)
            }

            var upgradeGunnerTank = {
                0: 500,
                1: 400,
                2: 600,
                3: 900,
                4: 1400,
                5: 2000,
                6: 1200 // ELIXIR (2800$)
            }

            var upgradeIceTank = {
                0: 400,
                1: 500,
                2: 700,
                3: 1100,
                4: 1500,
                5: 2000,
                6: 700 // ELIXIR (2700$)
            }

            var upgradeElixirmine = {
                0: 600,
                1: 600,
                2: 950,
                3: 1300,
                4: 1800,
                5: 2600,
                6: 650, // ELIXIR
            }

            var realtionUpgrade = {
                1: upgradeBasicTank,
                2: upgradeMultiTank,
                3: upgradeGoldmine,
                4: upgradeWall,
                5: upgradeGunnerTank,
                6: upgradeIceTank,
                7: upgradeElixirmine
            }

            var timeUpgradeBasicTank = {
                0: 2000,
                1: 1650,
                2: 1300,
                3: 1000,
                4: 700,
                5: 500,
                6: 500
            }

            var timeUpgradeMultiTank = {
                0: 3500,
                1: 2900,
                2: 2300,
                3: 1700,
                4: 1300,
                5: 850,
                6: 850
            }

            var timeUpgradeGoldmine = {
                0: 2000,
                1: 1700,
                2: 1400,
                3: 1100,
                4: 800,
                5: 500,
                6: 300
            }

            var lifeUpgradeWall = {
                0: 15,
                1: 20,
                2: 25,
                3: 30,
                4: 35,
                5: 50,
                6: 65
            }

            var timeUpgradeGunnerTank = {
                0: 4000,
                1: 3100,
                2: 2300,
                3: 1600,
                4: 1100,
                5: 700,
                6: 700
            }

            var timeUpgradeIceTank = {
                0: 2500,
                1: 2000,
                2: 1600,
                3: 1200,
                4: 900,
                5: 600,
                6: 600
            }

            var timeUpgradeElixirmine = {
                0: 6000,
                1: 5200,
                2: 4400,
                3: 3750,
                4: 3200,
                5: 2700,
                6: 2300,
                7: 2000
            }

            var relationUpgradeSkills = {
                1: timeUpgradeBasicTank,
                2: timeUpgradeMultiTank,
                3: timeUpgradeGoldmine,
                4: lifeUpgradeWall,
                5: timeUpgradeGunnerTank,
                6: timeUpgradeIceTank,
                7: timeUpgradeElixirmine
            }

            var priceToUpgradeSpan = document.getElementById("price_to_upgrade");

            // OTHER
            var currentMoney = 1000;
            var currentLifes = 3;
            var currentElixir = 0;

            var moneyCounterDOC = document.getElementById("moneyCounter");
            var lifesCounterDOC = document.getElementById("lifesCounter");
            var elixirCounterDOC = document.getElementById("elixirCounter");

            moneyCounterDOC.textContent = currentMoney;
            lifesCounterDOC.textContent = currentLifes;
            elixirCounterDOC.textContent = currentElixir;

            var alertNoMoney = document.getElementById("alertNotEnoughMoney");
            var alertNoMoneyUpgrade = document.getElementById("alertNotEnoughMoneyUpgrade");

            var armourSpaceDiv = document.getElementById("armourSpace");

            var upgradeMainButton = document.getElementById("buttonUpgrade");

            var selectedSpace;
            var selectedIndex;

            function setUpUserView(){
                document.querySelectorAll(".armourSub").forEach(function(e){
                    e.style.lineHeight = window.getComputedStyle(e).getPropertyValue('height');
                    e.style.visibility = "visible";
                })
                armourSpaceDiv.style.width = parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[0]).getPropertyValue('width'))*5+41+"px";
            }

            function isSmartphone() {
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }

            var notSmatphoneYet = document.getElementById("notSmatphoneYet");

            if (isSmartphone()) {
                notSmatphoneYet.style.display = "flex";
                notSmatphoneYet.addEventListener("click", closeNotSmartphoneYet);
            }

            function closeNotSmartphoneYet(){
                notSmatphoneYet.style.display = "none";
                notSmatphoneYet.removeEventListener("click", closeNotSmartphoneYet);
            }

            window.addEventListener("resize", setUpUserView);

            setUpUserView();

            function getRandomInt(max) {
                return Math.floor(Math.random() * max);
            }

            function clearBackground() {
                document.querySelectorAll(".armourSub").forEach(function(ele){
                    ele.style.backgroundColor = "transparent";
                })
            }

            var timeResisted = document.getElementById("timeResistedGameOver");
            var gameOverDiv = document.getElementById("gameOverDiv");
            var diffGameOver = document.getElementById("difficultyModeGameOver");

            var endGameVar = false;

            var gameOverOrNewRecord = document.getElementById("gameOverOrNewRecordSpan");

            function endGame(){
                if (!endGameVar) {
                    endGameVar = true;
                    closeUpgradeMenu();
                    lifesCounterDOC.textContent = 0;
                    clearInterval(mainMoneyInterval);
                    clearInterval(chronoInterval);

                    for (var i = 0; i < 30; ++i) {
                        clearInterval(spacesIntervals[i]);
                    }

                    document.querySelectorAll(".enemy").forEach(function(ele){
                        ele.remove();
                    })

                    if (playingAtLevel) {
                        if (timerLevel != undefined) {
                            timerLevel.pause();
                        }
                        
                        for (var i = 0; i < timeOutsStagesLevel.length; ++i) {
                            timeOutsStagesLevel[i].pause();
                        }

                        clearInterval(intervalSpawning_level);
                        clearInterval(intervalDifficulty_level);

                        let newCurrentDate = new Date().getTime();
                        let timeResistedByUser = Math.round((newCurrentDate-d)/1000, 2);
                        gameOverDiv.style.display = "contents";
                        timeResisted.textContent = "You resisted "+timeResistedByUser+" seconds";
                        diffGameOver.textContent = "In "+currentLVLName;
                        gameOverOrNewRecord.textContent = "Game Over!";
                    }
                    else {
                        intervalDifficulty.pause();
                        clearInterval(controlBossSpawnInterval);

                        for (var i = 0; i < listTimeOutsSpawnBoss.length; i++) {
                            clearTimeout(listTimeOutsSpawnBoss[i]);
                        }

                        let newCurrentDate = new Date().getTime();
                        let timeResistedByUser = Math.round((newCurrentDate-d)/1000, 2);
                        gameOverDiv.style.display = "contents";
                        timeResisted.textContent = "You resisted "+timeResistedByUser+" seconds";
                        diffGameOver.textContent = "In "+currentDiffString+" difficulty";
                        gameOverOrNewRecord.textContent = "Game Over!";

                        let currentBestMark = localStorage.getItem("bestMark"+currentDiffString);
                        if (currentBestMark == null) {
                            gameOverOrNewRecord.textContent = "New Record!";
                            localStorage.setItem("bestMark"+currentDiffString, timeResistedByUser);
                        }
                        else {
                            if (timeResistedByUser > currentBestMark) {
                                gameOverOrNewRecord.textContent = "New Record!";
                                localStorage.setItem("bestMark"+currentDiffString, timeResistedByUser);
                            }
                        }
                    }
                }
            }

            function closeUpgradeMenu(){
                upgradeMainButton.style.display = "none"
                selectUpgrade.style.display = "none";
                alertNoMoneyUpgrade.style.display = "none";
                clearBackground();

                document.removeEventListener("click", closeUpgradeMenuClick);
            }

            xmark_close_buy_upgrade.addEventListener("click", closeUpgradeMenu)

            var currentLevelArmour = document.getElementById("currentLevelArmour");

            function upgradeMenu(space, i) {
                if (spacesToBuy[i] != 0){

                    if (selectedIndex != i) {
                        alertNoMoneyUpgrade.style.display = "none";
                    }
                 
                    selectUpgrade.style.display = "contents";
    
                    selectedSpace = space.currentTarget;
                    selectedIndex = i;
    
                    console.log(relationUpgradeSkills[spacesToBuy[i]]);
                    console.log(spacesToBuy[i]);
                    console.log(relationUpgradeSkills);
                    console.log(i);
                    currentLevelArmour.textContent = levelsSpaces[i]+" ("+(relationUpgradeSkills[spacesToBuy[i]][levelsSpaces[i]-1])/1000+"s)";
    
                    priceToUpgradeSpan = document.getElementById("price_to_upgrade");
    
                    upgradeMainButton = document.getElementById("buttonUpgrade");
    
                    if (levelsSpaces[i] < 7) {
                        upgradeMainButton.style.display = "block";
                    }
                    else {
                        upgradeMainButton.style.display = "none";
                    }
    
                    var priceUpgrade = realtionUpgrade[spacesToBuy[i]][levelsSpaces[i]];
    
                    if (levelsSpaces[i] < 6) {
                        priceToUpgradeSpan.innerHTML = priceUpgrade+"$ ("+(relationUpgradeSkills[spacesToBuy[i]][levelsSpaces[i]])/1000+"s)";
                    }
                    else {
                        if (spacesToBuy[i] == 1 || spacesToBuy[i] == 2 || spacesToBuy[i] == 5 || spacesToBuy[i] == 6) {
                            priceToUpgradeSpan.innerHTML = priceUpgrade+" <i class='fa-solid fa-droplet'></i> (<i class='fa-solid fa-star'></i> POWER)";
                        }
                        else {
                            priceToUpgradeSpan.innerHTML = priceUpgrade+" <i class='fa-solid fa-droplet'></i> ("+(relationUpgradeSkills[spacesToBuy[i]][levelsSpaces[i]])/1000+"s)";
    
                        }
                    }
    
                    upgradeMainButtonClone = upgradeMainButton.cloneNode(true);
                
                    upgradeMainButton.parentNode.replaceChild(upgradeMainButtonClone, upgradeMainButton);
    
                    upgradeMainButtonClone.addEventListener("click", function(){
                        upgradeLevel(priceUpgrade, space, i, spacesToBuy[i]);
                        upgradeMenu(space, i);
                    });
    
                    document.addEventListener("mousedown", closeUpgradeMenuClick);
                }
            }

            var divOptionsUpgrade = document.getElementById("divOptionsUpgrade");


            function closeUpgradeMenuClick(event){
                if (!divOptionsUpgrade.contains(event.target) && !armourSpaceDiv.contains(event.target)) {
                    closeUpgradeMenu();
                }
            }

            function upgradeLevel(price, ele, index, type){
                let enoughResources = false;
                if (levelsSpaces[index] < 6) {
                    enoughResources = currentMoney >= price;                    
                }
                if (levelsSpaces[index] == 6) {
                    enoughResources = currentElixir >= price;     
                }
                if (enoughResources) {
                    let maxLvl;
                    if (levelsSpaces[index] < 6) {
                        currentMoney -= price;
                        moneyCounterDOC.textContent = currentMoney;
                        maxLvl = false;
                    }
                    else {
                        currentElixir -= price;
                        elixirCounterDOC.textContent = currentElixir;
                        maxLvl = true;
                    }

                    clearInterval(spacesIntervals[index]);

                    if (type == 1) {
                        createIntervalBasicTank(index, relationUpgradeSkills[spacesToBuy[index]][levelsSpaces[index]], maxLvl);
                    }
                    else if (type == 2) {
                        createIntervalMultiTank(index, relationUpgradeSkills[spacesToBuy[index]][levelsSpaces[index]], maxLvl);
                    }
                    else if (type == 3) {
                        createIntervalGoldmine(index, relationUpgradeSkills[spacesToBuy[index]][levelsSpaces[index]], maxLvl);
                    }
                    else if (type == 5) {
                        createIntervalGunnerTank(index, relationUpgradeSkills[spacesToBuy[index]][levelsSpaces[index]], maxLvl);
                    }
                    else if (type == 6) {
                        createIntervalIceTank(index, relationUpgradeSkills[spacesToBuy[index]][levelsSpaces[index]], maxLvl);
                    }
                    else if (type == 7) {
                        createIntervalElixirmine(index, relationUpgradeSkills[spacesToBuy[index]][levelsSpaces[index]], maxLvl);
                    }

                    levelsSpaces[index]++;


                    /*if (type != 4) {
                        document.getElementsByClassName("armourSub")[index].firstChild.children[1].textContent = levelsSpaces[index];
                    }*/

                }
                else {
                    if (levelsSpaces[index] < 6) {
                        alertNoMoneyUpgrade.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoneyUpgrade.style.display = "block";
                    }
                    else {
                        alertNoMoneyUpgrade.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Elixir!`
                        alertNoMoneyUpgrade.style.display = "block";
                    }
                }
            }

            /*basicTank.addEventListener("click", createNewBasicTank);
            multiTank.addEventListener("click", createNewMultiTank);
            goldmine.addEventListener("click", createNewGoldmine);
            wall.addEventListener("click", createNewWall);
            gunnerTank.addEventListener("click", createNewGunnerTank);
            iceTank.addEventListener("click", createNewIceTank);*/
            
            
            let startMouseX, startMouseY;

            function createClone(element) {
                const clone = element.cloneNode(true);
                clone.style.position = 'absolute';
                document.body.appendChild(clone);
                return clone;
            }

            function isElementOverlapping(element) {
                const rect = element.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;
                const targetElement = document.elementFromPoint(x, y);
                return targetElement !== element && element.contains(targetElement);
            }

            function getIndexOverlappingElement(element) {
                const armourSubElements = document.querySelectorAll('.armourSub');
                const rect = element.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;
            
                for (let i = 0; i < armourSubElements.length; i++) {
                    const subElement = armourSubElements[i];
                    const subRect = subElement.getBoundingClientRect();
                    if (
                        x >= subRect.left &&
                        x <= subRect.right &&
                        y >= subRect.top &&
                        y <= subRect.bottom
                    ) {
                        return i; // Devuelve el índice del elemento si el elemento arrastrado está sobre él
                    }
                }
            
                return -1; // Si no está sobre ningún elemento, devuelve -1
            }

            var listSpacesQuery = document.querySelectorAll(".armourSub");
            var lastDraggedSpace = listSpacesQuery[0];

            basicTank.addEventListener('mousedown', function(e){
                eventDraggStructure(e, basicTank, createNewBasicTank)
            });

            multiTank.addEventListener('mousedown', function(e){
                eventDraggStructure(e, multiTank, createNewMultiTank)
            });
            goldmine.addEventListener('mousedown', function(e){
                eventDraggStructure(e, goldmine, createNewGoldmine)
            });
            wall.addEventListener('mousedown', function(e){
                eventDraggStructure(e, wall, createNewWall)
            });
            gunnerTank.addEventListener('mousedown', function(e){
                eventDraggStructure(e, gunnerTank, createNewGunnerTank)
            });
            iceTank.addEventListener('mousedown', function(e){
                eventDraggStructure(e, iceTank, createNewIceTank)
            });
            elixirmine.addEventListener('mousedown', function(e){
                eventDraggStructure(e, elixirmine, createNewElixirMine)
            })
            
            // Agrega evento de inicio de arrastre al elemento
            function eventDraggStructure (event, structure, functionStructure) {
                event.preventDefault();

                if (gameStatePaused) {
                    reanudeGame();
                }

                const rect = structure.getBoundingClientRect();
            
                const clone = createClone(structure);

                clone.style.width = rect.width+"px";
                clone.style.height = rect.height+"px";

                clone.style.left = `${event.clientX-clone.getBoundingClientRect().width/2}px`;
                clone.style.top = `${event.clientY-clone.getBoundingClientRect().height/2}px`;
            
                // Agrega clase de arrastrando al elemento original
                clone.classList.add('dragging');
            
                // Función para actualizar la posición de la copia mientras se arrastra
                function updatePosition(event) {
                    clone.style.left = `${event.clientX-clone.getBoundingClientRect().width/2}px`;
                    clone.style.top = `${event.clientY-clone.getBoundingClientRect().height/2}px`;
                }
            
                // Agrega evento de arrastre mientras se mantiene presionado el botón del mouse
                function drag(event) {
                    event.preventDefault();
                    updatePosition(event);
                    const index = getIndexOverlappingElement(clone);
                    if (index !== -1) {
                        lastDraggedSpace.style.backgroundColor = "transparent";
                        let eleDragged = listSpacesQuery[index];
                        eleDragged.style.background = "#DEDEDE";
                        lastDraggedSpace = eleDragged;
                    }
                }
            
                // Agrega evento de soltar para limpiar los manejadores de eventos y eliminar la copia
                function release(e) {
                    document.removeEventListener('mousemove', drag);
                    document.removeEventListener('mouseup', release);
                    multiTank.classList.remove('dragging');
                    const index = getIndexOverlappingElement(clone);
                    lastDraggedSpace.style.backgroundColor = "white";
                    if (index !== -1) {
                        selectedIndex = index;
                        selectedSpace = document.querySelectorAll(".armourSub")[index];
                        functionStructure();
                    }
                    clone.remove();
                }
            
                // Agrega manejadores de eventos de arrastre y soltar
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', release);
            };

            function colision(eleA, eleB) {
                var rectA = eleA.getBoundingClientRect();
                var rectB = eleB.getBoundingClientRect();
        
                return (
                  rectA.left < rectB.right &&
                  rectA.right > rectB.left &&
                  rectA.top < rectB.bottom &&
                  rectA.bottom > rectB.top
                );
            }

            /*function freezeAll(time) {
                var freezeDivAnimation = document.createElement("div");
                freezeDivAnimation.classList.add("divFreezeAllAnimation");
                document.body.appendChild(freezeDivAnimation);

                freezeDivAnimation.addEventListener("animationend", function(e){
                    e.currentTarget.remove();
                })
                setTimeout(function(){
                    document.querySelectorAll(".enemy").forEach(function(ele){
                        ele.style.animationPlayState = "paused";
                    })
                }, 350)

                setTimeout(function(){
                    document.querySelectorAll(".enemy").forEach(function(ele){
                        ele.style.animationPlayState = "running";
                    })
                }, time+350)
            }*/

            function createIntervalBasicTank(index, timing, max){
                let classToUse;
                if (max) {
                    classToUse = "bulletStyleMax"
                }
                else {
                    classToUse = "bulletStyle"
                }
                spacesIntervals[index] = setInterval(function(){
                    newBullet = document.createElement("div");
                    newBullet.classList.add("bulletType");
                    newBullet.classList.add(classToUse);
                    let sizeNewBullet = 0.05*window.innerHeight;
                    newBullet.style.left = listSpacesQuery[index].getBoundingClientRect().left+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))+"px";
                    newBullet.style.top = listSpacesQuery[index].getBoundingClientRect().top+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))/2+"px";
                    
                    if (index%5 == 0) {
                        newBullet.classList.add("bulletMoveL1");
                    }
                    else if (index%5 == 1) {
                        newBullet.classList.add("bulletMoveL2");
                    }
                    else if (index%5 == 2) {
                        newBullet.classList.add("bulletMoveL3");
                    }
                    else if (index%5 == 3) {
                        newBullet.classList.add("bulletMoveL4");
                    }
                    else if (index%5 == 4) {
                        newBullet.classList.add("bulletMoveL5");
                    }

                    /*if (index<5) {
                        newBullet.style.top = 60+"px";
                    }
                    else if (index<10) {
                        newBullet.style.top = 210+"px";
                    }
                    else if (index<15) {
                        newBullet.style.top = 360+"px";
                    }
                    else if (index<20) {
                        newBullet.style.top = 510+"px";
                    }
                    else if (index<25) {
                        newBullet.style.top = 660+"px";
                    }
                    else if (index<30) {
                        newBullet.style.top = 810+"px";
                    }*/

                    document.body.appendChild(newBullet);

                    newBullet.addEventListener('animationend', function(e){
                        e.currentTarget.remove();
                    });

                    //observer.observe(newBullet);
                }, timing)
            }

            function createIntervalMultiTank(index, timing, max){
                if (max) {
                    spacesIntervals[index] = setInterval(function(){
                        let sizeNewBullet = 0.0355*window.innerHeight;
                        for (var i = 0; i < 4*sizeNewBullet; i+=sizeNewBullet){
                            newBullet = document.createElement("div");
                            newBullet.classList.add("bulletType");
                            newBullet.classList.add("bulletStyleMaxSmall");
                            newBullet.style.left = listSpacesQuery[index].getBoundingClientRect().left+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))+"px";
                            newBullet.style.top = listSpacesQuery[index].getBoundingClientRect().top+sizeNewBullet/2+i+"px";
    
                            if (index%5 == 0) {
                                newBullet.classList.add("bulletMoveL1");
                            }
                            else if (index%5 == 1) {
                                newBullet.classList.add("bulletMoveL2");
                            }
                            else if (index%5 == 2) {
                                newBullet.classList.add("bulletMoveL3");
                            }
                            else if (index%5 == 3) {
                                newBullet.classList.add("bulletMoveL4");
                            }
                            else if (index%5 == 4) {
                                newBullet.classList.add("bulletMoveL5");
                            }
        
                            document.body.appendChild(newBullet);
        
                            newBullet.addEventListener('animationend', function(e){
                                e.currentTarget.remove();
                            });
                        }
    
                        //observer.observe(newBullet);
                    }, timing)
                }
                else {
                    spacesIntervals[index] = setInterval(function(){
                        let sizeNewBullet = 0.05*window.innerHeight;
                        for (var i = -sizeNewBullet; i < 2*sizeNewBullet; i+=sizeNewBullet){
                            newBullet = document.createElement("div");
                            newBullet.classList.add("bulletType");
                            newBullet.classList.add("bulletStyle");
                            newBullet.style.left = listSpacesQuery[index].getBoundingClientRect().left+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))+"px";
                            newBullet.style.top = listSpacesQuery[index].getBoundingClientRect().top+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))/2+i+"px";
    
                            if (index%5 == 0) {
                                newBullet.classList.add("bulletMoveL1");
                            }
                            else if (index%5 == 1) {
                                newBullet.classList.add("bulletMoveL2");
                            }
                            else if (index%5 == 2) {
                                newBullet.classList.add("bulletMoveL3");
                            }
                            else if (index%5 == 3) {
                                newBullet.classList.add("bulletMoveL4");
                            }
                            else if (index%5 == 4) {
                                newBullet.classList.add("bulletMoveL5");
                            }
        
                            document.body.appendChild(newBullet);
        
                            newBullet.addEventListener('animationend', function(e){
                                e.currentTarget.remove();
                            });
                        }
    
                        //observer.observe(newBullet);
                    }, timing)
                }
            }

            function createIntervalGunnerTank(index, timing, max){
                spacesIntervals[index] = setInterval(function(){
                    newBullet = document.createElement("div");
                    newBullet.classList.add("bulletType");
                    newBullet.classList.add("bigBulletStyle");
                    let sizeNewBullet = 0.13*window.innerHeight;
                    newBullet.dataset.max = max;
                    newBullet.style.left = listSpacesQuery[index].getBoundingClientRect().left+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))+"px";
                    newBullet.style.top = listSpacesQuery[index].getBoundingClientRect().top+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))/2+"px";

                    
                    if (index%5 == 0) {
                        newBullet.classList.add("bulletMoveL1");
                    }
                    else if (index%5 == 1) {
                        newBullet.classList.add("bulletMoveL2");
                    }
                    else if (index%5 == 2) {
                        newBullet.classList.add("bulletMoveL3");
                    }
                    else if (index%5 == 3) {
                        newBullet.classList.add("bulletMoveL4");
                    }
                    else if (index%5 == 4) {
                        newBullet.classList.add("bulletMoveL5");
                    }

                    document.body.appendChild(newBullet);

                    newBullet.addEventListener('animationend', function(e){
                        e.currentTarget.remove();
                    });

                    //observer.observe(newBullet);
                }, timing)
            }

            function createIntervalIceTank(index, timing, max){
                spacesIntervals[index] = setInterval(function(){
                    newBullet = document.createElement("div");
                    newBullet.classList.add("bulletType");
                    newBullet.classList.add("iceBulletStyle");
                    let sizeNewBullet = 0.095*window.innerHeight;
                    newBullet.dataset.max = max;
                    newBullet.style.left = listSpacesQuery[index].getBoundingClientRect().left+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))+"px";
                    newBullet.style.top = listSpacesQuery[index].getBoundingClientRect().top+parseFloat(window.getComputedStyle(document.querySelectorAll(".armourSub")[index]).getPropertyValue('width'))/2+"px";

                    
                    if (index%5 == 0) {
                        newBullet.classList.add("bulletMoveL1");
                    }
                    else if (index%5 == 1) {
                        newBullet.classList.add("bulletMoveL2");
                    }
                    else if (index%5 == 2) {
                        newBullet.classList.add("bulletMoveL3");
                    }
                    else if (index%5 == 3) {
                        newBullet.classList.add("bulletMoveL4");
                    }
                    else if (index%5 == 4) {
                        newBullet.classList.add("bulletMoveL5");
                    }

                    document.body.appendChild(newBullet);

                    newBullet.addEventListener('animationend', function(e){
                        e.currentTarget.remove();
                    });

                    //observer.observe(newBullet);
                }, timing)
            }

            function createIntervalGoldmine(index, timing, max){
                spacesIntervals[index] = setInterval(function() {
                    currentMoney += 25;
                    moneyCounterDOC.textContent = currentMoney;
                }, timing)
            }

            function createIntervalElixirmine(index, timing, max){
                spacesIntervals[index] = setInterval(function() {
                    currentElixir += 10;
                    elixirCounterDOC.textContent = currentElixir;
                }, timing)
            }

            function createIntervalBullet(_selectedIndex, type, max) {
                var newBullet = document.createElement("div");
                clearInterval(spacesIntervals[_selectedIndex]);
                if (type == 1) {
                    createIntervalBasicTank(_selectedIndex, relationUpgradeSkills[type][0]);
                }
                else if(type == 2){
                    createIntervalMultiTank(_selectedIndex, relationUpgradeSkills[type][0]);
                    
                }
                else if (type == 5){
                    createIntervalGunnerTank(_selectedIndex, relationUpgradeSkills[type][0]);
                }
                else if (type == 6){
                    createIntervalIceTank(_selectedIndex, relationUpgradeSkills[type][0]);
                }
            }

            const indexSlow = 1.6;

            var absoluteD = new Date().getTime();

            function animar() {
                document.querySelectorAll(".enemy").forEach(function(virus){
                    document.querySelectorAll(".bulletType").forEach(function(bullet){
                        if (colision(virus, bullet) && document.body.contains(virus) && document.body.contains(bullet)) {
                            if (bullet.classList.contains("fa-fire")) {
                                if (parseInt(bullet.dataset.lifes) <= 1) {
                                    bullet.remove();
                                }
                                else {
                                    bullet.dataset.lifes = parseInt(bullet.dataset.lifes)-1;
                                    bullet.style.fontSize = (parseInt(bullet.dataset.lifes)/30)*10+"vh";
                                }
                            }
                            else if (bullet.classList.contains("bigBulletStyle")) {
                                if (bullet.dataset.max == "true") {
                                    if (bullet.getBoundingClientRect().width > window.innerHeight*0.09) {
                                        bullet.style.width = window.innerHeight*0.09+"px";
                                        bullet.style.height = window.innerHeight*0.09+"px";
                                    }
                                    else if (bullet.getBoundingClientRect().width > window.innerHeight*0.05) {
                                        bullet.style.width = window.innerHeight*0.05+"px";
                                        bullet.style.height = window.innerHeight*0.05+"px";
                                    }
                                    else {
                                        bullet.remove();
                                    }
                                }
                                else {
                                    if (bullet.getBoundingClientRect().width > window.innerHeight*0.05) {
                                        bullet.style.width = window.innerHeight*0.05+"px";
                                        bullet.style.height = window.innerHeight*0.05+"px";
                                    }
                                    else {
                                        bullet.remove();
                                    }
                                }
                            }
                            else {
                                bullet.remove();
                            }
                            if (bullet.classList.contains("iceBulletStyle") && virus.dataset.slowed == "false"){

                                virus.style.color = "#72E5FF";

                                virus.getAnimations()[0].pause();

                                let toUseSlowIndex = indexSlow;
                                if (bullet.dataset.max == "true") {
                                    toUseSlowIndex += 0.35;
                                }

                                if (virus.classList.contains("enemySuperSlow")){
                                    let timeRemaining = (1-virus.getAnimations()[0].effect.getComputedTiming().progress)*parseInt(window.getComputedStyle(virus).animationDuration)*1000;
                                    virus.style.animation = `${window.getComputedStyle(virus).animationName} ${window.getComputedStyle(virus).animationDuration} linear paused, moveEnemySlow ${timeRemaining*(toUseSlowIndex-0.3)/1000}s linear`
                                }
                                else if (virus.classList.contains("fa-skull")){
                                    let windowWidth = window.innerWidth;
                                    let posLeft = virus.getBoundingClientRect().left;

                                    let remainingWayAnimation = 1-((windowWidth-posLeft)/(1.125*windowWidth));

                                    let timeAnimation = remainingWayAnimation * virus.getAnimations()[0].effect.getComputedTiming().duration;

                                    virus.animate([
                                        { left: "-10vw" }
                                    ], {
                                        duration: timeAnimation*toUseSlowIndex,
                                    }).finished.then(function(e) {
                                        e.effect.target.remove();
                                        endGame();
                                    });
                                }
                                else {
                                    let timeRemaining = (1-virus.getAnimations()[0].effect.getComputedTiming().progress)*parseInt(window.getComputedStyle(virus).animationDuration)*1000;
                                    virus.style.animation = `${window.getComputedStyle(virus).animationName} ${window.getComputedStyle(virus).animationDuration} linear paused, moveEnemy ${timeRemaining*toUseSlowIndex/1000}s linear`
                                }

                                virus.dataset.slowed = "true";

                                if (allFrozen) {
                                    virus.getAnimations()[1].pause();
                                }

                            }
                            if (virus.classList.contains("fa-viruses")) {
                                if (virus.dataset.lifes == 1) {
                                    virus.classList.add("fa-virus");
                                    virus.classList.remove("fa-viruses");
                                    virus.dataset.lifes = 10;
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                                virus.style.color = "#FF7272";
                                setTimeout(function(){
                                    if (virus.dataset.slowed == "true"){
                                        virus.style.color = "#72E5FF";
                                    }
                                    else {
                                        virus.style.color = "black";
                                    }
                                }, 75);
                            }
                            else if (virus.classList.contains("fa-virus") && !virus.classList.contains("enemySuperSlow")){
                                if (virus.dataset.lifes == 1) {
                                    virus.remove();
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                                virus.style.color = "#FF7272";
                                setTimeout(function(){
                                    if (virus.dataset.slowed == "true"){
                                        virus.style.color = "#72E5FF";
                                    }
                                    else {
                                        virus.style.color = "black";
                                    }
                                }, 75);
                            }
                            else if (virus.classList.contains("enemySuperSlow")) {
                                if (virus.dataset.lifes == 1) {
                                    if (parseInt(virus.style.fontSize) > 30) {
                                        virus.style.fontSize = parseInt(virus.style.fontSize)-5+"px";
                                        virus.dataset.lifes = 6;
                                    }
                                    else {
                                        virus.remove();
                                    }
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                            }
                            else if (virus.classList.contains("enemySuperFast")) {
                                if (virus.dataset.lifes == 1) {
                                    virus.remove();
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                                virus.style.color = "#FF7272";
                                setTimeout(function(){
                                    if (virus.dataset.slowed == "true"){
                                        virus.style.color = "#72E5FF";
                                    }
                                    else {
                                        virus.style.color = "black";
                                    }
                                }, 75);
                            }
                            else if (virus.classList.contains("fa-skull")){
                                if (virus.dataset.lifes == 1){
                                    if (virus.dataset.size == 1){
                                        let animationsVirus = virus.getAnimations();
                                        animationsVirus.forEach(function(animation) {
                                            animation.cancel();
                                        });
                                        virus.remove();
                                    }
                                    else {
                                        divideSkull(virus, virus.dataset.size);
                                    }
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                                virus.style.color = "#FF7272";
                                setTimeout(function(){
                                    if (virus.dataset.slowed == "true"){
                                        virus.style.color = "#72E5FF";
                                    }
                                    else {
                                        virus.style.color = "black";
                                    }
                                }, 75);
                            }
                            else{
                                if (virus.dataset.lifes == 1) {
                                    if (parseInt(virus.dataset.covidSize) > 1) {
                                        let fontSizeCovid = parseInt(virus.style.fontSize);
                                        virus.style.fontSize = fontSizeCovid-window.innerHeight*0.03+"px";
                                        virus.dataset.lifes = 8;
                                        virus.dataset.covidSize = parseInt(virus.dataset.covidSize)-1;
                                    }
                                    else{
                                        virus.remove();
                                    }
                                }
                                else {
                                    virus.dataset.lifes -= 1;
                                }
                                virus.style.color = "#FF7272";
                                setTimeout(function(){
                                    if (virus.dataset.slowed == "true"){
                                        virus.style.color = "#72E5FF";
                                    }
                                    else {
                                        virus.style.color = "black";
                                    }
                                }, 75);
                            }
                        }
                    })
                    if (colision(virus, armourSpaceDiv) && document.body.contains(virus)) {
                        document.querySelectorAll(".armourSub").forEach(function(space, i){
                            if (colision(virus, space) &&  spacesToBuy[i] != 0){
                                if (virus.classList.contains("fa-viruses")){
                                    lifeSpaces[i] -= 2;
                                    virus.remove();
                                }
                                else if(virus.classList.contains("fa-virus") && !virus.classList.contains("enemySuperSlow")){
                                    lifeSpaces[i] -= 1;
                                    virus.remove();
                                }
                                else if(virus.classList.contains("enemySuperFast")){
                                    lifeSpaces[i] -= 1;
                                    virus.remove();
                                }
                                else if(virus.classList.contains("enemySuperSlow")){
                                    if (parseInt(virus.style.fontSize) > lifeSpaces[i]*3) {
                                        virus.style.fontSize = parseInt(virus.style.fontSize) - lifeSpaces[i]*3 + "px";
                                        if (parseInt(virus.style.fontSize) < 30){
                                            virus.remove();
                                        }
                                    }
                                    else {
                                        virus.remove();
                                    }
                                    lifeSpaces[i] -= parseInt(virus.style.fontSize)/3;
                                }
                                else if (virus.classList.contains("fa-skull")){
                                    if (parseInt(virus.dataset.lifes) > lifeSpaces[i]) {
                                        virus.dataset.lifes -= lifeSpaces[i];
                                        lifeSpaces[i] = 0;
                                    }
                                    else {
                                        lifeSpaces[i] -= virus.dataset.lifes;
                                        if (virus.dataset.size > 1) {
                                            divideSkull(virus, virus.dataset.size);
                                        }
                                        else {
                                            let animationsVirus = virus.getAnimations();
                                            animationsVirus.forEach(function(animation) {
                                                animation.cancel();
                                            });
                                            virus.remove();
                                        }
                                    }
                                }
                                else {
                                    let lifesVirus = parseInt(virus.dataset.covidSize);
                                    if (lifesVirus > lifeSpaces[i]) {
                                        lifeSpaces[i] = 0;
                                        virus.style.fontSize = (parseInt(virus.style.fontSize)-(window.innerHeight*0.03))+"px";
                                        virus.dataset.lifes = 8;
                                        virus.dataset.covidSize = lifesVirus-1;
                                    }
                                    else {
                                        lifeSpaces[i] -= lifesVirus;
                                        virus.remove();
                                    }
                                }

                                var pc_CurrentLife = (lifeSpaces[i]/realtionLifes[spacesToBuy[i]])*100;

                                if (pc_CurrentLife <= 0) {
                                    numBuilt[spacesToBuy[i]]--;
                                    spacesToBuy[i] = 0;
                                    clearInterval(spacesIntervals[i]);
                                    lifeSpaces[i] = NaN;
                                    space.firstChild.firstChild.remove();
                                    space.firstChild.style.background = "transparent";
                                    space.firstChild.textContent = "Buy Space";
                                }
                                else {
                                    var actualGradient = window.getComputedStyle(space.firstChild).backgroundImage;

                                    var newGradient = actualGradient.replace(/rgba\(111, 111, 111, 0.1\) \d+(\.\d+)?%?, rgba\(0, 0, 0, 0\) \d+(\.\d+)?%?/,`rgba(111, 111, 111, 0.1) ${pc_CurrentLife}%, rgba(0, 0, 0, 0) ${pc_CurrentLife}%`);

                                    space.firstChild.style.backgroundImage = newGradient;
                                }
                            }
                        })
                    }
                })
                // Llamar a la próxima animación
                requestAnimationFrame(animar);
            }

            animar();

            function sellSpaceUser(){
                let toRefund = 0;
                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                }
                currentMoney += toRefund*0.4;
                moneyCounterDOC.textContent = currentMoney;

                numBuilt[spacesToBuy[selectedIndex]]--;
                clearInterval(spacesIntervals[selectedIndex]);
                spacesToBuy[selectedIndex] = 0;
                lifeSpaces[selectedIndex] = NaN;

                let currentSpace = document.querySelectorAll(".armourSub")[selectedIndex];

                currentSpace.firstChild.firstChild.remove();
                currentSpace.firstChild.style.background = "transparent";
                currentSpace.firstChild.textContent = "Buy Space";
                closeUpgradeMenu();
            }

            function createNewBasicTank(){
                if (spacesToBuy[selectedIndex] != 1) {
                    if (currentMoney >= 200) {
                        if (numBuilt[1] < limitToBulid[1]) {
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                let toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.4;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[1]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", BASICTANK_SRC);
                            newEle.classList.add("structureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_BASIC_TANK;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 200;
                            moneyCounterDOC.textContent = currentMoney;
        
                            spacesToBuy[selectedIndex] = 1;
    
                            createIntervalBullet(selectedIndex, 1);

                            // SHOW LEVEL
                            /*let newLevelTag = document.createElement("div");
                            newLevelTag.classList.add("levelArmourTag");
                            newLevelTag.classList.add("levelTagUp");
                            newLevelTag.textContent = 1;
                            selectedSpace.firstChild.appendChild(newLevelTag);*/

                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Maximum structure limit reached!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            function createNewMultiTank(){
                if (spacesToBuy[selectedIndex] != 2){
                    if (currentMoney >= 1000) {
                        if (numBuilt[2] < limitToBulid[2]) {
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.4;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[2]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", MULTITANK_SRC);
                            newEle.classList.add("structureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_MULTI_TANK;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 1000;
                            moneyCounterDOC.textContent = currentMoney;
    
                            spacesToBuy[selectedIndex] = 2;
    
                            createIntervalBullet(selectedIndex, 2);

                            // SHOW LEVEL
                            /*let newLevelTag = document.createElement("div");
                            newLevelTag.classList.add("levelArmourTag");
                            newLevelTag.classList.add("levelTagUp");
                            newLevelTag.textContent = 1;
                            selectedSpace.firstChild.appendChild(newLevelTag);*/
                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Maximum structure limit reached!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            function createNewGunnerTank(){
                if (spacesToBuy[selectedIndex] != 5){
                    if (currentMoney >= 500) {
                        if (numBuilt[5] < limitToBulid[5]) {
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.4;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[5]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", GUNNERTANK_SRC);
                            newEle.classList.add("structureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_GUNNER_TANK;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 500;
                            moneyCounterDOC.textContent = currentMoney;
    
                            spacesToBuy[selectedIndex] = 5;
    
                            createIntervalBullet(selectedIndex, 5);
                            
                            // SHOW LEVEL
                            /*let newLevelTag = document.createElement("div");
                            newLevelTag.classList.add("levelArmourTag");
                            newLevelTag.classList.add("levelTagUp");
                            newLevelTag.textContent = 1;
                            selectedSpace.firstChild.appendChild(newLevelTag);*/
                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Maximum structure limit reached!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            function createNewIceTank(){
                if (spacesToBuy[selectedIndex] != 6){
                    if (currentMoney >= 400) {
                        if (numBuilt[6] < limitToBulid[6]) {
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.4;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[6]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", ICETANK_SRC);
                            newEle.classList.add("structureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_ICE_TANK;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 400;
                            moneyCounterDOC.textContent = currentMoney;
    
                            spacesToBuy[selectedIndex] = 6;
    
                            createIntervalBullet(selectedIndex, 6);
                            
                            // SHOW LEVEL
                            /*let newLevelTag = document.createElement("div");
                            newLevelTag.classList.add("levelArmourTag");
                            newLevelTag.classList.add("levelTagDown");
                            newLevelTag.textContent = 1;
                            selectedSpace.firstChild.appendChild(newLevelTag);*/
                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Maximum structure limit reached!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            function createNewGoldmine(){
                if (spacesToBuy[selectedIndex] != 3){
                    if (currentMoney >= 400) {
                        if (numBuilt[3] < limitToBulid[3]){
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.4;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[3]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", GOLDMINE_SRC);
                            newEle.classList.add("structureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_GOLDMINE;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 400;
                            moneyCounterDOC.textContent = currentMoney;
        
                            spacesToBuy[selectedIndex] = 3;
    
                            clearInterval(spacesIntervals[selectedIndex]);
    
                            createIntervalGoldmine(selectedIndex, relationUpgradeSkills[3][0]);
                            
                            // SHOW LEVEL
                            /*let newLevelTag = document.createElement("div");
                            newLevelTag.classList.add("levelArmourTag");
                            newLevelTag.classList.add("levelTagDown");
                            newLevelTag.textContent = 1;
                            selectedSpace.firstChild.appendChild(newLevelTag);*/
                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Maximum structure limit reached!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            function createNewElixirMine(){
                if (spacesToBuy[selectedIndex] != 7){
                    if (currentMoney >= 600) {
                        if (numBuilt[7] < limitToBulid[7]){
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.4;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[7]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", ELIXIRMINE_SRC);
                            newEle.classList.add("structureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_ELIXIRMINE;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 600;
                            moneyCounterDOC.textContent = currentMoney;
        
                            spacesToBuy[selectedIndex] = 7;
    
                            clearInterval(spacesIntervals[selectedIndex]);
    
                            createIntervalElixirmine(selectedIndex, relationUpgradeSkills[7][0]);
                            
                            // SHOW LEVEL
                            /*let newLevelTag = document.createElement("div");
                            newLevelTag.classList.add("levelArmourTag");
                            newLevelTag.classList.add("levelTagDown");
                            newLevelTag.textContent = 1;
                            selectedSpace.firstChild.appendChild(newLevelTag);*/
                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Maximum structure limit reached!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            function createNewWall(){
                if (spacesToBuy[selectedIndex] != 4){
                    if (currentMoney >= 300) {
                        if (numBuilt[4] < limitToBulid[4]) {
                            if (spacesToBuy[selectedIndex] != 0) {
                                numBuilt[spacesToBuy[selectedIndex]]--;
                                var toRefund = 0;
                                for (var i = 0; i < levelsSpaces[selectedIndex]; ++i){
                                    toRefund += realtionUpgrade[spacesToBuy[selectedIndex]][i];
                                }
                                currentMoney += toRefund*0.4;
                                moneyCounterDOC.textContent = currentMoney;
                            }
                            numBuilt[4]++;
                            selectedSpace.firstChild.textContent = "";
                            var newEle = document.createElement("img");
                            newEle.setAttribute("src", WALL_SRC);
                            newEle.classList.add("smallStructureOwned");
                            selectedSpace.firstChild.appendChild(newEle);
                            selectedSpace.firstChild.style.background = 'linear-gradient(to right, rgba(111, 111, 111, 0.1) 100%, rgba(0, 0, 0, 0) 100%)';
                            lifeSpaces[selectedIndex] = LIFES_WALL;
                            levelsSpaces[selectedIndex] = 1;
                            currentMoney -= 300;
                            moneyCounterDOC.textContent = currentMoney;
        
                            spacesToBuy[selectedIndex] = 4;
    
                            clearInterval(spacesIntervals[selectedIndex]);
                        }
                        else {
                            alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Maximum structure limit reached!`
                            alertNoMoney.style.display = "block";
                        }
                    }
                    else {
                        alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>Not Enough Money!`
                        alertNoMoney.style.display = "block";
                    }
                }
                else {
                    alertNoMoney.innerHTML = `<span class="closebtnAlertRed" onclick="this.parentElement.style.display='none';">&times;</span>You already have this structure built here!`
                    alertNoMoney.style.display = "block";
                }
            }

            var listTimeOutsSpawnBoss = [];

            var controlBossSpawnInterval;
            var bossSpawnCount = 1;
            var lastControlBossSpawn = new Date().getTime();
            function controlBossSpawning(){
                controlBossSpawnInterval = setInterval(function(){
                    var actualTimeBoss = new Date().getTime();
                    if (actualTimeBoss - d >= 400000) {
                        if (actualTimeBoss - lastControlBossSpawn > 200000) {
                            lastControlBossSpawn = actualTimeBoss;
                            for(var i = 10000; i <= bossSpawnCount*10000; i+=10000) {
                                let newTimeOut = new Timer(function() {
                                    spawnVirusBoss(1200);
                                    listTimeOutsSpawnBoss.shift();
                                }, 10000+i);
                                listTimeOutsSpawnBoss.push(newTimeOut);
                            }
                            bossSpawnCount++;

                        }
                    }
                }, 1000);
            }

            function divideSkull(oldSkull, size){
                let windowWidth = window.innerWidth;

                let posLeftOldSkull = parseFloat(getComputedStyle(oldSkull).left);
                let posTopOldSkull = parseFloat(getComputedStyle(oldSkull).top);

                let widthOldSkull = parseFloat(oldSkull.style.fontSize);
                let heightOldSkull = parseFloat(oldSkull.style.fontSize);

                let posTopNewSkull1 = posTopOldSkull+(heightOldSkull/4);
                let posTopNewSkull2 = posTopOldSkull-(heightOldSkull/4);

                let timeNewAnimation = (1-((windowWidth-posLeftOldSkull)/(1.125*windowWidth)))*70000;

                let animationsVirus = oldSkull.getAnimations();
                animationsVirus.forEach(function(animation) {
                    animation.cancel();
                }); 

                oldSkull.remove();

                spawnSkull(size-1, posLeftOldSkull, posTopNewSkull1, timeNewAnimation);
                spawnSkull(size-1, posLeftOldSkull, posTopNewSkull2, timeNewAnimation);
                //getRandomInt(window.innerHeight-3*(Math.pow(2, size-1)*40))+1.5*Math.pow(2, size-1)*40
            }

            function spawnSkull(size, posLeft=Math.pow(2, size-1)*20+window.innerWidth, posTop=getRandomInt(armourSpaceDiv.getBoundingClientRect().height-(Math.pow(2, size-1)*40))+0.5*Math.pow(2, size-1)*40, timeAnimation=70000){
                var newSkull = document.createElement("div");
                newSkull.classList.add("enemy");
                newSkull.classList.add("fa-solid");
                newSkull.classList.add("fa-skull");

                let windowWidth = window.innerWidth;

                let animation = newSkull.animate([
                    { left: "-12.5vw" }
                ], {
                    duration: timeAnimation,
                })

                newSkull.style.position = "absolute";
                let sizeSkull = Math.pow(2, size-1)*40;
                newSkull.style.fontSize = sizeSkull+"px";
                newSkull.style.left = posLeft+"px"
                newSkull.style.top = posTop+"px";

                newSkull.dataset.size = size;
                newSkull.dataset.lifes = (size*2)+1;
                newSkull.dataset.slowed = "false";

                document.body.appendChild(newSkull);

                animation.finished.then(function(e) {
                    e.effect.target.remove();
                    endGame();
                });
            }

            function spawnDisease(horde=false, pos=null) {
                if (horde) {
                    let gameZoneHeight = armourSpaceDiv.getBoundingClientRect().height;
                    for (var i = gameZoneHeight/20; i < gameZoneHeight; i+=gameZoneHeight/10) {
                        spawnDisease(false, i);
                    }
                }
                else {
                    var newVirus = document.createElement("div");
                    newVirus.classList.add("fa-solid");
                    newVirus.classList.add("fa-disease");
                    newVirus.classList.add("enemySuperFast");
                    let widthVHNewVirus = 6;
                    let virusSizeTotal = window.innerHeight*widthVHNewVirus/100;
                    newVirus.style.fontSize = widthVHNewVirus+"vh";

                    newVirus.dataset.lifes = 15;
                    newVirus.dataset.slowed = "false";
                    newVirus.classList.add("enemy");

                    if (pos == null) {
                        newVirus.style.top = getRandomInt(armourSpaceDiv.getBoundingClientRect().height-virusSizeTotal)+0.5*virusSizeTotal+"px";
                    }
                    else {
                        newVirus.style.top = pos + "px";
                    }
                    newVirus.style.left = 1.03*window.innerWidth+"px";
                    document.body.appendChild(newVirus);

                    newVirus.addEventListener("animationend", function(evt){
                        currentLifes -= 1;
                        lifesCounterDOC.textContent = currentLifes;
                        if (currentLifes <= 0) {
                            endGame();
                        }
                        evt.currentTarget.remove();
                    });
                }

            }

            var lastBossSpawned = d;

            function spawnVirusBasic(posTop=null, posLeft = null, duration=null){
                var newVirus = document.createElement("div");
                newVirus.classList.add("fa-solid");
                newVirus.dataset.lifes = 10;
                newVirus.dataset.slowed = "false";
                newVirus.classList.add("fa-virus");
                let widthVHNewVirus = 6;
                let virusSizeTotal = window.innerHeight*widthVHNewVirus/100;
                newVirus.style.fontSize = widthVHNewVirus+"vh";
                newVirus.classList.add("enemyBasic");
                newVirus.style.left = posLeft+"px";

                if(duration != null) {
                    newVirus.style.animationDuration = duration+"s";
                }

                let FS_Virus = newVirus.getBoundingClientRect().width;

                if (posTop == null) {
                    newVirus.style.top = getRandomInt(armourSpaceDiv.getBoundingClientRect().height-virusSizeTotal)+0.5*virusSizeTotal+"px";
                }
                else {
                    newVirus.style.top = posTop + "px";
                }

                if (posLeft == null) {
                    newVirus.style.left = 1.03*window.innerWidth+"px";
                }
                else {
                    newVirus.style.top = posLeft + "px";
                }

                newVirus.classList.add("enemy");
                newVirus.style.top = posTop + "px";

                newVirus.addEventListener("animationend", function(evt){
                    currentLifes -= 1;
                    lifesCounterDOC.textContent = currentLifes;
                    if (currentLifes <= 0) {
                        endGame();
                    }
                    evt.currentTarget.remove();
                });

                document.body.appendChild(newVirus);
            }

            function spawnVirusDouble(posTop=null, posLeft=null, duration=null){
                var newVirus = document.createElement("div");
                newVirus.classList.add("fa-solid");
                newVirus.dataset.lifes = 12;
                newVirus.dataset.slowed = "false";

                newVirus.classList.add("fa-viruses");
                let widthVHNewVirus = 6;
                let virusSizeTotal = window.innerHeight*widthVHNewVirus/100;
                newVirus.style.fontSize = widthVHNewVirus+"vh";
                newVirus.classList.add("enemyBasic");
                newVirus.style.left = posLeft+"px";

                if(duration != null) {
                    newVirus.style.animationDuration = duration+"s";
                }

                if (posTop == null) {
                    newVirus.style.top = getRandomInt(armourSpaceDiv.getBoundingClientRect().height-virusSizeTotal)+0.5*virusSizeTotal+"px";
                }
                else {
                    newVirus.style.top = posTop + "px";
                }

                if (posLeft == null) {
                    newVirus.style.left = 1.03*window.innerWidth+"px";
                }
                else {
                    newVirus.style.top = posLeft + "px";
                }

                newVirus.classList.add("enemy");
                newVirus.style.top = posTop+"px";

                newVirus.addEventListener("animationend", function(evt){
                    currentLifes -= 2;
                    lifesCounterDOC.textContent = currentLifes;
                    if (currentLifes <= 0) {
                        endGame();
                    }
                    evt.currentTarget.remove();
                });
                document.body.appendChild(newVirus);
            }

            function spawnVirusCovid(posTop=null, posLeft=null, duration=null){
                var newVirus = document.createElement("div");
                newVirus.classList.add("fa-solid");
                newVirus.dataset.lifes = 8;
                newVirus.dataset.minSize = window.innerHeight*0.05;
                newVirus.dataset.covidSize = 5;
                newVirus.dataset.slowed = "false";

                newVirus.classList.add("fa-virus-covid");
                newVirus.classList.add("enemySlow");
                newVirus.style.fontSize = window.innerHeight*0.17+"px";
                newVirus.style.left = posLeft+"px";

                newVirus.classList.add("enemy");
                newVirus.style.top = posTop+"px";

                if(duration != null) {
                    newVirus.style.animationDuration = duration+"s";
                }

                let FS_Virus = parseInt(newVirus.style.fontSize);

                if (posTop == null) {
                    newVirus.style.top = getRandomInt(armourSpaceDiv.getBoundingClientRect().height-FS_Virus)+0.5*FS_Virus+"px";
                }
                else {
                    newVirus.style.top = posTop + "px";
                }

                if (posLeft == null) {
                    newVirus.style.left = FS_Virus/2+window.innerWidth+"px";
                }
                else {
                    newVirus.style.top = posLeft + "px";
                }

                newVirus.addEventListener("animationend", function(evt){
                    currentLifes -= ((parseInt(evt.currentTarget.style.fontSize)-10)/30);
                    lifesCounterDOC.textContent = currentLifes;
                    if (currentLifes <= 0) {
                        endGame();
                    }
                    evt.currentTarget.remove();
                });
                document.body.appendChild(newVirus);
            }


            var pcSpawnVirusType = {
                "boss": 0.2,
                "diseaseH": 0.8,
                "skull": 1,
                "covid": 5,
                "diseaseB": 10,
                "double": 23,
                "basic": 60,
            }

            var psSpawnSkullSize = {
                1: 37.5,
                2: 32.5,
                3: 20,
                4: 7.5,
                5: 2.5
            }

            function spawnVirusByPc(basic, double, diseaseB, covid, skull, diseaseH, boss, skullSize = undefined, bossSize = undefined, timeAnimation = undefined){
                let totalSumPc = 0;
                let listVirusToTake = [];

                if (basic) {
                    totalSumPc += pcSpawnVirusType["basic"];
                    listVirusToTake.push("basic");
                }
                if (double) {
                    totalSumPc += pcSpawnVirusType["double"];
                    listVirusToTake.push("double");
                }
                if (diseaseB) {
                    totalSumPc += pcSpawnVirusType["diseaseB"];
                    listVirusToTake.push("diseaseB");
                }
                if (covid) {
                    totalSumPc += pcSpawnVirusType["covid"];
                    listVirusToTake.push("covid");
                }
                if (skull) {
                    totalSumPc += pcSpawnVirusType["skull"];
                    listVirusToTake.push("skull");
                }
                if (diseaseH) {
                    totalSumPc += pcSpawnVirusType["diseaseH"];
                    listVirusToTake.push("diseaseH");
                }
                if (boss) {
                    totalSumPc += pcSpawnVirusType["boss"];
                    listVirusToTake.push("boss");
                }

                let NumSpawnNewVirus = Math.random()*totalSumPc;
                let virusSP = false;
                let _index = 0;

                while (!virusSP) {
                    if (NumSpawnNewVirus < pcSpawnVirusType[listVirusToTake[_index]]) {
                        spawnCustomVirus(listVirusToTake[_index], skullSize, bossSize, timeAnimation);
                        virusSP = true;
                    }
                    else {
                        NumSpawnNewVirus -= pcSpawnVirusType[listVirusToTake[_index]];
                        _index++;
                    }
                }

            }


            /*function spawnVirus(basic, double, diseaseB, covid, skull, diseaseH, boss) {
                if ((Math.random() < pcSpawnVirusType["boss"]/100) && boss) {
                    let currentTimeCheckBoss = new Date().getTime();
                    if (currentTimeCheckBoss - lastBossSpawned > 120000) {
                        spawnVirusBoss(1200);
                        lastBossSpawned = new Date().getTime();
                    }
                }
                
                if ((Math.random() < pcSpawnVirusType["diseaseH"]/100) && diseaseH) {
                    spawnDisease(true);
                }
                else if ((Math.random() < pcSpawnVirusType["skull"]/100) && skull) {
                    if (Math.random()*100 < psSpawnSkullSize[5]) {
                        spawnSkull(5);
                    }
                    else if(Math.random()*100 < psSpawnSkullSize[4]) {
                        spawnSkull(4);
                    }
                    else if(Math.random()*100 < psSpawnSkullSize[3]) {
                        spawnSkull(3);
                    }
                    else if(Math.random()*100 < psSpawnSkullSize[2]){
                        spawnSkull(2);
                    }
                    else {
                        spawnSkull(1);
                    }
                }
                else if ((Math.random() < pcSpawnVirusType["covid"]/100) && covid) {
                    spawnVirusCovid();
                }
                else if ((Math.random() < pcSpawnVirusType["diseaseB"]/100) && diseaseB) {
                    spawnDisease(false);
                }
                else if ((Math.random() < pcSpawnVirusType["double"]/100) && double){
                    spawnVirusDouble();
                }
                else if (basic){
                    spawnVirusBasic();
                }
                else {
                    console.log("No virus spawned");
                }
            }*/

            function spawnVirusTime(){
                let currentTime = new Date().getTime();
                if (currentTime - d < 60000) {
                    spawnVirusByPc(true, false, false, false, false, false, false);
                }
                else if (currentTime - d < 120000) {
                    spawnVirusByPc(true, true, false, false, false, false, false);
                }
                else if (currentTime - d < 180000){
                    spawnVirusByPc(true, true, true, false, false, false, false);
                }
                else if (currentTime - d < 240000){
                    spawnVirusByPc(true, true, true, true, false, false, false);
                }
                else if (currentTime - d < 300000){
                    spawnVirusByPc(false, true, true, true, false, false, false);
                }
                else if (currentTime - d < 360000){
                    spawnVirusByPc(false, true, true, true, true, false, false);
                }
                else if (currentTime - d < 420000) {
                    spawnVirusByPc(false, true, true, true, true, true, false);
                }
                else if (currentTime - d < 480000){
                    spawnVirusByPc(false, true, true, true, true, true, true);
                }
                else if (currentTime - d < 540000){
                    spawnVirusByPc(false, false, true, true, true, true, true);
                }
                else{
                    spawnVirusByPc(false, false, false, true, true, true, true);
                }
            }

            /*var intervalVirus;
            function createIntervalSpawnVirus(difficultySpawn){
                intervalVirus = setInterval(function(){
                    spawnVirusTime();
                }, difficultySpawn);
            }*/


            function spawnVirusBoss(size, animationTime = null){
                var newVirus = document.createElement("div");
                newVirus.classList.add("fa-solid");
                newVirus.classList.add("fa-virus");
                newVirus.classList.add("enemy");
                newVirus.classList.add("enemySuperSlow");
                newVirus.dataset.lifes = 6;
                newVirus.dataset.slowed = "false";

                newVirus.style.fontSize = size+"px";
                newVirus.style.color = "#FF9F9F";

                if (animationTime != null) {
                    newVirus.style.animationDuration = animationTime+"s";
                }

                if (size < armourSpaceDiv.getBoundingClientRect().height) {
                    newVirus.style.top = getRandomInt(armourSpaceDiv.getBoundingClientRect().height-size)+0.5*size+"px";
                }
                else {
                    newVirus.style.top = armourSpaceDiv.getBoundingClientRect().height/2+"px";
                }
                newVirus.style.left =  window.innerWidth+(size/2)+"px";

                newVirus.addEventListener("animationend", function(evt){
                    endGame();
                    evt.currentTarget.remove();
                });

                document.body.appendChild(newVirus);
            }

            var minAsymptote = 0.75;

            function getDifficultyMathFunction(x, _DF){
                return ((_DF-minAsymptote)*Math.pow(2, -x/divideIndexDiff))+minAsymptote;
            }
            var divideIndexDiff;
            var intervalDifficulty;
            function createDifficultyInterval(){
                intervalDifficulty = new Timer(function(){
                    if (!gameStatePaused) {
                        spawnVirusTime();
                        callBackDifficulty(difficultySpawn);
                    }
                }, difficultySpawn);
            }

            var totalTimeAccumulted = 0;
            function callBackDifficulty(time){
                intervalDifficulty = new Timer(function(){
                    if (!gameStatePaused) {
                        spawnVirusTime();
                        let newTimeDiff = getDifficultyMathFunction(totalTimeAccumulted, difficultySpawn/1000);
                        callBackDifficulty(newTimeDiff*1000);
                        totalTimeAccumulted+=newTimeDiff;
                    }
                }, time);
            }

            document.querySelectorAll(".armourSub").forEach(function(ele, i){
                ele.addEventListener("click", function(e){
                    if (levelsSpaces[i] != 0 && spacesToBuy[i] != 4) {
                        event.preventDefault();

                        upgradeMenu(e, i);
                    }

                })
            })


            var mainMoneyInterval;
            function createMainMoneyInterval(amount){
                mainMoneyInterval = setInterval(function(){
                    currentMoney += amount;
                    moneyCounterDOC.textContent = currentMoney;
                }, 2000);
            }

            var chrono = document.getElementById("mainChrono");
            var chronoInterval;

            var d;

            function startChrono(){
                chronoInterval = setInterval(function(){
                    let currentTime = new Date().getTime();
                    chrono.textContent = (parseFloat(currentTime-d)/1000 + 0.1).toFixed(1).toString();
                }, 100);
            }

            var gameStatePaused = false;

            var timePaused;

            var pausedMainIconDiv = document.getElementById("gamePausedDiv");

            function pauseGame(){
                if (!gameStatePaused && !endGameVar) {

                    pausedMainIconDiv.style.display = "flex";
                    timePaused = new Date().getTime();
                    closeUpgradeMenu();
                    gameStatePaused = true;
                    clearInterval(mainMoneyInterval);
                    clearInterval(chronoInterval);

                    for (var i = 0; i < 30; ++i) {
                        clearInterval(spacesIntervals[i]);
                        clearInterval(spacesIntervals[i]);
                    }

                    for (var i = 0; i < listTimeOutsSpawnBoss.length; i++) {
                        clearTimeout(listTimeOutsSpawnBoss[i]);
                    }

                    if (playingAtLevel) {
                        if (timerLevel != undefined) {
                            timerLevel.pause();
                        }

                        for (var i = 0; i < timeOutsStagesLevel.length; ++i) {
                            timeOutsStagesLevel[i].pause();
                        }

                        intervalDifficultyLevel.pause();
                    }
                    else {
                        intervalDifficulty.pause();
                        clearInterval(controlBossSpawnInterval);
                    }

                    document.querySelectorAll(".enemy").forEach(function(ele){
                        let animationsVirus = ele.getAnimations();
                        if (animationsVirus.length == 1) {
                            animationsVirus[0].pause();
                        }
                        else {
                            animationsVirus[0].pause();
                            animationsVirus[1].pause();
                        }
                    });

                    document.querySelectorAll(".bulletType").forEach(function(ele){
                        ele.getAnimations()[0].pause();
                    });
                }
            }   

            function reanudeGame(){
                window.removeEventListener("click", reanudeGame);
                window.removeEventListener("contextmenu", reanudeGame);
                if (gameStatePaused && !endGameVar) {

                    for (var i = 0; i < listTimeOutsSpawnBoss.length; i++) {
                        listTimeOutsSpawnBoss[i].resume();
                    }

                    pausedMainIconDiv.style.display = "none";
                    gameStatePaused = false;

                    let currentTimeReanuded = new Date().getTime();

                    d += (currentTimeReanuded-timePaused);

                    createMainMoneyInterval(mainMoneyIntervalToEarn);

                    startChrono();

                    // level

                    if (playingAtLevel) {
                        intervalDifficultyLevel.resume();

                        if (timerLevel != undefined) {
                            timerLevel.resume();
                        }
    
                        timeOutsStagesLevel.forEach(function(e){
                            e.resume();
                        })
                    }
                    else {
                        controlBossSpawning();
                        intervalDifficulty.resume();
                    }


                    document.querySelectorAll(".bulletType").forEach(function(ele){
                        ele.getAnimations()[0].play();
                    });

                    document.querySelectorAll(".enemy").forEach(function(ele){
                        let animationsVirus = ele.getAnimations();
                        if (animationsVirus.length == 1) {
                            animationsVirus[0].play();
                        }
                        else {
                            animationsVirus[1].play();
                        }
                    });

                    for (var i = 0; i < 30; ++i) {
                        if (spacesToBuy[i] == 1) {
                            createIntervalBasicTank(i, timeUpgradeBasicTank[levelsSpaces[i]-1]);
                        }
                        else if (spacesToBuy[i] == 2) {
                            createIntervalMultiTank(i, timeUpgradeMultiTank[levelsSpaces[i]-1]);
                        }
                        else if (spacesToBuy[i] == 3) {
                            createIntervalGoldmine(i, timeUpgradeGoldmine[levelsSpaces[i]-1]);
                        }
                        else if (spacesToBuy[i] == 5) {
                            createIntervalGunnerTank(i, timeUpgradeGunnerTank[levelsSpaces[i]-1]);
                        }
                        else if (spacesToBuy[i] == 6) {
                            createIntervalIceTank(i, timeUpgradeIceTank[levelsSpaces[i]-1]);
                        }
                    }
                }

            }

            
            var stratGameMainDiv = document.getElementById("divPreStartGame");

            var mainMoneyIntervalToEarn = 25;

            // RUN THE GAME

            function startGame(){

                presentLevel(currentDiffString, undefined, "Resist as much as you can", true)

                stratGameMainDiv.style.display = "none";

                setTimeout(function(){
                    d = new Date().getTime();

                    difficultySpawn = eqDiffIni[currentDiffString];
                    divideIndexDiff = divideIndexDiffDict[currentDiffString];

                    createDifficultyInterval();

                    createMainMoneyInterval(mainMoneyIntervalToEarn);

                    controlBossSpawning();

                    startChrono();

                    minAsymptote = eqAsymptoteDiff[currentDiffString];

                    // Pause the game if user left window
                    document.addEventListener("visibilitychange", (event) => {
                        if (document.visibilityState != "visible") {
                            pauseGame();
                        } 
                        window.addEventListener("click", reanudeGame);
                        window.addEventListener("contextmenu", reanudeGame);
                    });
                }, 4000)
            }

            // GAME LEVELS

            var playingAtLevel;

            function presentLevel(nameLevel, artisticName, goalTime, diff) {
                let presentationDiv = document.getElementById("presentationLevelDiv");

                let levelName = document.getElementById("levelNum");

                let timeGoalDiv = document.getElementById("levelTimeGoal");

                if (diff) {

                    document.getElementById("resist-time-present-level").textContent = goalTime;

                    levelName.textContent = nameLevel + " Difficulty";
                }

                else {

                    levelName.textContent = nameLevel+": "+artisticName;

                    timeGoalDiv.textContent = goalTime/1000;
                }
                

                presentationDiv.style.display = "flex";

                presentationDiv.addEventListener("animationend", function(e){
                    e.currentTarget.style.display = "none";
                })

            }

            function levelCompleted(levelName, id){
                if (!endGameVar) {
                    endGameVar = true;
                    closeUpgradeMenu();
                    clearInterval(mainMoneyInterval);
                    clearInterval(controlBossSpawnInterval);
                    clearInterval(chronoInterval);
                    intervalDifficultyLevel.pause();

                    for (var i = 0; i < listTimeOutsSpawnBoss.length; i++) {
                        clearTimeout(listTimeOutsSpawnBoss[i]);
                    }

                    for (var i = 0; i < 30; ++i) {
                        clearInterval(spacesIntervals[i]);
                    }
                    document.querySelectorAll(".enemy").forEach(function(ele){
                        ele.remove();
                    })
                    gameOverDiv.style.display = "contents";
                    diffGameOver.style.display = "none";
                    gameOverOrNewRecord.textContent = levelName+" Completed!";
                    timeResisted.style.display = "none";

                    if (localStorage.getItem("level"+id+"_completed") == undefined) {
                        localStorage.setItem("level"+id+"_completed", true);
                    }

                }
            }

            function spawnCustomVirus(type, skullSize=undefined, bossSize=undefined, timeAnimation=undefined) {
                if (type == "basic"){
                    spawnVirusBasic(undefined, undefined, timeAnimation);
                }
                else if (type == "double"){
                    spawnVirusDouble(undefined, undefined, timeAnimation);
                }
                else if (type == "covid"){
                    spawnVirusCovid(undefined, undefined, timeAnimation);
                }
                else if (type == "diseaseB"){
                    spawnDisease(false);
                }
                else if (type == "diseaseH"){
                    spawnDisease(true);
                }
                else if (type == "skull"){
                    if (skullSize != undefined) {

                        let totalPCSkull = 0;

                        for (var i = 0; i < skullSize.length; i++) {
                            totalPCSkull+=psSpawnSkullSize[skullSize[i]];
                        }

                        let NumSpawnNewSkull = Math.random()*totalPCSkull;
                        let skullSP = false;
                        let _index = 0;

                        while (!skullSP) {
                            if (NumSpawnNewSkull < psSpawnSkullSize[skullSize[_index]]) {
                                spawnSkull(skullSize[_index], undefined, undefined, timeAnimation);
                                skullSP = true;
                            }
                            else {
                                NumSpawnNewSkull -= psSpawnSkullSize[skullSize[_index]];
                                _index++;
                            }
                        }


                    }
                    else {
                        if (Math.random()*100 < psSpawnSkullSize[5]) {
                            spawnSkull(5, undefined, undefined, timeAnimation);
                        }
                        else if(Math.random()*100 < psSpawnSkullSize[4]) {
                            spawnSkull(4, undefined, undefined, timeAnimation);
                        }
                        else if(Math.random()*100 < psSpawnSkullSize[3]) {
                            spawnSkull(3, undefined, undefined, timeAnimation);
                        }
                        else if(Math.random()*100 < psSpawnSkullSize[2]){
                            spawnSkull(2, undefined, undefined, timeAnimation);
                        }
                        else{
                            spawnSkull(1, undefined, undefined, timeAnimation);
                        }
                    }
                }
                else if (type == "boss"){
                    if (bossSize != undefined) {
                        spawnVirusBoss(bossSize, timeAnimation);
                    }
                    else {
                        spawnVirusBoss(1200, timeAnimation);
                    }
                }
            }

            /*
            var newLevelOptions = {
                indexLevel
                nameLevel
                goalTime
                virusTimeline
                iniDiffSpawn
                changeDiffSpawn
                money
                moneyIntervalEarned
            }

            var spawnTypeLvl = {
                typeBasic: bool
                typeDouble: bool
                typeCovid: bool
                typeDiseaseB: bool
                typeDiseaseH: bool
                typeSkull: bool
                typeBoss: bool
            }

            var params = {
                skullSize: list
                bossSize: int
                timeAnimation: int
            }


            var options = {
                uniqueType: bool
                typeUnique: string
                params: type
                diffSpawn: int (miliseconds)
                spawn: spawnTypeLvl
            }
            */

            var intervalDifficultyLevel;
            function createDifficultyIntervalLevel(options){
                let diffSpawningLvl;
                if (options.diffSpawn == 0 || options.fixedSP == false){
                    diffSpawningLvl = difficultySpawn;
                }
                else {
                    diffSpawningLvl = options.diffSpawn;
                }
                intervalDifficultyLevel = new Timer(function(){
                    if (!gameStatePaused) {
                        spawnVirusInLevel(options);
                        callBackDifficultyLevel(diffSpawningLvl, options);
                    }
                }, diffSpawningLvl);
            }

            var totalTimeAccumultedLevel = 0;
            function callBackDifficultyLevel(time, options){
                intervalDifficultyLevel = new Timer(function(){
                    if (!gameStatePaused) {
                        spawnVirusInLevel(options);
                        let newTimeDiffLevel = getDifficultyMathFunction(totalTimeAccumultedLevel, difficultySpawn/1000);
                        callBackDifficultyLevel(newTimeDiffLevel*1000, options);
                        totalTimeAccumultedLevel+=newTimeDiffLevel;
                    }
                }, time);
            }

            /*var intervalSpawning_level;
            var intervalDifficulty_level
            var diffChangeLevel;

            function controlDifficultyLevel(diffChange){
                intervalDifficulty_level = new Timer(function(){
                    if (!gameStatePaused) {
                        clearInterval(intervalSpawning_level);
                        difficultySpawn*=diffChange;
                        setSpawningFunction(currentOptionsLevel);
                    }
                }, 10000)
            }

            function setSpawningFunction(options){
                let diffSpawning;
                if (options.diffSpawn == 0 || options.fixedSP == false){
                    diffSpawning = difficultySpawn;
                }
                else {
                    diffSpawning = options.diffSpawn;
                }
                intervalSpawning_level = setInterval(function(){
                    spawnVirusInLevel(options);
                }, diffSpawning)
            }*/

            function spawnVirusInLevel(options) {
                if (options.uniqueType){
                    spawnCustomVirus(options.typeUnique, options.params.skullSize, options.params.bossSize, options.params.timeAnimation);
                }
                else {
                    spawnVirusByPc(options.spawn.typeBasic, options.spawn.typeDouble, options.spawn.typeDiseaseB, options.spawn.typeCovid, options.spawn.typeSkull, options.spawn.typeDiseaseH, options.spawn.typeBoss, options.params.skullSize, options.params.bossSize, options.params.timeAnimation);
                }
            }

            var timerLevel;
            var timeOutsStagesLevel = [];
            var currentOptionsLevel;

            /*

            var newLevelOptions = {
                indexLevel
                nameLevel
                goalTime
                virusTimeline
                iniDiffSpawn
                changeDiffSpawn
                money
                moneyIntervalEarned
            }

            */

            var currentLVLName;

            var levelGoalTimeToAchieve = document.getElementById("levelGoalTimeToAchieve");

            function newLevel(newLevelOptions) {

                stratGameMainDiv.style.display = "none";

                playingAtLevel = true;

                presentLevel(newLevelOptions.nameLevel, newLevelOptions.artisticName, newLevelOptions.goalTime, false);

                currentLVLName = newLevelOptions.nameLevel;

                levelGoalTimeToAchieve.textContent = " / "+newLevelOptions.goalTime/1000;

                if (newLevelOptions.money != null) {
                    currentMoney = newLevelOptions.money;
                    moneyCounterDOC.textContent = currentMoney;
                }

                mainMoneyIntervalToEarn = newLevelOptions.moneyIntervalEarned;

                setTimeout(function(){
                    // Pause the game if user left window
                    document.addEventListener("visibilitychange", (event) => {
                        if (document.visibilityState != "visible") {
                            pauseGame();
                        } 
                        window.addEventListener("click", reanudeGame);
                        window.addEventListener("contextmenu", reanudeGame);
                    });

                    // TO DO

                    timerLevel = new Timer(function() {
                        if (!endGameVar) {
                            levelCompleted(newLevelOptions.nameLevel, newLevelOptions.id);
                        }
                    }, newLevelOptions.goalTime);


                    startChrono();
                    d = new Date().getTime();

                    minAsymptote = newLevelOptions.asymptLevel;

                    divideIndexDiff = newLevelOptions.changeDiffSpawn;

                    difficultySpawn = newLevelOptions.iniDiffSpawn;

                    createMainMoneyInterval(mainMoneyIntervalToEarn);

                    // LEVEL STAGES AND FUNCTION SPAWNING
                    
                    Object.keys(newLevelOptions.virusTimeline).forEach(function(key){
                        if (key == 0) {
                            if (newLevelOptions.virusTimeline[key].setDiffSpawnGlobal) {
                                difficultySpawn = newLevelOptions.virusTimeline[key].diffSpawn;
                            }
                            createDifficultyIntervalLevel(newLevelOptions.virusTimeline[key]);
                            currentOptionsLevel = newLevelOptions.virusTimeline[key];
                        }
                        else {
                            let levelSingleTimeout = new Timer(function(){
                                if (newLevelOptions.virusTimeline[key].setDiffSpawnGlobal) {
                                    difficultySpawn = newLevelOptions.virusTimeline[key].diffSpawn;
                                    totalTimeAccumultedLevel = 0;
                                }
                                currentOptionsLevel = newLevelOptions.virusTimeline[key];
                                intervalDifficultyLevel.pause();
                                createDifficultyIntervalLevel(newLevelOptions.virusTimeline[key]);
                            }, (key/100)*newLevelOptions.goalTime);
                            timeOutsStagesLevel.push(levelSingleTimeout);
                        }
                    })
                }, 4000)
            }


        </script>
    </body>
</html>
